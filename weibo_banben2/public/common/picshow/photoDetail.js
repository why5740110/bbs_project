(function(f){var c={};var i=function(k){return c[k];};var r=function(k){if(!c[k]){var m={exports:{}};try{f[k].call(m.exports,m,m.exports,r,i)}catch(e){};c[k]=m.exports;}return c[k];};return r('a');})({a:function(e,t,n,r){function st(e,t){for(var n=0;n<t.length;n++){if(t[n]["album_id"]==e)return t[n]}return false}var i=n("A");var s=n("b");var o=n("B");var u=n("e");var a=n("g");var f=n("I");var l=n("j");var c=n("K");var h=n("o");var p=n("P");var d=n("C");var v=n("r");var m=n("N");var g=n("h");var y=n("T");var b=n("Q");var w=n("u");var E=n("s");var S=n("v");var x=n("n");var T=n("x");var N=n("X");var C=n("y");var k=n("d");var L=n("R");var A=n("O");var O=n("V");var M=n("D");var _=n("q");var D=n("t");var P=n("Y");n("z");n("Z");n("aA");n("i");var H=new M;var B=o("#pl_main");var j=E.DetailDB;var F=S.DetailView;var I=x.DetailTool;var q=N;var R=$GLOBAL_DETAIL["album_photo_ids"];var U=$GLOBAL_DETAIL["album_likes_photo_ids"];var z=$GLOBAL_DETAIL["is_likes_page"];var W=$GLOBAL_DETAIL["special"]=="0"?false:$GLOBAL_DETAIL["special"];var X={},V={};var $=166+97,J=37;var K,Q;var G={1:["所有人可见",""],2:["仅自己可见","M_icon39"],3:["粉丝可见","M_icon39"],4:["互相关注可见","M_icon39"],5:["回答问题可见","M_icon39"],6:["私密微博配图","M_icon39"],7:["密友可见","M_icon39"],8:["分组可见","M_icon39"],9:["仅好友可见","M_icon39"]};var Y=function(e,t){var n,r={1:["所有人可见",""],2:["仅自己可见","M_icon39"],3:["相互关注可见","M_icon39"],4:["相互关注可见","M_icon39"],5:["回答问题可见","M_icon39"],6:["私密微博配图","M_icon39"],7:["密友可见","M_icon39"],11:{43:["会员可见","M_icon39"],44:["付费可见","M_icon39"]}};var n=r[e];if(n){if(n instanceof Array){return n}if(n[t]){return n[t]}}return r[1]};var Z=6,et=4,tt=3,nt=1;s.isSelf=D.me;var rt=function(e){e.cancelBubble=true;e.returnValue=false;return false};var it={title:document.title,ajaxtimer:null,hasTip:false,hasTag:false,hasTagInit:false,tagLocked:false,hasZoning:false,rotate:0,detailMuen:function(){var e=this;if(e.editMuen)e.editMuen.destroy();e.editMuen=new f({target:o("a[action-type=top_edit]"),goal:o("div[node-type=edit_muen]")});o(e.editMuen).bind("enter",function(){if(it.clip)e.clip.reposition();if(o.browser.msie)I.resetTitle(e.title)});e.editMuen.init()},operate_menu:function(){var e=this;var t=X["uid"]==$GLOBAL_INFO["account_uid"]?true:false;if(!t){if(e.menu)e.menu.destroy();e.menu=new f({target:o("a[action-type=other_edit]"),goal:o("div[node-type=edit_menu]")});o(e.menu).bind("enter",function(){if(it.clip)e.clip.reposition();if(o.browser.msie)I.resetTitle(e.title)});e.menu.init()}},editMenu:new F.editMenu,RightBar:new F.RightBar,userBox:new F.userBox,staticUpdate:function(e){var t=this;t.userBox.model.set("AlbumDB",e);t.userBox.render()},updateTags:function(e){var t="照片已推荐至:<span>",n="";e.forEach(function(e){n+="<em>"+e+"</em>"});if(n===""){o("[node-type=photo_tags]").hide();return""}else{o("[node-type=photo_tags]").show()}t+=n+"</span>";return t},InitAddTotags:function(){var e=this;o("[node-type=photo_tags]").html("");if($GLOBAL_INFO["is_editor"]&&V["type"]!=3&&V["type"]!=18&&V["type"]!=32&&V["type"]!=42&&V["property"]==1){e.getPhotoTags(X["photo_id"],function(t,n){if(n.result){o("div[node-type=picManage]").show();o("[node-type=photo_tags]").html(e.updateTags(n.data.tags))}else{o("div[node-type=picManage]").hide()}})}else{o("div[node-type=picManage]").hide()}},Desc:new F.Desc({icons_limits:Y}),Persons:new F.Persons,Exif:new F.Exif,updateDesc:function(e){var t=this;t.Desc.render();t.Desc.set({Photo:it,commentEl:"["+it.detail_comment._dom["comment_txt"]+"]"});t.Exif.render();if(z)t.createCrumbs();var n=V["caption"];o("[node-type=album_name]").html("<span>"+n+"<span>");n=o("<div>").html(n).text();o("[node-type=album_name]").attr("title",n);var r=V["type"]==3?u.baseURL+V["uid"]+"/talbum/index":u.baseURL+V["uid"]+"/albums/detail/album_id/"+V["album_id"]+(V["type"]==45?"?prel=p5_face":"");o("[action-type=album_url]").attr({href:r});var i=o("div[node-type=content_album]");var s=o("div[node-type=content_likes]");if(i.attr("class")=="content show_album"){i.find(".M_arrw_lf").hide()}else{i.find(".M_arrw_lf").show()}if(s.attr("class")=="content show_album"){s.find(".M_arrw_lf").hide()}else{s.find(".M_arrw_lf").show()}o("[node-type=photo_counts]").text("共"+V["count"]["photos"]+"张").attr("href",r).show();I.addTagItem(e["tags"],e["uid"]!=$GLOBAL_INFO["account_uid"],true)},delTagItem:function(e){if(o("a.tag[data-tagid="+e+"]").siblings().length===0){o("a.tag[data-tagid="+e+"]").parent().html('<span class="no_tag" node-type="no-tag">暂无标签</span>')}o("a.tag[data-tagid="+e+"]").remove()},updateDetail:function(e,t){var n=this;q.getPhotoDetail(e,function(r){X=r;X["uid"]=X["like_uid"]?X["like_uid"]:X["uid"];s.isSelf=X["uid"]==$GLOBAL_INFO["account_uid"]?true:false;var i=r["type"]==15?3:1;q.getAlbumDetail(r["album_id"],i,function(i){V=i;n.RightBar.render();n.editMenu.render();n.detailMuen();if(t=="root")n.commonUpdate(r,true);else n.commonUpdate(r);n.detail_comment.setConf({target_id:e,type:r["type"],album_id:i["album_id"],album_type:i["type"],comment_uid:r["uid"],like_total:r["count"]["likes"],hasRep:r["visible_type"]==et||i["property"]!=1||r["visible_type"]==nt||r["visible_type"]==tt||r["visible_type"]==Z?false:true,comment_total:r["count"]["comments"],like_uid:r["uid"]});o("a["+n.detail_comment._dom["back_all"]+"]").trigger("click");if(n.currentID!=n.AlbumBox.currentId&&z){n.getAlbumIds(i["uid"],i["album_id"],i["type"],function(t,r){j.initCachePhoto(r.data);n.AlbumBox.album_type=i["type"];n.AlbumBox.update(e,false,true)})}else if(n.currentID!=n.AlbumBox.currentId&&n.isInBox("[node-type=content_album]")){n.AlbumBox.update(e,false,true,n.direction)}else{n.AlbumBox.update(e,false,true)}if(n.likeBox&&n.currentID!=n.likeBox.currentId&&n.isInBox("[node-type=content_likes]")){n.likeBox.update(e,false,true,n.direction)}else if(n.likeBox&&n.currentID!=n.likeBox.currentId){n.likeBox.update(e,false,true)}n.staticUpdate(V);n.operate_menu()})})},isInBox:function(e){return o(e).find("li.cur").length?true:false},updatePage:function(e,t){var n=this;if(n.ajaxtimer){clearTimeout(n.ajaxtimer);n.ajaxtimer=null}n.ajaxtimer=setTimeout(function(){n.direction=t;n.currentID=e;n.hasTip=false;if(z){n.getLikeDetail(e,function(r){var i=n.findLikeIndex(e,r.photos_list);i["album_id"]=V["album_id"];i["album_type"]=V["type"];j.setLike(e,i);X=i;X["uid"]=X["like_uid"]?X["like_uid"]:X["uid"];n.AlbumBox.uid=X["like_uid"];n.AlbumBox.type=X["type"];n.AlbumBox.album_id=X["album_id"];n.updateDetail(e,t)})}else{n.updateDetail(e,t)}},150)},commonUpdate:function(e,t){var n=this;var r=e["photo_id"];if(!t)window.location.hash=r;n.createBigImg(e);n.updateDesc(e);n.Persons.render();n.setMap(e);n.updatefavorites(e["is_favorited"]);n.updateReport(r,e["uid"],e["type"]);n.updatePre(e);I.emStyle();n.initBiglike(e);n.updateLikeStat(e);n.InitAddTotags()},setCurSor:function(e,t){if(t=="left"){o(e).removeClass("M_cur_ph_next").addClass("M_cur_ph_prev")}else{o(e).removeClass("M_cur_ph_prev").addClass("M_cur_ph_next")}},commonTurn:function(e){var t=this;var n=t.AlbumBox.lock,r=t.AlbumBox.nextid,i=t.AlbumBox.previd,s=t.AlbumBox.nextflag,o=t.AlbumBox.prevflag;if(n){setTimeout(function(){t.commonTurn(e)},100);return}if(z){var a=u.baseURL+X["uid"],f=X["type"]==15?a+"/talbum/detail/photo_id/":a+"/photos/detail/photo_id/";if(e=="left"){if(!i)return;window.location.href=f+i}else if(e=="right"){if(!r)return;window.location.href=f+r}}else{if(e=="left"){if(!i&&o==undefined||!i&&!o["flag"]){I.isLogin(function(){H.miniTip("已经没有上一页了哦",{autoClose:1e3})});return}else if(o&&o["flag"]){t.activePage();t.disablePage("无权限",o["flag"]);t.setMap({});t.AlbumBox.currentId=o["photo_id"];t.AlbumBox.getOnePic("left",false,true,{uid:$GLOBAL_INFO["owner_uid"]});return}t.updatePage(i,"left")}else if(e=="right"){if(!r&&s==undefined||!r&&!s["flag"]){I.isLogin(function(){t.lastTip()});return}else if(s&&s["flag"]){t.activePage();t.disablePage("无权限",s["flag"]);t.setMap({});t.AlbumBox.currentId=s["photo_id"];t.AlbumBox.getOnePic("right",false,true,{uid:$GLOBAL_INFO["owner_uid"]});return}t.updatePage(r,"right")}}},likeTurn:function(e){var t=this;var n;var r=t.likeBox.lock,i=t.likeBox.nextid,s=t.likeBox.previd,o=t.likeBox.nextflag,u=t.likeBox.prevflag;if(r){setTimeout(function(){t.likeTurn(e)},100);return}if(e=="left"){if(s==undefined){if(u[0]=="0"||u[0]>1){t.updateDisable(u[1])}t.likeBox.currentId=u[1]["target_id"];t.likeBox.getOnePic("left",false,true,{uid:$GLOBAL_INFO["owner_uid"]});return}else if(!s){H.miniTip("已经没有上一页了哦",{autoClose:1e3});return}t.updatePage(s,"left")}else if(e=="right"){if(i==undefined){if(o[0]=="0"||o[0]>1){t.updateDisable(o[1])}t.likeBox.currentId=o[1]["target_id"];t.likeBox.getOnePic("right",false,true,{uid:$GLOBAL_INFO["owner_uid"]});return}else if(!i){t.lastTip();return}t.updatePage(i,"right")}},disablePage:function(e,t){var n=this,r='<p class="txt txt_c">您没有权限查看这张照片哦~~</p>';o("[node-type=detail_comment]").hide();o("[action-type=top_edit]").addClass("M_btn_disb");o("[node-type=photo_info]").hide();o("[node-type=edit_muen]").css("visibility","hidden");o("[node-type=right_bar]").html("");o("[node-type=prettify]").hide();if(z){o("[node-type=content_album]").hide();o("[node-type=content_album]").before('<p class="M_txte no_admit" id="content_album_disabled">'+e+"</p>")}o("[action-type=more_exif]").addClass("M_linkf").attr("action-type","more_exif_disabled");o("[node-type=exif]").html('<p>相机型号:&nbsp;&nbsp;<span class="M_txte">'+e+'</span></p><p>拍摄日期:&nbsp;&nbsp;<span class="M_txte">'+e+"</span></p>");o("[node-type=tag_list]").after('<p class="M_txte no_admit" id="tag_disabled">'+e+"</p>");o("[node-type=tag_list]").hide();o("[action-type=add_tag]").hide();o("[node-type=zoning_list]").html('<p class="M_txte no_admit" id="zoning_disabled">'+e+"</p>");o("[action-type=add_zoning_photo]").addClass("M_btn_disb M_btn_point_dis").attr("action-type","add_zoning_photo_disabled");o("[node-type=property_node]").parent().html('<span class="M_ico M_icon22" node-type="property_node"></span><span class="M_txte no_admit">'+e+"</span>");o("[node-type=bigImgWrap],[node-type=bigImgWrap] > *").css("visibility","hidden");o("[node-type=bigImgWrap]").height(0).css({overflow:"hidden","margin-bottom":"0px"});if(t=="0")r='<p class="txt txt_b">这张照片已被删除了哦~~</p>';o("[node-type=bigImgWrap]").before('<div style="margin-top:0px;" class="m_photo_miss" id="miss_tip">                <div class="photo_miss_con">                    <p class="txt txt_a">抱歉</p>'+r+"                </div>            </div>");n.isdisablePage=true},activePage:function(){var e=this;o("[node-type=detail_comment]").show();o("[action-type=top_edit]").removeClass("M_btn_disb");o("[node-type=photo_info]").show();o("[node-type=edit_muen]").css("visibility","visible");o("[node-type=prettify]").show();o("[node-type=content_album]").show();o("#content_album_disabled").remove();o("#tag_disabled").remove();o("[node-type=tag_list]").show();o("[action-type=more_exif_disabled]").removeClass("M_linkf").attr("action-type","more_exif");o("[node-type=tag]").show();o("[action-type=add_tag]").show();o("#zoning_disabled").remove();o("[action-type=add_zoning_photo_disabled]").removeClass("M_btn_disb M_btn_point_dis").attr("action-type","add_zoning_photo");o("[node-type=bigImgWrap],[node-type=bigImgWrap] > *").css("visibility","visible");o("[node-type=bigImgWrap]").height("auto").css("overflow","none");o("#miss_tip").remove();e.isdisablePage=false},updateDisable:function(e){var t=this;var n=e["flag"]=="0"?"— —":"无权限";t.activePage();t.disablePage(n,e["flag"]);t.setMap(e);e=o.extend(e,{uid:e["like_uid"]});t.userBox.model.set("AlbumDB",e);t.userBox.render()},clickTurn:function(e){var t=this,n=o("[node-type=content_album]").find(".m_thumbnail").css("display");if(!t.AlbumBox)return;if(n!="none"){t.commonTurn(e)}else{t.likeTurn(e)}},lastTipView:new F.lastTip,lastTip:function(){var e=this;j.getrecommendAlbum(6,function(t){j.getAllAlbums($GLOBAL_INFO["owner_uid"],function(n){e.lastTipView.set({Photo:e,album:n,recommend:t,isLikePage:z,likesIds:U,commonIds:R});e.lastTipView.render()})})},imageOnclick:function(e){var t=e.target,n=it.$like[0],r=o.contains(n,t),i=o(t).closest(".L_qr_person").length;if(i===0&&!r&&t!==n){var s={left:function(){it.clickTurn("left")},right:function(){it.clickTurn("right")}};var u=s[it.foward];if(u){u();it.hasTip=false}}},ImageCache:{},loadOver:function(e,t){var n=this;n.setSize("#bigImg");o(t).attr("is_load",1).zoningInitDiv(e["persons"],e["type"]);n.updateOperateBar(e);n.updateLikeStat(e);o("#bigImgWrap").removeClass("M_loading").removeClass("img_warp_load");o("[node-type=photo]").trigger("mousemove");n.hiddenPicBarToggle()},setBigImg:function(e,t,n){var r=this;o("#bigImg").remove();if(r.loadtimer)clearTimeout(r.loadtimer);o("#bigImgWrap").addClass("img_warp_load");var s=o('<img id="bigImg">').attr({is_load:n,src:e}).css({width:"inherit",height:"inherit"});o("#bigImgWrap").html(s);var u=t.pic_pid,a=i.getImgGeometry(u);if(u&&a){var f=o("#bigImg"),l=a.width,c=a.height;if(l>690){c=parseInt(690/l*c,10);l=690}f.css({width:l,height:c});r.loadOver(t,f[0])}else{function h(){var e=100,n=o("#bigImg");if(n[0]){r.activePage();var i=n[0].readyState?n[0].readyState=="complete":s[0].complete;if(i&&n.height()&&n.width()){r.loadOver(t,n[0])}else{r.loadtimer=setTimeout(h,e)}}else{r.loadtimer=setTimeout(h,e)}}h()}if(o.browser.msie){o("#bigImg").parent().attr("unselectable","on")}O("body")},setSize:function(e){this.size={width:o(e).width(),height:o(e).height()}},createBigImg:function(e){var t=this,n=A(e,"mw690");var r=o("#bigImgWrap");r.addClass("M_loading");if(V.type==45){r.attr("suda-uatrack","key=tblog_page_image&value=face_right_picture")}r.off("selectstart dragstart contextmenu",rt);if(e.property=="11"){r.on("selectstart dragstart contextmenu",rt)}if(t.hasZoning)t.delZoning();o(".L_qr_person").remove();if(!t.ImageCache[n]){t.ImageCache[n]=true;t.setBigImg(n,e,0)}else{t.setBigImg(n,e,1)}},reset:function(e){var t=this;o("#bigImg").rotate(0,it.size,true);o(".L_qr_person").show();it.delImgTip();it.rotate=0},turnRight:function(e){var t=o("#bigImg").attr("is_load");if(!t||t=="0"){H.miniTip(b[12011]);return false}if(it.hasZoning){H.miniTip(b[12016]);return false}o(".L_qr_person").hide();o("#bigImg").rotate(90,it.size);o(it).trigger("turn");it.rotate++;if(it.rotate>=4)it.rotate=0;if(it.rotate===0)o(".L_qr_person").show();it.isturn=true;it.hasTip=true;return false},turnLeft:function(e){var t=o("#bigImg").attr("is_load");if(!t||t=="0"){H.miniTip(b[12011]);return false}if(it.hasZoning){H.miniTip(b[12016]);return false}o(".L_qr_person").hide();o("#bigImg").rotate(-90,it.size);o(it).trigger("turn");it.rotate--;if(it.rotate<0)it.rotate=3;it.isturn=true;it.hasTip=true;return false},msgData:{move:[b[12006],b[12007]],cover:[b[11008],b[11009]],avatar:[b[10014],b[10015]],"delete":[b[12002],b[12005]],zoning:[b[16001],b[16003]],movecopy:[b[12006],b[12007]],favorites:[b[14001],b[14007]],unfavorites:[b[14002],b[14008]]},PStatusLock:false,changePhotoStatus:function(e,t){function n(e,n){it.PStatusLock=false;t(function(e,t,r,i){var s=it.msgData[t];if(V["type"]==45&&e==="delete"){s=[b[12020],b[12021]]}if(s){var o=r||{};msg=n["result"]?s[0]:s[1];if(!n["result"]){H.miniTip(n["msg"]||s[1],{status:"error",autoClose:1e3})}else{H[e](msg,o);if(i)i(n);j.unset(X["photo_id"]);j.unsetLike(X["photo_id"])}}},n)}if(it.PStatusLock)return;it.PStatusLock=true;var r=W&&(W=="smart_camera"||W=="tuding")?3:V["type"];var i=o("input#select_id").val();switch(e){case"cover":j.updateCover(X["photo_id"],V["album_id"],V["type"],n);break;case"avatar":j.updateAvatar(X["photo_id"],X["type"],n);break;case"zoning":var s=o("#quanren_value").val(),u=o("#s_wb").attr("checked"),a=u=="checked"?1:0,f=o("input[name=quanren_uid]:checked").val(),l=L(s);j.addRelatedPersons(X["photo_id"],X["uid"],$GLOBAL_INFO["account_uid"],X["type"],a,l["height"],l["width"],l["top"],l["left"],f,l["zindex"],n);break;case"delete":j.photoTrash(X["photo_id"],X["type"],V["type"],n);break;case"moveto":j.updateAlbum(X["photo_id"],i,r,1,n);break;case"movecopy":j.updateAlbum(X["photo_id"],i,r,0,n);break;case"favorites":j.favorite(X["photo_id"],X["uid"],X["type"],V["album_id"],V["type"],n);break;case"unfavorites":j.disfavorite(X["photo_id"],X["type"],V["album_id"],V["type"],n);break;default:throw new Error("status is must be definitely")}},copyTo:function(e){e.preventDefault();j.getAllAlbums(V["uid"],function(e){var t,n=[],r='<div class="L_movephoto">								<dl class="chose_slt clearfix">                                	<dt>将照片复制到</dt>                                    <dd></dd>                                </dl>                                <div class="submit_centr"><a href="#" action-type="ok" class="M_btn_e"><span>确定</span></a><a href="#" action-type="cancel" class="M_btn_e"><span>取消</span></a></div>							</div>';t=e.album_list;o.each(t,function(e,t){if(!!t){if(t["type"]!="18"&&t["type"]!="3"&&t["type"]!="32"&&t["type"]!="42"&&t["album_id"]!=V["album_id"]){var r=t["caption"].cutString(14,"...").toString();n.push({name:r,title:t["caption"],id:t["album_id"]})}}});H.customTip(r,{ok:function(){var e=o("#select_id").val();if(o("#select_id").length){var n=st(e,t);var r=n.property;var i=n.type;var s=X["visible_type"];var a=X["photo_id"];var f="确定将微博配图复制到此专辑吗？";if(r!=1||s!=0){if((r!=2||s!=nt)&&(r!=4||s!=Z)){f="确定将"+(s!=0?"隐私图片":"微博配图")+"复制到"+Y(r,i)[0]+"的专辑吗?"}}H.confirm(f,{ok:function(){H.miniTip("照片正在复制中…",{autoClose:false,status:"loading",auto:true});d(u.baseURL+"albums/batch_update_album",function(e,t){if(t.result){H.miniTip("复制照片成功",{status:"success",autoClose:1500})}else{H.miniTip(t.msg,{status:"error",autoClose:1500})}},{photo_id:a,album_id:V["album_id"],target_id:e,type:V["type"],do_delete:0},"post")}})}}});var i=H.popLay.find("dd");var s=H.popLay.find("dl");if(n.length){i.select({selectedIndex:0,inputName:"album_id",zIndex:0,adapter:n})}else{s.css("text-align","center").html("您还没有其他专辑")}})},moveTo:function(e){e.preventDefault();j.getAllAlbums(V["uid"],function(e){function r(){var e=u.baseURL+$GLOBAL_INFO["owner_uid"];var t=V["type"]==3?e+"/talbum/detail/photo_id/":e+"/photos/detail/photo_id/";var n=V["type"]==3?e+"/talbum/index":e+"/albums/detail/album_id/"+V["album_id"];if(W&&W=="smart_camera"){t=e+"/photos/smart_camera/photo_id/"}if(W&&W=="tuding"){t=e+"/photos/tuding/photo_id/"}if(it.AlbumBox["nextid"]){window.location.href=t+it.AlbumBox["nextid"]}else if(it.AlbumBox["previd"]){window.location.href=t+it.AlbumBox["previd"]}else{window.location.href=n}}function i(){it.changePhotoStatus("moveto",function(e){e("miniTip","move",{autoClose:1e3},function(e){r()})})}function s(){it.changePhotoStatus("movecopy",function(e){e("miniTip","movecopy",{autoClose:1e3},function(e){})})}function f(e,t){var n={32:"三星智能相机专辑",42:"图钉相册",3:"微博配图专辑"};var r='<div class="L_prompt">                            <div class="prompt M_txtc">                                <span class="mk_ico mk_remind"></span><span class="cont">确定将照片从'+n[t]+"移动到"+Y(e,t)[0]+'的专辑吗？</span>                                <div style="padding-top:10px;"><label><input type="checkbox" id="is_del" style="vertical-align: middle;"> 删除原图、原微博？</label></div>                            </div>                            <div class="submit_centr"><a class="M_btn_e" action-type="ok" href="#"><span>确定</span></a><a class="M_btn_e" action-type="cancel" href="#"><span>取消</span></a></div>                        </div>';H.customTip(r,{ok:function(){if(a){i()}else{s()}}});o("#is_del").die().live("click",function(){var e=!!o(this).attr("checked");if(e)a=true;else a=false})}var t,n='<div class="L_movephoto">								<dl class="chose_slt clearfix">                                	<dt>将照片移动到</dt>                                    <dd></dd>                                </dl>                                <div class="submit_centr"><a href="#" action-type="ok" class="M_btn_e"><span>确定</span></a><a href="#" id="J_cancel" action-type="cancel" class="M_btn_e"><span>取消</span></a></div>							</div>';var a=false;H.customTip(n,{ok:function(){if(o("#select_id").length){var e=st(o("#select_id").val(),t).property;var n=st(o("#select_id").val(),t).type;var r=V["property"];if(V["type"]=="3"||V["type"]=="32"||V["type"]=="42"){f(e,V["type"])}else{var s=b[12010];if(e!=r){s="确定将"+Y(V["property"],V["type"])[0]+"的照片移动到"+Y(e,n)[0]+"的专辑吗?"}H.confirm(s,{ok:function(){i()}})}}}});var l=H.popLay.find("dd");var c=H.popLay.find("dl");var h=[],p=0;t=e.album_list;o.each(e.album_list,function(e,t){if(!!t){if(t["type"]!="18"&&t["type"]!="3"&&t["type"]!="32"&&t["type"]!="42"&&t["album_id"]!=V["album_id"]){var n=t["caption"].cutString(14,"...").toString();h.push({name:n,title:t["caption"],id:t["album_id"]})}}});if(h.length){l.select({selectedIndex:p,inputName:"album_id",zIndex:0,adapter:h})}else{c.css("text-align","center").html("您还没有其他专辑");c.closest(".L_movephoto").find("#J_cancel").hide()}})},setCover:function(e){e.preventDefault();it.changePhotoStatus("cover",function(e){e("miniTip","cover",{autoClose:1e3})})},setAvatar:function(e){e.preventDefault();it.changePhotoStatus("avatar",function(e){e("miniTip","avatar",{autoClose:1e3})})},delPhoto:function(e){e.preventDefault();var t=V.type==45?b["12019"]:b[12001];if(X["type"]==15)t=b[12017];if(V["type"]==45)t=b[12019];H.confirm(t,{ok:function(){it.changePhotoStatus("delete",function(e){e("miniTip","delete",{autoClose:1e3,status:"success"},function(e){var t=$GLOBAL_DETAIL["album_photo_ids"];var n=u.baseURL+$GLOBAL_INFO["owner_uid"];var r=function(){if(V["type"]==3)return n+"/talbum/detail/photo_id/";if(V["type"]==32)return n+"/photos/smart_camera/photo_id/";if(V["type"]==42)return n+"/photos/tuding/photo_id/";return n+"/photos/detail/photo_id/"}();var i=function(){if(V["type"]==3)return n+"/talbum/index";return n+"/albums/detail/album_id/"+V["album_id"]}();if(e.data.length>=t.length||z){window.location.href=i}else{var s=function(){var t={};for(var n=0;n<e.data.length;n++){t[e.data[n]]=true}return t}();var o=[],a,f,l;for(l=0;l<t.length;l++){var c=t[l];if(s[c])s[c]=[l,c]}for(l in s){o.push(s[l])}o.sort(function(e,t){return e[0]-t[0]});f=o[0][1];a=o[o.length-1][1];for(l=t.length;l>=0;l--){if(f==a){if(t[l]==f&&t[l+1]){window.location.href=r+t[l+1]+"/album_id/"+V["album_id"];break}else if(t[l]==f&&t[l-1]){window.location.href=r+t[l-1]+"/album_id/"+V["album_id"];break}}else{if(t[l]==a&&t[l+1]){window.location.href=r+t[l+1]+"/album_id/"+V["album_id"];break}else if(t[l]==f&&t[l-1]){window.location.href=r+t[l-1]+"/album_id/"+V["album_id"];break}}}}})})}})},RecommendTag:new F.RecommendTag,createTagForm:function(e){var t=this,n=X.photo_id,r,i,s;this.tagLocked=false;if(!it.hasTagInit){s=o('<div class="addtag" node-type="tag_area">'+'<div class="txtarea_box clearfix">'+'<div node-type="photo_tags_tag_txtarea" class="addlist m_tag_a"></div>'+'<input type="text" title="标签间以空格隔开" class="M_txte" value="标签间以空格隔开" node-type="single_tag_input" name="tag_txtarea">'+'<input type="hidden" value="" name="tag_txtarea">'+"</div>"+'<div class="m_tag_c" node-type="recommend_tag"></div> <div class="btn_box">'+'<a class="M_btn_c" action-type="tag_add" href="#">确定</a>'+'<a class="cancel" href="#" action-type="tag_close">取消</a>'+"</div>"+"</div>");o(e).after(s);var u=new y(s);i=s.find("input:hidden");r=s.find("input[node-type=single_tag_input]");r.textAuto3(20,/(;|,|；|，|\s)$/);r.bind({keyup:u.onKeyup,blur:function(e){u.onBlur(e,true)},focus:u.onFocus});s.delegate("[action-type=remove_tag]","click",u.removeTag);s.delegate("[action-type=single_add]","click",function(e){var t=this.title;u.createTag(t,n,i);e.preventDefault()});it.hasTagInit=true}r=o("[node-type=single_tag_input]");if(!it.hasTag){s=o("[node-type=tag_area]");s.show();s.find("[node-type=photo_tags_tag_txtarea]").html("");s.find("input:hidden").val("");it.hasTag=true;r.val("")}r.get(0).focus()},addTag:function(e){var t=o(this).attr("node-type");if(!k.isLogin()){m();return false}if(!t){O('div[node-type="tag_box"]')}it.createTagForm("div[node-type=tag_box]");it.RecommendTag.render();o("[node-type=tag]").hide();return false},closeTag:function(e){o("[node-type=tag_area]").hide();it.RecommendTag.destroy();it.hasTag=false;o("[node-type=tag]").show();return false},zoningPhoto:function(e){function t(){var e=o("#bigImg").attr("is_load");if(!e||e=="0"){H.miniTip(b[12011],{autoClose:1e3,status:"error"});return}if(it.size.width<100||it.size.height<100){H.alert(b[12012]);return}if(it.isturn){it.reset()}if(!it.hasZoning){o("body").append('<div class="L_resize">');o("#bigImg").zoning();it.hasZoning=true}}if(!k.isLogin()){m();return false}if(s.isSelf){t()}else{j.isBilateral(X["uid"],function(e,n){if(n.result){t()}else{I.isLogin(function(){H.miniTip("相互关注才可以圈人哦",{status:"remind"})})}})}it.updateOperateBar();return false},delZoning:function(){o("#bigImg").zoning({instance:true,remove:true});it.hasZoning=false;return false},saveZoning:function(e){if(o("input[name=quanren_uid]:checked").length===0){H.alert(b[10011])}else{it.changePhotoStatus("zoning",function(e,t){e("miniTip","zoning",{autoClose:1e3,status:"success"});it.delZoning();o("#bigImg").zoningInitDiv([t.data],X["type"]);X["persons"].push(t.data);j.set(it.currentID,X);j.set("PhotoDB",X);it.Persons.render()})}return false},delImgTip:function(){o("#J_ImgTip").remove();it.hasTip=false},creatImgTip:function(e){if(!it.hasTip){var t=B.find('[node-type="bigImgWrap"]'),n='<div class="m_yllw_tips" id="J_ImgTip" style="z-index:99999;">'+'<p class="tips M_txtc">'+e+"</p>"+'<span class="save"><a href="#" class="M_btn_c" action-type="img_save">保存</a><a href="#" action-type="img_cancel">取消</a></span>'+"</div>";t.prepend(n);it.hasTip=true}},turnSuccess:function(e,t,n){if(s.isSelf&&V["type"]!=3&&V["type"]!=32&&V["type"]!=42){this.creatImgTip("照片已经旋转，请保存！")}this.updateOperateBar();o("#bigImgWrap").find("[node-type=operate_area]").removeClass("m_pho_operate_act").width("auto")},ImgTipLoading:function(){o("#J_ImgTip").html('<div style="display:block" class="M_loading_a clearfix"><span>正在保存，请稍候...</span></div>')},turnSave:function(){if(it.turnlock)return false;it.turnlock=true;if(it.rotate===0){it.delImgTip();it.isturn=false;it.turnlock=false;return false}it.ImgTipLoading();it.turnAction(it.rotate,function(e){it.delImgTip();it.isturn=false;H.miniTip(b[10001],{autoClose:1e3});it.rotate=0;setTimeout(function(){window.location.reload()},500)});return false},imgcancel:function(e){it.reset();it.updateOperateBar();return false},intransit:function(e,t){_.forwardDialog(e,t);return false},getLikers:function(e,t,n){j.getLikers(e,X["uid"],t,8,1,n)},getLikeAround:function(e,t,n){var r=this;j.getLikersPhotos(e,t,$GLOBAL_INFO["owner_uid"],n)},getLikeDetail:function(e,t){var n=this;var r=j.getLike(e);if(r){j.successhandle(null,{result:true,data:{total:U.length,photos_list:[r]}},t)}else{j.getLikeDetail(e,$GLOBAL_INFO["owner_uid"],function(e,n){j.successhandleLike(e,n,t)})}},getAllPhotos:function(e,t,n,r,i){var s=this;var o=$GLOBAL_INFO["owner_uid"];if(z)o=X["like_uid"]||X["uid"];var u=i||1;j.getAllPhotos(e,o,t,n,u,r)},addTagAction:function(e,t){var n=this;if(n.tagLocked)return;n.tagLocked=true;j.addTags(X["photo_id"],t,X["type"],V["album_id"],V["type"],function(t,r){n.tagLocked=false;j.successhandle(t,r,e,true);j.unset(X["photo_id"]);j.unsetLike(X["photo_id"])})},delTagAction:function(e,t){var n=this;j.deleteTags(X["photo_id"],t,X["type"],V["album_id"],V["type"],function(t,n){j.successhandle(t,n,e,true);j.unset(X["photo_id"]);j.unsetLike(X["photo_id"])})},turnAction:function(e,t){var n=this;j.rotate(X["photo_id"],e,function(e,r){n.turnlock=false;if(r.result){j.successhandle(e,r,t,true)}else{H.miniTip(r.msg||b[12014],{autoClose:1e3,status:"error"})}})},upslide:function(e,t){for(var n=0;n<e.length;n++){if(e[n]["photo_id"]==t["photo_id"]){e[n]=t;break}}},updateComment:function(e){var t=this;if(e==1){t.detail_comment.update(1,true)}else if(e==2){t.detail_comment.updateCOM(1,true)}else if(e==3){t.detail_comment.updateLike(1,true)}},likeflag:true,getTags:function(e){d(u.baseURL+"editor/get_editor_tags",e)},saveToTags:function(e,t,n,r){d(u.baseURL+X["uid"]+"/tags/post_photo_tag",r,{photo_id:e,tag_id:t,type:n},"post")},getPhotoTags:function(e,t){d(u.baseURL+"photos/get_photo_tags?photo_id="+e,t,null,"get")},addToTag:function(){var e=this;if($GLOBAL_INFO["is_editor"]){var t='<div class="L_movephoto">								<dl class="chose_slt clearfix">                                	<dt>将照片投稿到</dt>                                    <dd></dd>                                </dl>                                <div class="submit_centr"><a href="#" action-type="ok" class="M_btn_e"><span>确定</span></a><a href="#" id="J_cancel" action-type="cancel" class="M_btn_e"><span>取消</span></a></div>							</div>';e.getTags(function(n,r){if(r.result){H.customTip(t,{ok:function(){var t=o("input#select_id").val();e.saveToTags(X["photo_id"],t,X["type"],function(t,n){if(n.result){H.miniTip("推荐标签成功",{status:"success",autoClose:1500});e.getPhotoTags(X["photo_id"],function(t,n){if(n.result){o("[node-type=photo_tags]").html(e.updateTags(n.data.tags))}})}else{H.alert(n.msg)}})}});var i=H.popLay.find("dd");var s=H.popLay.find("dl");var u=[],a=0,f=r.data;o.each(f,function(e,t){var n=t["name"].cutString(14,"...").toString();u.push({name:n,title:t["name"],id:t["tag_id"]})});if(u.length){i.select({selectedIndex:a,inputName:"tag_id",zIndex:0,adapter:u})}else{s.css("text-align","center").html("您还没有可操作的标签");s.closest(".L_movephoto").find("#J_cancel").hide()}}else{H.alert(r.msg)}})}else{H.alert("您不是小编噢~")}},hiddenPicBarToggle:function(){var e=this;e.$like&&e.$like.css("visibility","hidden")},PicBarToggle:function(e){var t=this;t.$like&&t.$like.css("visibility","visible")},bindAction:function(){function n(e){clearTimeout(t);o(".L_qr_person").css({border:"0px"});o(".L_qr_person").find(".inner").css("visibility","hidden");o("#person"+e).css({border:"1px solid #250203"});o("#person"+e).find(".inner").css("visibility","visible")}function r(e){var n=o("#person"+e);t=setTimeout(function(){o(".L_qr_person").css({border:"0px"});o(".L_qr_person").find(".inner").css("visibility","hidden");n.css({border:"0px"});n.find(".inner").css("visibility","hidden")},100)}function f(t,n){var r=[];var i=[];var s=[];var o=Math.ceil(t/100);r.length=o;for(var u=0;u<r.length;u++){r[u]=100}r[r.length-1]=t%100;for(var a=1;a<=r.length;a++){(function(t){e.getAllPhotos(V["album_id"],3,r[t-1],function(e){o--;s[t-1]=e["photo_list"];if(o===0){i=i.concat.apply(Array,s);i.shift();n(i)}},a)})(a)}}var e=this,t;o("[node-type=report]").bind("click",function(){var e=o(this).attr("data-url");window.open(e,"newwindow","height=700, width=550, toolbar =no, menubar=no, scrollbars=no, resizable=no, location=no, status=no");return false});o("a[action-type=addToTag]").bind("click",function(){e.addToTag();return false});o("[node-type=zoning_per]").live("mouseover",function(){var e=o(this).attr("data-id");n(e)}).live("mouseout",function(){var e=o(this).attr("data-id");r(e)});o("[action-type=zoning_click]").live("click",function(e){e.stopPropagation();if(!k.isLogin()){m();return false}return true});o("[node-type=edit_muen] a").live("click",function(){I.isLogin()});o("[action-type=turn_left]").live("click",this.turnLeft);o("[action-type=turn_right]").live("click",this.turnRight);o("[action-type=move_to]").live("click",this.moveTo);o("[action-type=set_cover]").live("click",this.setCover);o("[action-type=set_avatar]").live("click",this.setAvatar);o("[action-type=del_photo]").live("click",this.delPhoto);o("[action-type=add_tag]").live("click",this.addTag);o("[action-type=add_zoning_photo_disabled]").live("click",function(){return false});o("[action-type=copy_to]").live("click",this.copyTo);var i=new T("Left"),s=new T("Right");i.init();s.init();o(s).bind("keyfire",function(){e.clickTurn("right")});o(i).bind("keyfire",function(){e.clickTurn("left")});o("[action-type=add_zoning_photo]").live("click",this.zoningPhoto);o("[action-type=intransit]").live("click",function(){if(parseInt(V["property"],10)!=1||X["visible_type"]==Z||X["visible_type"]==et||X["visible_type"]==tt||X["visible_type"]==nt)return false;I.isLogin(function(){e.intransit({who:X["name"],photoId:e.currentID,uid:X["uid"],albumID:V["album_id"],album_type:V["type"],img:A(X,"thumb150"),url:A(X,"thumb150"),caption:V["caption"],target_id:e.currentID,target_uid:X["uid"],type:X["type"]==15?15:2,afterEvent:function(t){o("[node-type=intransit]").html('<span node-type="intransit" class="M_ico M_icon4" action-type="intransit"></span>'+t["retweet_count"]);e.detail_comment.destroyMixAllCache();e.detail_comment.update(1,true);j.unset(X["photo_id"]);j.unsetLike(X["photo_id"])}},true)});return false});o("[node-type=bigImgContainer],#miss_tip").on("click","[node-type=photo]",this.imageOnclick);o("[action-type=img_save]").live("click",this.turnSave);o("#bigImgWrap").on("click",'[action-type="img_cancel"]',this.imgcancel);o("[action-type=zoning_cancel]").live("click",this.delZoning);o("[action-type=zoning_save]").live("click",this.saveZoning);o("[action-type=tag_close]").live("click",this.closeTag);var a=o("#bigImgWrap");o("[node-type=bigImgContainer]").on("mouseleave mouseenter mousemove mouseover mouseup mousedown","[node-type=photo]",function(t){if(!e.isdisablePage){t.preventDefault();e.PicBarToggle()}});o("[node-type=bigImgContainer]").on("mousemove","[node-type=photo]",function(t){var n=690,r=o("[node-type=photo]"),i=t.clientX,s=r.offset().left;cursorper=(i-s)/n;if(cursorper&&cursorper<=1&&cursorper>=0){if(cursorper<.5)e.foward="left";else if(cursorper>.5)e.foward="right"}e.setCurSor(this,e.foward)});o("[node-type=bigImgContainer]").on("mouseleave","[node-type=photo]",function(){e.hiddenPicBarToggle()});a.on("mouseenter",'[node-type="like_bar"]',function(){if(X.is_liked){var e=o(this);e.attr("title","取消赞")}});a.on("mouseleave",'[node-type="like_bar"]',function(){if(X.is_liked){var e=o(this);e.attr("title","已赞")}});a.on("click","a[node-type=like_bar]",function(t){I.isLogin(function(){function s(){var i=o(n),s="",a="likes/like",f="error",l="赞失败",c;if(X["is_liked"]){a="likes/dislike";c=true}else{c=false}d(u.baseURL+a,function(n,i){if(i&&i.result){l=X["is_liked"]?"取消赞成功！":"赞成功！";f="success";var s=i.data.like_total;if(r&&!X["is_liked"]&&V["property"]==1&&X["visible_type"]!=Z&&X["visible_type"]!=et&&X["visible_type"]!=nt&&X["visible_type"]!=tt){e.Mylike.likeTip.call(e.Mylike,t,function(){},{target_id:X["photo_id"],like_uid:X["uid"],type:X["type"],is_private:X["is_private"],is_feed:i.data.result.is_feed,property:X["property"],album_id:V["album_id"],album_type:V["type"]})}else if(!X["is_liked"]){e.Mylike.like_feed.call(e.Mylike,{target_id:X["photo_id"],like_uid:X["uid"],type:X["type"],is_private:X["is_private"],is_feed:i.data.result.is_feed,property:X["property"],album_id:V["album_id"],album_type:V["type"]})}X["is_liked"]=c?false:true;X.like_total=s;e.updateLikeStat(X);e.Mylike.setLikeView.success("[node-type=like_small]",s,X["is_liked"]);var u=o("[action-type=biglike]"),a=u.find("em"),h=u.find(".bg>span");if(X["is_liked"]){h.attr("class","M_ico M_icon7_on")}else{h.attr("class","M_ico M_icon7")}a.text(s);if(e.detail_comment){e.detail_comment.destroyMixAllCache();e.updateComment(e.detail_comment.mode)}if(e.allList){if(e.allList&&e.allList["photo_list"]){e.upslide(e.allList["photo_list"],X)}else{e.upslide(e.allList,X)}}}if(!r||!X["is_liked"]||V["property"]!=1||X["is_private"]){H.miniTip(i.msg||l,{status:f,autoClose:1500})}e.likeflag=true},{target_id:X["photo_id"],like_uid:X["uid"],type:X["type"],album_id:V["album_id"],album_type:V["type"]})}if(!e.likeflag)return;e.likeflag=false;var n=t.target;var r=$GLOBAL_INFO["account_settings"]["like_tip"];var i=X["photo_id"];s()});j.unset(X["photo_id"]);j.unsetLike(X["photo_id"]);return false});o("a[action-type=tag_add]").live("click",function(){if(!k.isLogin()){m();return false}var t=o("input:hidden[name=tag_txtarea]").val();if(o.trim(t)===""){H.alert(b["17002"]);return false}var n=t.split(/\s/),r=X["tags"].split(/\s/),i=n.length+r.length,s={},u=[],a,f=0;var l=[];for(a=0;a<r.length;a++){l.push(r[a].decodeHTML())}u=n.concat(l);for(a=0;a<u.length;a++){if(!s[u[a]]){s[u[a]]=u[a];f++}}if(f<i){H.alert(b[17001]);return false}e.addTagAction(function(n){X["tags"]=u.join(" ");I.addTagItem(t,X["uid"]!=$GLOBAL_INFO["account_uid"],false);e.closeTag()},t);return false});o("span[action-type=tag_del]").live("click",function(){if(!k.isLogin()){m();return false}var t=o(this).closest("a").attr("title"),n=o(this).closest("a").attr("data-tagid");e.delTagAction(function(r){var i=X["tags"].split(" ");for(var s=0,u=i.length;s<u;s++){if(i[s].decodeHTML()==t){i.splice(s,1);break}}X["tags"]=o.trim(i.join(" "));e.delTagItem(n)},t);return false});o("#bigImgWrap").closest("dl").on("click","a[action-type=slide_open]",function(){I.isLogin(function(){function t(t,n){if(n){e.slide.update(X["photo_id"],t["photo_list"]||t,1,V.count.photos,V);return}e.slide=new p({current:e.currentID,current_photo:X,total:V.count.photos,albumdata:V,data:t["photo_list"]||t,inpage:1});e.slide.closeCallback=function(t,n){e.detail_comment.destroyMixAllCache();e.detail_comment.update(1,true,function(){o(e.detail_comment).trigger("insertAfter",[e.detail_comment.total])});e.updatePage(t)};o(e.slide).bind("fire:photo_like",function(t,n,r,i){if(n==X["photo_id"]){X["is_liked"]=r;e.Mylike.setLikeView.success("[node-type=like_small]",i,X["is_liked"]);var s=o("[action-type=biglike]"),u=s.find("em"),a=s.find(".bg>span");if(r){a.attr("class","M_ico M_icon7_on")}else{a.attr("class","M_ico M_icon7")}u.text(i);e.likeflag=true;if(e.detail_comment){e.detail_comment.destroyMixAllCache();e.updateComment(e.detail_comment.mode)}j.unset(X["photo_id"]);j.unsetLike(X["photo_id"])}});o(e.slide).bind("fire:album_like",function(e,t,n,r){V["is_liked"]=n;V["count"]["likes"]=r});o(e.slide).bind("fire:photo_transmit",function(e,t,n,r){o("a[node-type=intransit]").html('<span action-type="intransit" node-type="intransit" class="M_ico M_icon4"></span>'+r)});e.slide.init()}q.getPhotoDetail(e.currentID,function(n){if(!e.slide){var r=X["type"]==15?3:1;if(W&&W=="smart_camera")r=32;if(W&&W=="tuding")r=42;if(r==3&&V["count"]["photos"]>100){f(V["count"]["photos"],function(n){e.allList=n;t(n)})}else{e.getAllPhotos(V["album_id"],r,V["count"]["photos"],function(n){e.allList=n;t(n)})}}else{t(e.allList,true)}})});return false});o("span[action-type=del_zoning]").live("click",function(e){if(!k.isLogin()){m();return false}var t=this,n=o(this).attr("data-id"),r=X["type"];j.deleteRelatedPerson(n,$GLOBAL_INFO["owner_uid"],r,V["album_id"],function(e){H.miniTip(b[16002],{autoClose:1e3});o("#person"+e).remove();if(o(t).closest("li").siblings().length===0){o(t).closest("ul").html('<span node-type="no_person">暂无圈中的人</span>')}else{o(t).closest("li").remove()}X["persons"].forEach(function(t,n){if(t.id==e)X["persons"].splice(n,1)});j.set("PhotoDB",X);j.unset(X["photo_id"]);j.unsetLike(X["photo_id"])});e.stopPropagation();return false});o("a[action-type=biglike]").live("click",function(t){I.isLogin(function(){function s(){var i=o(n),s="M_ico M_icon7",a="likes/like",f="error",l="赞失败",c;if(X["is_liked"]){a="likes/dislike";c=true}else{c=false}d(u.baseURL+a,function(n,u){if(u&&u.result){l=X["is_liked"]?"取消赞成功！":"赞成功！";s=X["is_liked"]?"M_ico M_icon7":"M_ico M_icon7_on";f="success";i.closest("a").find(".bg>span").attr("class",s);var a=u.data.like_total;em=o("[action-type=biglike] em");em.text(a);var h=o('[node-type="like_bar"]'),p=h.find(">a"),d=h.find("i"),v=h.find("span");if(X["is_liked"]){p.attr("title","赞+1");d[0].className="icon_praise";v.text("("+a+")")}else{p.attr("title","已赞");d[0].className="icon_praised";v.text("("+a+")")}if(r&&!X["is_liked"]&&V["property"]==1&&X["visible_type"]==Z&&X["visible_type"]!=et&&X["visible_type"]!=nt&&X["visible_type"]!=tt){e.Mylike.likeTip.call(e.Mylike,t,function(){},{target_id:X["photo_id"],like_uid:X["uid"],type:X["type"],is_private:X["is_private"],is_feed:u.data.result.is_feed,property:X["property"],album_id:V["album_id"],album_type:V["type"]})}else if(!X["is_liked"]){e.Mylike.like_feed.call(e.Mylike,{target_id:X["photo_id"],like_uid:X["uid"],type:X["type"],is_private:X["is_private"],is_feed:u.data.result.is_feed,property:X["property"],album_id:V["album_id"],album_type:V["type"]})}X["is_liked"]=c?false:true;e.Mylike.setLikeView.success("[node-type=like_small]",u.data.like_total,X["is_liked"]);if(e.detail_comment){e.detail_comment.destroyMixAllCache();e.updateComment(e.detail_comment.mode)}if(e.allList){if(e.allList&&e.allList["photo_list"]){e.upslide(e.allList["photo_list"],X)}else{e.upslide(e.allList,X)}}}if(!r||!X["is_liked"]||V["property"]!=1||X["is_private"]){H.miniTip(u.msg||l,{status:f,autoClose:1500})}e.likeflag=true},{target_id:X["photo_id"],like_uid:X["uid"],type:X["type"],album_id:V["album_id"],album_type:V["type"]})}if(!e.likeflag)return;e.likeflag=false;var n=t.target;var r=$GLOBAL_INFO["account_settings"]["like_tip"];var i=X["photo_id"];s()});j.unset(X["photo_id"]);j.unsetLike(X["photo_id"]);return false});o(this).bind("turn",this.turnSuccess);o("a[action-type=album_url]").live("click",function(){var e=o("div[node-type=content_album]"),t=e.attr("class");var n=o("div[node-type=content_likes]");if(t=="content hide_album"){e.attr("class","content show_album");e.find(".M_arrw_lf").hide();e.find(".m_thumbnail").show();n.attr("class","content hide_album");n.find(".M_arrw_lf").show();n.find(".m_thumbnail").hide();var r=V["type"]==3?"/talbum/index":"/albums/detail/album_id/"+V["album_id"];o(this).attr({href:u.baseURL+X["uid"]+r});return false}else{return true}});o("a[action-type=album_like_url]").live("click",function(){if(!k.isLogin()){m();return false}var e=o("div[node-type=content_likes]"),t=e.attr("class");var n=o("div[node-type=content_album]");if(t=="content hide_album"){n.attr("class","content hide_album");n.find(".M_arrw_lf").show();n.find(".m_thumbnail").hide();e.attr("class","content show_album");e.find(".M_arrw_lf").hide();e.find(".m_thumbnail").show();return false}else{return true}});o("a[action-type=my_favorites]").live("click",function(){if(!k.isLogin()){m();return false}var t=o(this),n=t.attr("title");if(n=="取消收藏"){e.changePhotoStatus("unfavorites",function(e){e("miniTip","unfavorites",{autoClose:1e3},function(){t.html('<span class="M_ico M_icon77"></span>收藏').attr("title","添加收藏")})})}else{e.changePhotoStatus("favorites",function(e){e("miniTip","favorites",{autoClose:1e3},function(){t.html('<span class="M_ico M_icon77_on"></span>取消收藏').attr("title","取消收藏")})})}return false})},initBiglike:function(e){var t=this,n=o("a[action-type=biglike]>span.bg>span"),r=o("a[action-type=biglike] em");if(e["is_liked"]){n.attr("class","M_ico M_icon7_on")}else{n.attr("class","M_ico M_icon7")}r.text(e["count"]["likes"])},updateLikeStat:function(e){var t=o('[node-type="like_bar"]'),n=t.find(">a"),r=t.find("i"),i=t.find("span"),s=e.like_total||e.likes;if(e["is_liked"]){r.attr("class","icon_praised");i.text("("+s+")");n.text("已赞")}else{r.attr("class","icon_praise");i.text("("+s+")");n.text("赞+1")}},repositionImg:function(){var e=o("#bigImg"),t=e.width();t<$&&e.css("margin-left",($-t)/2)},updateOperateBar:function(e){var t=this,n=o("#bigImgWrap"),r=o("#bigImg"),i;var s=o("[node-type=like_wrap]");if(s.length){i=s}else{i=o(Q)}t.$like=i;var u=r.width(),a=r.height(),f={visibility:"hidden"},l={visibility:"hidden"},c=u<$;if((c||a<J)&&!t.isdisablePage){l.left=f.left+170}else{n.css({"margin-bottom":0});i.attr("style","visibility:hidden;")}i.css(l).appendTo(n)},setMap:function(e){el=o("#location_map");if(e["geo_address"]){el.find("[node-type=address]").text(e["geo_address"]);el.show()}else{el.hide()}},updatefavorites:function(e){var t=o("a[action-type=my_favorites]");var n="收藏",r="M_icon77";if(e){n="取消收藏";r="M_icon77_on"}t.html('<span class="M_ico '+r+'"></span>'+n);t.attr("title",n)},updatePre:function(e){var t=u.baseURL+e["uid"]+"/photos/meitu/photo_id/"+e["photo_id"];if(X["type"]==15)t=u.baseURL+e["uid"]+"/wbphotos/meitu/photo_id/"+e["photo_id"];o("[node-type=prettify]").attr("href",t)},init_once:function(e,t){var n=this;n.editMenu.render();n.RightBar.render();l.init();n.detailMuen();s.isSelf=X["uid"]==$GLOBAL_INFO["account_uid"]?true:false;if(!s.isSelf)o("body").attr("class","P_t_phtoshow");n.staticUpdate(e);n.detail_comment=new w({wrap:"[node-type=detail_comment]",initType:3,target_id:n.currentID,comment_uid:t["uid"],album_id:e["album_id"],album_type:e["type"],type:t["type"],comment_total:t["count"]["comments"],like_total:t["count"]["likes"],hasRep:e["property"]!=11||t["visible_type"]==Z||t["visible_type"]==et||e["property"]!=1||t["visible_type"]==nt||t["visible_type"]==tt?false:true,allow_Comment:$GLOBAL_INFO["settings"]["comment"]});o(n.detail_comment).bind("insertAfter",function(e,t){o("#pl_main").find(".M_comment_sm").html('<span class="M_ico M_icon5" action-type="comment"></span>'+t)});o(n.detail_comment).bind("delAfter",function(e,t){o("#pl_main").find(".M_comment_sm").html('<span class="M_ico M_icon5" action-type="comment"></span>'+t)});n.detail_comment.initComment();n.Mylike=new v(o(".F_cols_main"));n.getAlbumIds(e["uid"],e["album_id"],e["type"],function(r,i){n.AlbumBox=new P;if(z)n.AlbumBox.isLikePage=true;j.initCachePhoto(i.data);n.AlbumBox.init({currentId:n.currentID,album_id:e["album_id"],type:t["type"],album_type:e["type"],total:e["count"]["photos"],uid:t["uid"],islikepage:z,callback:function(e){n.updatePage(e)}},o("div[node-type=content_album]"))});n.commonUpdate(t,true);n.bindAction();n.operate_menu()},getAlbumIds:function(e,t,n,r){if(z){j.getAlbumIds(e,t,n,r)}else{r(null,{data:R})}},findLikeIndex:function(e,t){for(var n=0;n<t.length;n++){if(t[n]["target_id"]==e){return t[n]}}return new Error("like lists can't find currentId")},init_1:function(){var e=this;q.getPhotoDetail(e.currentID,function(t){var n=t["type"]==15?3:1;q.getAlbumDetail(t["album_id"],n,function(n){V=n;X=t;X["uid"]=X["like_uid"]?X["like_uid"]:X["uid"];e.init_once(n,t);e.createCrumbs()})})},init_2:function(){var e=this;j.initLikeCachePhoto(U);e.getLikeDetail(e.currentID,function(t){var n=e.findLikeIndex(e.currentID,t.photos_list);n["album_id"]=V["album_id"];n["album_type"]=V["type"];j.setLike(e.currentID,n);X=n;X["uid"]=X["like_uid"]?X["like_uid"]:X["uid"];e.likeTotal=t.total;q.getPhotoDetail(n["target_id"],function(n){X=n;X["uid"]=X["like_uid"]?X["like_uid"]:X["uid"];var r=n["type"]==15?3:1;q.getAlbumDetail(n["album_id"],r,function(r){V=r;e.likeBox=new P;e.likeBox.init({currentId:e.currentID,initType:"like",total:t.total,uid:$GLOBAL_INFO["owner_uid"],host:e,callback:function(t){var n=o("[node-type=content_likes]").find("[data-id="+t+"]");var r=n.attr("flag");if(r&&r=="0"||r>1){e.updateDisable(r);n.addClass("cur");return}e.updatePage(t)}},o("[node-type=content_likes]"));e.init_once(r,n);e.updateLikeBox();e.createCrumbs()})})})},updateLikeBox:function(){var e=this,t=$GLOBAL_INFO["owner_uid"]===$GLOBAL_INFO["account_uid"]?"我赞过的":$GLOBAL_INFO["owner_data"]["name"]+"赞过的";if(e.likeTotal){var n=u.baseURL+$GLOBAL_INFO["owner_uid"]+"/likes/photos";o("a[node-type=likes_album_name]").attr({href:n}).html(t).attr("title",t);o("[node-type=like_counts]").text("共"+e.likeTotal+"张").attr("href",n).show();o("[node-type=like_counts]").parent().show()}},createCrumbs:function(){var e=o("div[node-type=list_crumbs]"),t="",n=V["screen_name"],r=V["caption"],i=u.baseURL+V["uid"]+"/albums",s=V["type"]==3?u.baseURL+V["uid"]+"/talbum/index":u.baseURL+V["uid"]+"/albums/detail/album_id/"+V["album_id"]+(V["type"]==45?"?prel=p5_face":"");if(z){r=$GLOBAL_INFO["owner_data"]["name"]+"赞过的";s=u.baseURL+$GLOBAL_INFO["owner_uid"]+"/likes/photos"}else{t='<a href="'+i+'" class="M_linkb">'+n+'的专辑</a><span class="arrow">&gt;</span>'}e.html(t+'<a href="'+s+'" class="M_linkb">'+r+"</a>"+'<span class="arrow">&gt;</span>'+"<strong>当前照片</strong>")},initRecommandPic:function(){var e=new F.RecommandPic;e.render()},init:function(){var e=this;var t=$GLOBAL_DETAIL["mutiple_data"];if(t){for(var n in t){j.set(n,t[n])}}e.initOperateEle();e.currentID=$GLOBAL_DETAIL["init_photo_id"];var r=s.Backbone.Router.extend({initialize:function(){this.route(/(.*?)/,"alltime")},alltime:function(){var t=window.location.hash.slice(1);if(!t){e.updatePage($GLOBAL_DETAIL["init_photo_id"],"root")}else{if(t!=e.currentID&&!isNaN(t)&&t!==""){e.updatePage(t)}}}});e.PhotoRouter=new r;var i=window.location.hash.slice(1);if(i!==""&&e.currentID!=i&&!isNaN(i)){e.currentID=i}if(z){e.init_2()}else{j.set($GLOBAL_DETAIL["photo_info"]["photo_id"],$GLOBAL_DETAIL["photo_info"]);j.set("PhotoDB",$GLOBAL_DETAIL["photo_info"]);e.init_1()}e.initRecommandPic()},initOperateEle:function(){var e=o(document.body),t=Mustache.render(o("#T_operate").html(),{islikepage:z}),n=o("#T_like").html();K=t;Q=n;e.append(o(t).css("visibility","hidden"));e.append(o(n).css("visibility","hidden"))},updateReport:function(e,t,n){var r,i=9,s;if(n==15){r=e;i=1}else{if(t.length<12){var u=12-t.length;for(var a=0;a<u;a++){t="0"+t}}r=e+""+t}s="http://service.account.weibo.com/reportspam?rid="+r+"&type="+i+"&from=10902&url="+encodeURIComponent(window.location.href);o("[node-type=report]").attr("data-url",s)}};o(function(){it.init();s.Backbone.history.start({silent:true})})},A:function(e,t,n,r){function i(e){e=String(e);var t="00000000 77073096 EE0E612C 990951BA 076DC419 706AF48F E963A535 9E6495A3 0EDB8832 79DCB8A4 E0D5E91E 97D2D988 09B64C2B 7EB17CBD E7B82D07 90BF1D91 1DB71064 6AB020F2 F3B97148 84BE41DE 1ADAD47D 6DDDE4EB F4D4B551 83D385C7 136C9856 646BA8C0 FD62F97A 8A65C9EC 14015C4F 63066CD9 FA0F3D63 8D080DF5 3B6E20C8 4C69105E D56041E4 A2677172 3C03E4D1 4B04D447 D20D85FD A50AB56B 35B5A8FA 42B2986C DBBBC9D6 ACBCF940 32D86CE3 45DF5C75 DCD60DCF ABD13D59 26D930AC 51DE003A C8D75180 BFD06116 21B4F4B5 56B3C423 CFBA9599 B8BDA50F 2802B89E 5F058808 C60CD9B2 B10BE924 2F6F7C87 58684C11 C1611DAB B6662D3D 76DC4190 01DB7106 98D220BC EFD5102A 71B18589 06B6B51F 9FBFE4A5 E8B8D433 7807C9A2 0F00F934 9609A88E E10E9818 7F6A0DBB 086D3D2D 91646C97 E6635C01 6B6B51F4 1C6C6162 856530D8 F262004E 6C0695ED 1B01A57B 8208F4C1 F50FC457 65B0D9C6 12B7E950 8BBEB8EA FCB9887C 62DD1DDF 15DA2D49 8CD37CF3 FBD44C65 4DB26158 3AB551CE A3BC0074 D4BB30E2 4ADFA541 3DD895D7 A4D1C46D D3D6F4FB 4369E96A 346ED9FC AD678846 DA60B8D0 44042D73 33031DE5 AA0A4C5F DD0D7CC9 5005713C 270241AA BE0B1010 C90C2086 5768B525 206F85B3 B966D409 CE61E49F 5EDEF90E 29D9C998 B0D09822 C7D7A8B4 59B33D17 2EB40D81 B7BD5C3B C0BA6CAD EDB88320 9ABFB3B6 03B6E20C 74B1D29A EAD54739 9DD277AF 04DB2615 73DC1683 E3630B12 94643B84 0D6D6A3E 7A6A5AA8 E40ECF0B 9309FF9D 0A00AE27 7D079EB1 F00F9344 8708A3D2 1E01F268 6906C2FE F762575D 806567CB 196C3671 6E6B06E7 FED41B76 89D32BE0 10DA7A5A 67DD4ACC F9B9DF6F 8EBEEFF9 17B7BE43 60B08ED5 D6D6A3E8 A1D1937E 38D8C2C4 4FDFF252 D1BB67F1 A6BC5767 3FB506DD 48B2364B D80D2BDA AF0A1B4C 36034AF6 41047A60 DF60EFC3 A867DF55 316E8EEF 4669BE79 CB61B38C BC66831A 256FD2A0 5268E236 CC0C7795 BB0B4703 220216B9 5505262F C5BA3BBE B2BD0B28 2BB45A92 5CB36A04 C2D7FFA7 B5D0CF31 2CD99E8B 5BDEAE1D 9B64C2B0 EC63F226 756AA39C 026D930A 9C0906A9 EB0E363F 72076785 05005713 95BF4A82 E2B87A14 7BB12BAE 0CB61B38 92D28E9B E5D5BE0D 7CDCEFB7 0BDBDF21 86D3D2D4 F1D4E242 68DDB3F8 1FDA836E 81BE16CD F6B9265B 6FB077E1 18B74777 88085AE6 FF0F6A70 66063BCA 11010B5C 8F659EFF F862AE69 616BFFD3 166CCF45 A00AE278 D70DD2EE 4E048354 3903B3C2 A7672661 D06016F7 4969474D 3E6E77DB AED16A4A D9D65ADC 40DF0B66 37D83BF0 A9BCAE53 DEBB9EC5 47B2CF7F 30B5FFE9 BDBDF21C CABAC28A 53B39330 24B4A3A6 BAD03605 CDD70693 54DE5729 23D967BF B3667A2E C4614AB8 5D681B02 2A6F2B94 B40BBE37 C30C8EA1 5A05DF1B 2D02EF8D";if(typeof crc=="undefined"){crc=0}var n=0;var r=0;crc=crc^-1;for(var i=0,s=e.length;i<s;i++){r=(crc^e.charCodeAt(i))&255;n="0x"+t.substr(r*9,8);crc=crc>>>8^n}return crc^-1}function s(e){e=String(e);len=e.length;var t=/^[0-9a-zA-Z]{21,40}$/;return t.test(e)}function o(e,t){var n;if(typeof t=="undefined")t="bmiddle";if(e[9]=="w"){var r=(i(e)&3)+1;var s=e[21]=="g"?"gif":"jpg";n="http://ww"+r+".sinaimg.cn/"+t+"/"+e+"."+s}else{var r=((e.substr(-2,2),16)&15)+1;n="http://ss"+r+".sinaimg.cn/"+t+"/"+e+"&690"}return n}function u(e){e=String(e);var t;if(e.length>=32&&e.charAt(22)>="1"){t=new Object;t.width=parseInt(e.substr(23,3),36);t.height=parseInt(e.substr(26,3),36)}return t}function a(e){var t=0;e=String(e);if(e.length>=32&&e[22]>="2"){dn=parseInt(e.substr(29,3),36);base=dn&1023;exp=dn>>>10&3;rem=dn>>>12&15;t=base<<exp*10;t+=rem*93<<(exp>0?exp-1:exp)*10}return t}function f(e){if(!e){return null}e=String(e);return"g"===e.charAt(21)?"gif":"jpg"}e.exports={isValidPicID:s,getImgURL:o,getImgGeometry:u,getImgLargeFileSize:a,getExt:f}},b:function(e,t,n,r){function f(e,t){var n=u();n=/(\/conf\/[\w.]+)\.js/i.exec(n)||[];n=n[1]||"";var r=n,i=true;if(e&&e.length){for(var s=0,o=e.length;s<o;s++){if(r==e[s]){i=false;break}}}if(i&&t)t()}var i=n("B");var s=n("c");var o=i.browser.msie&&i.browser.version=="6.0";var u=function(){var e="";try{a=b}catch(t){if(t.fileName){e=t.fileName}else if(t.sourceURL){e=t.sourceURL}else if(t.stacktrace){var n=t.stacktrace.match(/\(\) in\s+(.*?\:\/\/\S+)/m);if(n&&n[1])e=n[1]}}if(!e){var r=document.getElementsByTagName("script");var i=/t5\/album\/js\/conf\/\w*\.js/i;for(var s=0,o=r.length;s<o;s++){var u=!!document.querySelector?r[s].src:r[s].getAttribute("src",4);if(u&&i.test(u)){e=u;break}}}return e};if($GLOBAL_INFO&&$GLOBAL_INFO.account_settings&&$GLOBAL_INFO.account_settings.guide){var l=location.href;f(["/conf/showLarge_new","/conf/wbShow","/conf/weiboUpload"],function(){(new s).init()})}},B:function(e,t,n,r){e.exports=window.$},c:function(e,t,n,r){var i=n("B");var s=n("C");var o=n("E");var u=n("e");var a=n("D");var f=n("F");var l=new a;var c=function(e){function h(){var e="",t=a.orgFlag,n=a.eventRec,r=a.tagRec,i=a.userRec,s=a.orgRec,o=true,u=/^http(s?):\/\//.test(n.url)?n.url:"http://"+n.url;e+='<a href="#" action-type="close" class="close"></a>'+'<div class="L_guide">'+'<div class="guide_hd">'+'<h3 class="M_hidetxt">微相册推荐精彩内容</h3>'+'<div class="pic_area">'+'<a title="'+(n.name||"")+'" href="'+u+'" target="_blank"><img src="'+n.pic+'" alt=""></a>'+"</div>"+'<div class="m_box_mod hot_tags">'+'<div class="hd">'+'<h4><span class="M_ico M_icon81"></span>热门标签</h4>'+"</div>"+'<div class="bd">'+'<div class="m_photo_list_a">'+p(r)+"</div>"+"</div>"+"</div>"+"</div>"+'<div class="guide_bd">'+'<div class="m_box_mod famous_phor">'+'<div class="hd">'+'<h4><span class="M_ico M_icon82"></span>知名摄影人</h4>'+'<div class="act">'+'<label for="user_checkall" class="check_all">'+'<input id="user_checkall" value="list_user" class="M_checkbox" checked="'+o+'" type="checkbox">全选加关注'+"</label>"+"</div>"+"</div>"+'<div class="bd">'+'<div class="m_photo_list_a" node-type="list_user">'+d(i,o)+"</div>"+"</div>"+"</div>"+v(s,o,t)+"</div>"+'<div class="guide_ft">'+'<div class="btn_wrap">'+'<a href="#" action-type="try_now" class="M_btn_a"><span>立即体验</span></a>'+"</div>"+"</div>"+"</div>";return e}function p(e){var t=[],n,i,s;if(e){t.push('<ul class="photoList clearfix">');for(var o=0,u=e.length;o<u;o++){n=e[o];s=n.name;i=r+"tags/best/tag/"+s+"?prel=p7_2";t.push("<li>");t.push('<dl class="m_photoItem m_photoItem_a">');t.push('<dt class="photo">');t.push('<a href="'+i+'" target="_blank"><img src="'+n.pic+'" alt=""></a>');t.push("</dt>");t.push("<dd>");t.push('<p class="M_linkc desc"><a href="'+i+'" target="_blank" title="">'+s+"</a></p>");t.push("</dd>");t.push("</dl>");t.push("</li>")}t.push("</ul>")}return t.join("")}function d(e,t){var n=[],i,s,o;if(e){n.push('<ul class="photoList clearfix">');for(var u=0,a=e.length;u<a;u++){s=e[u];i=s.uid;o=r+i+"/albums";n.push("<li>");n.push('<dl class="m_photoItem m_photoItem_a">');n.push('<dt class="photo">');n.push('<a href="'+o+'" target="_blank"><img src="'+s.profile+'" alt=""></a>');n.push('<input class="M_checkbox" value="'+i+'" name="user" checked="'+!!t+'" type="checkbox">');n.push("</dt>");n.push("<dd>");n.push('<p class="M_linkc desc"><a href="'+o+'" target="_blank" title="">'+s.screen_name+"</a></p>");n.push("</dd>");n.push("</dl>");n.push("</li>")}n.push("</ul>")}return n.join("")}function v(e,t,n){var r="";if(!n){r='<div class="m_box_mod phor_agency">'+'<div class="hd">'+'<h4><span class="M_ico M_icon83"></span>摄影机构</h4>'+'<div class="act">'+'<label for="org_checkall" class="check_all">'+'<input id="org_checkall" value="list_org" class="M_checkbox" checked="'+!!t+'" type="checkbox">全选加关注'+"</label>"+"</div>"+"</div>"+'<div class="bd">'+'<div class="m_photo_list_a" node-type="list_org">'+d(e,t)+"</div>"+"</div>"+"</div>"}return r}var t=[];var n="1962310741";var r=u.baseURL;var a=null;var c=this;t[0]='<dl class="guide_info">'+'<dt>新版"微相册"</dt>'+"<dd>围观Ta的生活映像，闪耀你的精致视界！</dd>"+"<dd>快速上传、美图、高清大图。</dd>"+'<dd class="follow"><label for="follow" action-type="check_fllow" class="follow"><input type="checkbox" checked="checked" id="follow">关注"微相册"官方微博</label></dd>'+'<dd class="btn_wrap"><a class="btn_next" href="javascript:void(0)">下一步</a></dd>'+"</dl>";var c=this;this.curStep=e||0;this.mask=new o(40);this.guideNode=i('<div class="m_guide"></div>');this.do_step=function(){if(t[this.curStep]){this.guideNode.html(t[this.curStep])}};this.hide=function(){c.guideNode.undelegate();c.guideNode.remove();c.mask.hide();i(document).unbind("click",this.goShareToWB)};this.shareToWB=function(){f.shareToWB(null,c.showRecommendLayer)};this.show=function(){this.guideNode.show();this.mask.show()};this.jump=function(e){var t=i(this).attr("action-data");c.curStep=t;c.do_step();e.preventDefault()};this.setPosition=function(){var e=(i(window).width()-this.guideNode.width())/2;this.guideNode.css({top:0,zIndex:1e4})};this.getUserByUid=function(e,t){s({dataType:"json",url:r+"users/get_user",data:{uid:e},type:"get",success:function(e){if(t&&typeof t=="function"){t.call(c,e)}}})};this.do_follow=function(e,t){s({dataType:"json",url:r+"users/follow",data:{uid:e},type:"post",success:function(e){if(t&&typeof t=="function"){t.call(this,e)}}})};this.follow_batch=function(e,t){s({dataType:"json",url:r+"users/follow_batch",data:{uids:e},type:"post",success:function(e){if(t&&typeof t=="function"){t.call(this,e)}}})};this.addEvent=function(){this.guideNode.delegate("[action-type=check_fllow]","click",function(e){e.stopPropagation()});this.guideNode.delegate("[action-type=close]","click",this.goShareToWB);i(document).bind("click",this.goShareToWB)};this.goShareToWB=function(){var e=i("#follow").get(0);if(e&&e.checked){c.getUserByUid(n,function(e){if(e&&e.result){if(e.data&&!e.data.following){c.do_follow(n)}}})}c.hide();c.shareToWB();return false};this.getRecommendData=function(e){if(a){if(e&&typeof e=="function"){e.apply(this,argumengts)}}else{s({url:r+"users/get_guide",type:"get",dataType:"json",success:function(t){if(t&&t.result){a=t.data;if(e&&typeof e=="function"){e.apply(c,arguments)}}}})}};this.showRecommendLayer=function(){c.getRecommendData(function(){l.customTip(h(),{title:false});c.addRecommendEvent(l.popLay)})};this.addRecommendEvent=function(e){function r(e,t){var n=e.value,r=t.find("div[node-type="+n+"]"),i;window.setTimeout(function(){i=r.find("input[type=checkbox]");i.attr("checked",e.checked)},10)}if(e){var t=e.find("#org_checkall");var n=e.find("#user_checkall");t.bind({click:function(){r(this,e)}});n.bind({click:function(){r(this,e)}});e.delegate("[action-type=try_now]","click",function(){c.doTryNow(e);t.unbind();n.unbind();return false})}};this.doTryNow=function(e){var t=e.find("input[type=checkbox][name=user]");var n=[];for(var r=0,i=t.length;r<i;r++){if(t[r].checked)n.push(t[r].value)}if(n.length){c.follow_batch(n.join(","))}l.close();f.close()};this.init=function(){i(document.body).append(this.guideNode);this.do_step();this.show();this.setPosition();this.addEvent()}};e.exports=c},C:function(e,t,n,r){var i=n("B");var s=n("d");var o=n("D");var u,a,f=i.ajax;i.ajax=function(e){function n(e){var n=this,r=arguments;if(e&&this.dataType=="json"&&!e.result){var i=e.code,s=false,f={};if(!u)u=new o;if(i==10406){s=true;a='<div class="L_prompt">						<div class="prompt M_txtc">							<span class="mk_ico mk_remind"></span>							<em class="cont">您的帐号存在高危风险，系统暂时锁定了部分功能。您可以通过验证安全信息的方式，恢复使用。<a title="查看帮助" href="http://help.weibo.com/faq/q/738/13250#13250" target="_blank">查看帮助</a></em>						</div>						<div class="submit_centr">							<a class="M_btn_e" href="http://account.weibo.com/sguide/retrieve"><span>验证安全信息</span></a>							<a class="M_btn_e" href="#" action-type="cancel"><span>以后再验</span></a>						</div>					</div>'}else if(i==20046){s=true;f["title"]="帐号激活";f["zIndex"]=20001;a='<iframe scrolling="no" frameborder="no" style="width:380px; height:240px;" src="http://weibo.com/a/verify/email?stage=home_verification&from=photo"></iframe>'}t.apply(n,Array.prototype.slice.call(r));if(s&&u){u.closeAll();u.customTip(a,f)}}else{t.apply(this,Array.prototype.slice.call(r))}}var t=e.success;e.success=function(){n.apply(this,Array.prototype.slice.call(arguments))};f.call(i,e)};var l=function(e,t,n,r){if(i.isPlainObject(arguments[0])){i.ajax.apply(i,arguments)}else{i.ajax({url:e,type:r||"post",data:n||{},dataType:"json",success:function(e){var n=this;if(t)t(false,e,n)},error:function(e,t,n){}})}};e.exports=l},d:function(e,t,n,r){var i={isLogin:function(){var e=document.cookie+";";var t=["SUP","=([^;]*)?;"].join("");var n=["(\\?|&)","uid","=([^&]*)(&|$)"].join("");var r=e.match(new RegExp(t,"i"));r=r?r[1]||"":"";r=unescape(r);var i=r.match(new RegExp(n));i=i?i[2]||"":"";var s=$GLOBAL_INFO.account_uid;if(i&&s==i)return true;return false}};e.exports=i},D:function(e,t,n,r){var i=n("B");var s=n("e");var o=n("E");var u=n("d");n("f");var a=document,f=window,l=i.browser.msie&&i.browser.version=="6.0",c=s.baseURL;var h=[];var p=function(e){this._conf={title:"提示",ok_label:"确定",cancel_label:"取消",drag:true,mask:true,autoClose:false,ok:null,cancel:null,maskbgcolor:"#000",maskopacity:15,maskZindex:9990,zIndex:9999,target:null,isFollow:false,parent:"body",customLayer:false};i.extend(this._conf,e);this.mask=new o(this._conf.maskopacity,this._conf.maskbgcolor,this._conf.maskZindex);this.popLay=null;h.push(this)};p.prototype={constructor:p,closeAll:function(){for(var e=0;e<h.length;e++){h[e].close()}},queue:[],timer:null,basicLay:function(e,t){if(t.customLayer)return i(e);var n=function(){return'<div class="title">'+t.title+'</div>                          <a href="#" action-type="close" class="close"></a>'},r=i('<div class="L_layer" style="z-index:'+t.zIndex+';">                        <div class="bg">                            <table border="0" cellspacing="0" cellpadding="0">                                    <tbody><tr>                                        <td>                                            <div class="'+(t.className||"content")+'">                                                '+(t.title?n():"")+"                                                "+e+"</div>                                        </td>                                    </tr>                            </tbody></table>                        </div>                    </div>");return r},close:function(){var e=this;if(e.popLay){e.unbindEvent(e.popLay);e.popLay.hide()}if(e.mask)e.mask.hide();if(e.timer)window.clearTimeout(e.timer);e.hasPop=false;i(window).unbind("resize",e.resize);i(e).trigger("closeAfter");if(e.queue.length>0){var t=e.queue.shift();t[0].apply(e,t[1])}},unbindEvent:function(e){var t=["input","textarea"];var n=t.length,r;if(e){e.unbind();e.undelegate();while(n){n--;r=e.find(t[n]);for(var s=0,o=r.length;s<o;s++){i(r[s]).blur();i(r[s]).unbind()}}}},_callEvent:function(e){var t=e.data[0],n=e.data[1],r=e.data[2];t.close();if(r[n]&&typeof r[n]=="function"){r[n].call(this,e)}return false},basicDialog:function(e,t){var n=this,r=i.extend(true,{},n._conf);if(n.popLay)n.close();if(!n.hasPop){i.extend(r,t);n.popLay=i(n.basicLay(e,r));i(r.parent).append(n.popLay);n.hasPop=true;if(r.drag)n.drag(n.popLay,".title");if(r.mask)n.mask.show();if(r.autoClose){n.timer=setTimeout(function(){n.close()},r.autoClose)}n.popLay.delegate("[action-type=close]","click",function(e){n.close();if(r["close"]&&typeof r["close"]=="function"){r["close"].call(n,e)}return false});n.popLay.delegate("[action-type=ok]","click",[n,"ok",r],n._callEvent);n.popLay.delegate("[action-type=cancel]","click",[n,"cancel",r],n._callEvent);if(r.isFollow&&r.target){n.popLay.hide();n.setFollowPos(n.popLay,r.target)}else{n.setPosition(n.popLay,r.parent);i(window).bind("resize",[n,r],n.resize)}}else{n.queue.push([arguments.callee,Array.prototype.slice.apply(arguments)])}n.popLay.show();if(!u.isLogin()){n.popLay.hide();location.reload()}},drag:function(e,t){var n=this,r,s;e.bind("dragstart",function(n){var o=e.position();r=o.left-n.clientX;s=o.top-n.clientY;return i(n.target).is(t)}).bind("drag",function(t){e.css({top:t.clientY+s,left:t.clientX+r})});n.popLay.find(".title").css("cursor","move")},setPosition:function(e,t){var n=i(window).height(),r=(i(window).width()-e.width())/2+"px",s=t=="body"?document.documentElement.scrollTop||i("body").scrollTop():0,o=s+(n-e.height())/2+"px";if(e.height()>=n){o=s}e.css({left:r,top:o})},resize:function(e){var t=e.data[0],n=e.data[1];t.setPosition(t.popLay,n.parent)},setFollowPos:function(e,t){var n=i(t);var r=i(document).scrollTop();var s=i(document).scrollLeft();var o=10;var u=35;var a=i(window).height();var f=i(window).width();var l=n.offset();var c=l.top;var h=l.left;var p=c+n.height();var d=h+n.width();var v,m;var g=e.height();var y=e.width();if(c-r>r+a-p){v=c-g-o}else{v=p+o}if(s+f-d>y){m=d-n.width()/2-u}else{m=d-n.width()/2-y+u}e.css({left:m,top:v});e.show("fast")},alert:function(e,t,n){var r=this,i={success:"mk_suced",error:"mk_fail",remind:"mk_remind"};n=n?i[n]:i["remind"];var s='<div class="L_prompt">                            <div class="prompt M_txtc">                                <span class="mk_ico '+n+'"></span><span class="cont">'+e+'</span>                            </div>                            <div class="submit_centr"><a class="M_btn_e" action-type="ok" href="#"><span>确定</span></a></div>                        </div>';r.basicDialog(s,t)},miniConfirm:function(e,t){var n=this;if(t)t.title=null;else t={title:null};var r='<div class="L_min_prompt">                               <div class="prompt M_txtc">                                 <span class="mk_ico mk_remind"></span>                                 <span class="cont">'+e+'</span>                               </div>                                <div class="submit_centr">                                    <a class="M_btn_e" action-type="ok" href="#"><span>确定</span></a>                                    <a class="M_btn_e" action-type="cancel" href="#"><span>取消</span></a>                                </div>                          </div>';n.basicDialog(r,t)},customTip:function(e,t){var n=this;n.basicDialog(e,t)},miniTip:function(e,t){var n=this,r={success:"mk_suced",error:"mk_fail",loading:"M_icon68",remind:"mk_remind"};var s={title:null,status:"success",auto:false,mask:false,zIndex:2e4,autoClose:1500};if(t)i.extend(s,t);var o="L_min_prompt";var u="";var a="";if(s["auto"])o="L_auto_prompt";if(s["link"]){u='<div class="view M_txtc"><p>进入<a class="category" title="'+s["link"]["text"]+'" href="'+s["link"]["href"]+'">'+s["link"]["text"]+"</a>查看&gt;&gt;</p></div>";a='<a class="close" title="关闭" href="#" action-type="close"></a>'}else if(s["link2"]){u=s["link2"]}var f='<div class="'+o+'">							  '+a+'                              <div class="prompt M_txtc">                                 <span class="mk_ico '+r[s.status]+'"></span>                                 <span class="cont">'+e+"</span>                              </div>                              "+u+"                           </div>";n.basicDialog(f,s)},confirm:function(e,t){var n=this,r={},s='<div class="L_prompt">                            <div class="prompt M_txtc">                                <span class="mk_ico mk_remind"></span><span class="cont">'+e+'</span>                            </div>                            <div class="submit_centr"><a class="M_btn_e" action-type="ok" href="#"><span>确定</span></a><a class="M_btn_e" action-type="cancel" href="#"><span>取消</span></a></div>                        </div>';if(t)i.extend(r,t);n.basicDialog(s,t)},minialert:function(e,t){}};e.exports=p},e:function(e,t,n,r){var i="http://js.app.wcdn.cn/ops/photo/";var s="http://img.t.sinajs.cn/t4/appstyle/photo/";var o="http://img.app.wcdn.cn/ops/photo/style/";var u=$GLOBAL_INFO.script_version;var a=$GLOBAL_INFO.style_version;e.exports={baseURL:$GLOBAL_INFO.base_url,baseIMG:s+"images/",baseCSS:s+"css/",baseSWF:"http://js.t.sinajs.cn/t5/album/static/swf/v5/",baseJS:i+"/js/v5/",base:o,imgVersion:a,jsVersion:u,cssVersion:a}},E:function(e,t,n,r){var i=n("B");var s=document,o=window,u=i.browser.msie&&i.browser.version=="6.0";var a=function(e,t,n,r){this.op=e?e:15;this.co=t?t:"#000";this.Zindex=n?n:9998;this.mask=i('<div class="ttt"></div>');this.parent=r||"body";this._resize=i.proxy(function(){var e=this.mask;e.css("height",s.documentElement.clientHeight);if(u){e.css({width:i(window).width(),height:i(document.body).outerHeight(true),top:0,left:0,position:"absolute"})}},this)};a.prototype={constructor:a,_fixmask:function(){var e=this,t=e.mask;e.mask.css({width:"100%",top:0,left:0,opacity:e.op/100,background:e.co,zIndex:e.Zindex});if(u){t.append('<iframe style="width:100%;filter:alpha(opacity=0);z-index:-1;">');t.find("iframe").css("height",t.height())}else{t.css("position","fixed")}},show:function(){var e=this;e._fixmask();i(this.parent).append(e.mask);e.resize();i(window).bind("scroll resize",e._resize)},hide:function(){var e=this,t=e.mask;t.find("iframe").remove();t.remove();i(window).unbind("scroll resize",e._resize)},resize:function(){var e=this,t=e.mask;t.css("height",s.documentElement.clientHeight);if(u){t.css({width:i(window).width(),height:i(document).outerHeight(true),top:0,left:0,position:"absolute"})}}};e.exports=a},f:function(e,t,n,r){var i=n("B");(function(e){e.fn.drag=function(t,n,r){var i=typeof t=="string"?t:"",s=e.isFunction(t)?t:e.isFunction(n)?n:null;if(i.indexOf("drag")!==0)i="drag"+i;r=(t==s?n:r)||{};return s?this.bind(i,r,s):this.trigger(i)};var t=e.event,n=t.special,r=n.drag={defaults:{which:1,distance:0,not:":input",handle:null,relative:false,drop:true,click:false},datakey:"dragdata",noBubble:true,add:function(t){var n=e.data(this,r.datakey),i=t.data||{};n.related+=1;e.each(r.defaults,function(e,t){if(i[e]!==undefined)n[e]=i[e]})},remove:function(){e.data(this,r.datakey).related-=1},setup:function(){if(e.data(this,r.datakey))return;var n=e.extend({related:0},r.defaults);e.data(this,r.datakey,n);t.add(this,"touchstart mousedown",r.init,n);if(this.attachEvent)this.attachEvent("ondragstart",r.dontstart)},teardown:function(){var n=e.data(this,r.datakey)||{};if(n.related)return;e.removeData(this,r.datakey);t.remove(this,"touchstart mousedown",r.init);r.textselect(true);if(this.detachEvent)this.detachEvent("ondragstart",r.dontstart)},init:function(i){if(r.touched)return;var s=i.data,o;if(i.which!=0&&s.which>0&&i.which!=s.which)return;if(e(i.target).is(s.not)){return}if(s.handle&&!e(i.target).closest(s.handle,i.currentTarget).length)return;r.touched=i.type=="touchstart"?this:null;s.propagates=1;s.mousedown=this;s.interactions=[r.interaction(this,s)];s.target=i.target;s.pageX=i.pageX;s.pageY=i.pageY;s.dragging=null;o=r.hijack(i,"draginit",s);if(!s.propagates)return;o=r.flatten(o);if(o&&o.length){s.interactions=[];e.each(o,function(){s.interactions.push(r.interaction(this,s))})}s.propagates=s.interactions.length;if(s.drop!==false&&n.drop)n.drop.handler(i,s);r.textselect(false);if(r.touched)t.add(r.touched,"touchmove touchend",r.handler,s);else t.add(document,"mousemove mouseup",r.handler,s);if(!r.touched||s.live)return},interaction:function(t,n){var i=e(t)[n.relative?"position":"offset"]()||{top:0,left:0};return{drag:t,callback:new r.callback,droppable:[],offset:i}},handler:function(i){var s=i.data;switch(i.type){case!s.dragging&&"touchmove":i.preventDefault();case!s.dragging&&"mousemove":if(Math.pow(i.pageX-s.pageX,2)+Math.pow(i.pageY-s.pageY,2)<Math.pow(s.distance,2))break;i.target=s.target;r.hijack(i,"dragstart",s);if(s.propagates)s.dragging=true;case"touchmove":i.preventDefault();case"mousemove":if(s.dragging){r.hijack(i,"drag",s);if(s.propagates){if(s.drop!==false&&n.drop)n.drop.handler(i,s);break}i.type="mouseup"};case"touchend":case"mouseup":default:if(r.touched)t.remove(r.touched,"touchmove touchend",r.handler);else t.remove(document,"mousemove mouseup",r.handler);if(s.dragging){if(s.drop!==false&&n.drop)n.drop.handler(i,s);r.hijack(i,"dragend",s)}r.textselect(true);if(s.click===false&&s.dragging)e.data(s.mousedown,"suppress.click",(new Date).getTime()+5);s.dragging=r.touched=false;break}},hijack:function(n,i,s,o,u){if(!s)return;var a={event:n.originalEvent,type:n.type},f=i.indexOf("drop")?"drag":"drop",l,c=o||0,h,p,d,v=!isNaN(o)?o:s.interactions.length;n.type=i;n.originalEvent=null;s.results=[];do if(h=s.interactions[c]){if(i!=="dragend"&&h.cancelled)continue;d=r.properties(n,s,h);h.results=[];e(u||h[f]||s.droppable).each(function(o,u){d.target=u;n.isPropagationStopped=function(){return false};l=u?t.dispatch.call(u,n,d):null;if(l===false){if(f=="drag"){h.cancelled=true;s.propagates-=1}if(i=="drop"){h[f][o]=null}}else if(i=="dropinit")h.droppable.push(r.element(l)||u);if(i=="dragstart")h.proxy=e(r.element(l)||h.drag)[0];h.results.push(l);delete n.result;if(i!=="dropinit")return l});s.results[c]=r.flatten(h.results);if(i=="dropinit")h.droppable=r.flatten(h.droppable);if(i=="dragstart"&&!h.cancelled)d.update()}while(++c<v);n.type=a.type;n.originalEvent=a.event;return r.flatten(s.results)},properties:function(e,t,n){var i=n.callback;i.drag=n.drag;i.proxy=n.proxy||n.drag;i.startX=t.pageX;i.startY=t.pageY;i.deltaX=e.pageX-t.pageX;i.deltaY=e.pageY-t.pageY;i.originalX=n.offset.left;i.originalY=n.offset.top;i.offsetX=i.originalX+i.deltaX;i.offsetY=i.originalY+i.deltaY;i.drop=r.flatten((n.drop||[]).slice());i.available=r.flatten((n.droppable||[]).slice());return i},element:function(e){if(e&&(e.jquery||e.nodeType==1))return e},flatten:function(t){return e.map(t,function(t){return t&&t.jquery?e.makeArray(t):t&&t.length?r.flatten(t):t})},textselect:function(t){e(document)[t?"unbind":"bind"]("selectstart",r.dontstart).css("MozUserSelect",t?"":"none");document.unselectable=t?"off":"on"},dontstart:function(){return false},callback:function(){}};r.callback.prototype={update:function(){if(n.drop&&this.available.length)e.each(this.available,function(e){n.drop.locate(this,e)})}};var i=t.dispatch;t.dispatch=function(t){if(e.data(this,"suppress."+t.type)-(new Date).getTime()>0){e.removeData(this,"suppress."+t.type);return}return i.apply(this,arguments)};var s=t.fixHooks.touchstart=t.fixHooks.touchmove=t.fixHooks.touchend=t.fixHooks.touchcancel={props:"clientX clientY pageX pageY screenX screenY".split(" "),filter:function(t,n){if(n){var r=n.touches&&n.touches[0]||n.changedTouches&&n.changedTouches[0]||null;if(r)e.each(s.props,function(e,n){t[n]=r[n]})}return t}};n.draginit=n.dragstart=n.dragend=r})(i)},F:function(e,t,n,r){function l(e,t){s({dataType:"json",url:f+"sina/update",data:e,type:"post",success:function(e){if(t&&typeof t==="function"){t.call(this,e)}}})}var i=n("B");var s=n("C");var o=n("D");var u=n("e");var a=new o;var f=u.baseURL;i.extend(a,{shareToWB:function(e,t){var n=this;var r={title:"分享到微博",className:"L_shareWB",close:function(e){var n=i(e.target).attr("action-data")||3;l({type:n});if(t&&typeof t=="function")t.apply(this,arguments)}};if(e)i.extend(r,e);var s='<div class="shareWB">                            <div class="txtarea">                              <textarea class="M_txtarea">我在用刚刚发布的#新版微相册#，看起来还不错～是个分享照片的好地方，想看看朋友们的照片吗？猛击这个链接[嘻嘻]</textarea>                            </div>                            <div class="shareTo">                                <a class="M_btn_b" action-type="share" href="#"><span>开始使用微相册</span></a><a class="M_linkg" action-type="close" action-data="2" href="#">跳过</a>                            </div>                        </div>';n.basicDialog(s,r);n.popLay.delegate("[action-type=share]","click",function(e){var r=n.popLay.find("textarea").val();l({content:r,type:1});n.close();if(t&&typeof t=="function")t.apply(this,arguments)})}});e.exports=a},g:function(e,t,n,r){function v(){if(d)d.hide()}var i=n("B");var s=n("C");var o=n("G");var u=n("h");var a=n("E");var f=n("e");var l=n("d");var c=n("H");var h=f.baseURL;var p={};var d=null;p.ShowFace=function(){function C(){k();y=new o({node:f,callback:H});b=new o({node:w,callback:_});P();A();i(document.body).click(function(e){var n=e.target;if(t!==n&&!i.contains(d[0],n)){v()}else{e.preventDefault()}});d.delegate("[action-type=face_close]","click",function(e){e.preventDefault();v()});d.delegate("[action-type=category]","click",function(e){e.preventDefault();i(this).addClass("current").siblings().removeClass("current");var t=i(this).attr("_data");if(t){if(t==E)return;E=t;F()}});m.click(function(e){e.preventDefault();if(c=="general")return;m.addClass("current");g.removeClass("current");a.show();R("general","face")});g.click(function(e){e.preventDefault();if(c=="magic")return;m.removeClass("current");g.addClass("current");a.hide();n.html("");u.html('<li class="M_loading"></li>');R("magic","ani")});d.delegate("[action-type=insert]","click",function(e){if(!l.isLogin()){location.reload();return}var t=i(e.currentTarget);var n=t.attr("_data");if(n&&r){var s=r.val();var o=s.substring(0,N);var u=s.substring(N,s.length);var a=o+n+u;var f=n.length+N;r.val(a).focus().setCurPos(f)}d.hide()});d.delegate("[action-type=play]","click",function(e){if(!l.isLogin()){location.reload();return}var t=i(e.currentTarget);var n=t.attr("_data");p.PopUpSwfPlayer(n)})}function k(){var e='<div class="L_layer">                                <div class="bg">                                    <table border="0" cellspacing="0" cellpadding="0">                                            <tbody><tr>                                                <td>                                                    <div class="content">                                                        <a href="#" class="close" action-type="face_close"></a>                                                        <div class="m_tab M_txtb">                                                          <p class="M_txtb"><a href="#" class="current" node-type="general">常用表情</a><em class="M_vline"></em><a href="#" node-type="magic"><span class="M_ico ico_magic"></span>魔法表情</a></p>                                                        </div>                                                        <div class="L_faces">                                                            <p class="tab_kind M_linka">                                                                <span class="right" node-type="tabPage"></span>                                                                <em node-type="categorys"></em>                                                            </p>                                                            <div class="detail">                                                                <ul class="faces_list faces_list_hot clearfix" node-type="hotFace"></ul>                                                                <ul class="faces_list clearfix" node-type="inner"><li class="M_loading"></li></ul>                                                                <div class="m_pages_minibtn M_linke" node-type="page"></div>                                                            </div>                                                        </div>                                                    </div>                                                </td>                                            </tr>                                    </tbody></table>                                    <div class="arrow arrow_t" node-type="arrow"></div>                                </div>                            </div>';d=i(e);d.css("zIndex",2e4);n=d.find("em[node-type=categorys]");u=d.find("ul[node-type=inner]");a=d.find("ul[node-type=hotFace]");f=d.find("div[node-type=page]");w=d.find("span[node-type=tabPage]");m=d.find("a[node-type=general]");g=d.find("a[node-type=magic]");i(document.body).append(d)}function L(e,t){if(!l.isLogin()){location.reload();return}s({type:"get",dataType:"json",url:h+"sina/get_faces",data:{type:e},success:function(e){if(t&&typeof t==="function"){t.apply(this,arguments)}}})}function A(){b.initUI=function(){var e=[];if(this.pageIndex>1){e.push('<a href="#" index="prev" class="pre"></a>')}else{e.push('<a href="#" class="pre_d"></a>')}if(this.pageCount>1&&this.pageIndex<this.pageCount){e.push('<a href="#" index="next" class="next"></a>')}else{e.push('<a href="#" class="next_d"></a>')}this.ui.html(e.join(""))};b.init=function(e,t){this.pageIndex=1;this.pageSize=t;this.total=e;this.pageCount=this.total%this.pageSize===0?~~(this.total/this.pageSize):~~(this.total/this.pageSize)+1}}function O(e){var t=[];t=Object.keys(e);t.unshift("默认");return t}function M(){var t,n=[],r,i;if(e["general"]&&e["general"]["usual"]["hot"]){i=e["general"]["usual"]["hot"];for(var s=0,o=i.length;s<o;s++){t=i[s];r=t.phrase.replace(/\[([^\]]+)\]/,"$1");n.push('<li action-type="insert" _data="'+t.value+'"><img title="'+r+'" alt="'+r+'" src="'+t.url+'"></li>')}}a.html(n.join(""))}function _(e){var t=[],r;for(var i=e.start;i<=e.end;i++){r=x[i];t.push("<a "+(E==r?'class="current"':"")+' action-type="category" _data="'+r+'" href="#">'+r+"</a>");t.push('<em class="M_vline"></em>')}t.pop();n.html(t.join(""))}function D(){x=O(c!=="magic"?e["general"]["more"]:e["magic"]["more"]);b.init(x.length,5);b.initUI();_(b.getDataRange())}function P(){y.initUI=function(){var e=[],t=this.pageIndex;if(this.pageCount>1){if(t!==1){e.push('<a class="reverse" index="prev" href="#"></a>')}var n=this.pageCount;var r=1;r=r>this.pageCount?this.pageCount:r;for(var i=r;i<=n;i++){if(i!==t){e.push('<a href="#" index="'+i+'">'+i+"</a>")}else{e.push('<a href="#" class="current">'+i+"</a>")}}if(t!==this.pageCount){e.push('<a class="next" index="next" href="#"></a>')}}this.ui.html(e.join(""))};y.init=function(e,t){this.pageSize=t;this.total=e;this.pageIndex=1;this.pageCount=this.total%this.pageSize===0?~~(this.total/this.pageSize):~~(this.total/this.pageSize)+1}}function H(e){if(c!=="magic"){B(e)}else{j(e)}q()}function B(e){var t,n=[],r;if(S){for(var i=e.start,s=e.end;i<=s;i++){t=S[i];r=t.phrase.replace(/\[([^\]]+)\]/,"$1");n.push('<li action-type="insert" _data="'+t.value+'"><img title="'+r+'" alt="'+r+'" src="'+t.url+'"></li>')}}u.addClass("faces_list");u.removeClass("faces_magic_list");u.html(n.join(""))}function j(e){var t,n=[],r;if(S){for(var i=e.start,s=e.end;i<=s;i++){t=S[i];r=t.phrase.replace(/\[([^\]]+)\]/,"$1");n.push('<li><a href="#" action-type="insert" _data="'+t.value+' " class="img"><img src="'+t.url+'" title="'+r+'" alt="'+r+'" /></a><a href="#" action-type="play" _data="'+t.swf+'" class="M_ico play" title="表情预览"></a><span>'+r+"</span></li>")}}u.addClass("faces_magic_list");u.removeClass("faces_list");u.html(n.join(""))}function F(){var t=72,n;if(c!=="magic"){if(E!=="默认"){S=e["general"]["more"][E];a.hide()}else{S=e["general"]["usual"]["norm"];a.show()}}else{S=E!=="默认"?e["magic"]["more"][E]:e["magic"]["usual"]["norm"];t=12}y.init(S.length,t);y.initUI();n=y.getDataRange();H(n)}function I(){if(T){d.find("div[node-type=arrow]").attr("class","arrow arrow_b")}q();d.show()}function q(){var e=-30,n=5;if(t){var r=i(t).offset();var s=i(t).height();if(T){var o=d.height();d.css({top:r.top-o-n,left:r.left+e})}else{d.css({top:r.top+s+n,left:r.left+e})}}}function R(t,n){c=t;E="默认";if(!e[t]){L(n,function(n){if(n&&n.data){e[t]=n.data;M();D();F()}})}else{D();F()}}var e={};var t=null;var n=null;var r=null;var u=null;var a=null;var f=null;var c="general";var m=null;var g=null;var y=null;var b=null;var w=null;var E="默认";var S=null;var x=null;var T=false;var N;return function(e,n,i){t=e||t;T=i||T;r=n||r;N=r.getCurPos();if(!d)C();m.addClass("current");g.removeClass("current");R("general","face");I()}}();p.hide=function(){v()};p.PopUpSwfPlayer=function(){var e,t,n,r=360,s=440;return function(o){var f="view_ani",l,c=window,h=document,p=h.documentElement||{},d=h.body;if(!u.hasFlashPlayerVersion("9.0.0")){return}if(!t){t=i("<div></div>").css({position:"absolute",zIndex:20001});i(document.body).append(t)}t.html('<div id="'+f+'"></div>');var v=function(){var e="fixed",n=(i(window).height()-r)/2,o=(i(window).width()-s)/2;if(i.browser.msie&&i.browser.version=="6.0"){n+=i(document).scrollTop();o+=i(document).scrollLeft();e="absolute"}n=n>0?n:0;o=o>0?o:0;t.css({position:e,top:n,left:o})};if(!e){e=new a}v();var m={id:"view_ani",quality:"high",allowScriptAccess:"never",wmode:"transparent",allowFullscreen:true,allownetworking:"internal"};var g={playMovie:"true"};var y=function(t){if(t&&t.keyCode!==27&&(t.type!=="mouseup"||l&&l==t.target)){return}clearInterval(n);u.removeSWF(f);e.hide();i(document.body).unbind("mouseup keyup",y);if(!t){return}t.stopPropagation()};u.embedSWF(o,f,s,r,"10.0.0",null,g,m);e.show();c.clearInterval(n);i(document.body).bind("mouseup keyup",y);n=setInterval(function(){var e=0;l=u.getObjectById(f);if(l&&l.PercentLoaded()==100){c.clearInterval(n);n=setInterval(function(){var t=l.CurrentFrame(),n;try{n=l.TotalFrames()}catch(r){n=l.TotalFrames}if(t<0){return}if(t<n&&e<=t){e=t}else{y()}},80)}},100)}}();e.exports=p},G:function(e,t,n,r){var i=n("B");var s=function(e){var t=this;this.total=e.total||0;this.pageSize=e.pageSize||2;this.pageCount=this.total%this.pageSize===0?~~(this.total/this.pageSize):~~(this.total/this.pageSize)+1;this.updateCount=function(){t.pageCount=t.total%t.pageSize===0?~~(t.total/t.pageSize):~~(t.total/t.pageSize)+1};this.pageIndex=e.pageIndex||1;this.maxShowNum=e.maxShowNum==undefined?10:e.maxShowNum;this.leftcallback=e.leftcallback||function(){};this.rightcallback=e.rightcallback||function(){};this.ui=e.node||i('<div class="m_pages"></div>');this.callback=e.callback||function(){};this.scope=e.scope||this;this.uiMode=1;this.getDataRange=function(e){e=e||this.pageIndex;if(e>=1&&e<=this.pageCount){var t=this.pageSize*(e-1),n=t+this.pageSize-1;n=n>this.total-1?this.total-1:n;this.pageIndex=e;return{start:t,end:n,page:e}}};this.updateUI=function(e,t){this.total=e;this.pageIndex=t||this.pageIndex;this.pageCount=this.total%this.pageSize===0?~~(this.total/this.pageSize):~~(this.total/this.pageSize)+1;if(this.pageCount>1){if(this.uiMode==1){this.initUI(true)}else if(this.uiMode==2){this.initUI2()}else if(this.uiMode==3){this.initUI3()}}else{this.ui.html("")}};this.initUI=function(e){var t=[],n=this,r=parseInt(this.pageIndex,10);this.uiMode=1;if(this.pageCount>1){if(r!==1){t.push('<a href="#" index="prev" class="M_btn_c pre">上一页</a>')}t.push('<div class="list">');t.push('<div class="its" style="display:none">');var s=parseInt(this.maxShowNum/2,10);var o=this.pageIndex+s<=this.maxShowNum?1:this.pageIndex-this.maxShowNum+s;o=o>0?o:1;var u=o+this.maxShowNum-1;u=u>this.pageCount?this.pageCount:u;for(var a=u;a>=o;a--){if(a!==r){t.push('<a href="#" index="'+a+'">第 '+a+" 页</a>")}else{t.push('<a href="#" class="current">第 '+a+" 页</a>")}}t.push("</div>");if(parseInt(this.maxShowNum,10)===0){t.push('<span class="t">第 '+r+" 页</span>")}else{t.push('<a class="M_linke" href="#"><span class="t">第 '+r+' 页</span><span class="M_ico M_icon31"></span></a>')}t.push("</div>");if(r!==this.pageCount){t.push('<a class="M_btn_c next" index="next" href="#">下一页</a>')}t.push("</div>")}this.ui.html(t.join(""));if(!e){var f=null,l=null;this.ui.delegate(".list","mouseover",function(){if(n.maxShowNum>0){if(f)window.clearTimeout(f);if(l)window.clearTimeout(l);var e=this;l=setTimeout(function(){i(e).find(".its").show()},500)}});this.ui.delegate(".list","mouseout",function(){if(n.maxShowNum>0){var e=i(this).find(".its");if(l)window.clearTimeout(l);f=window.setTimeout(function(){e.hide()},500)}})}};this.initUI2=function(e){var t=[],n=this.pageIndex;this.uiMode=2;if(this.pageCount>1){if(n!==1){t.push('<a class="M_btn_c" href="#" index="prev">上一页</a>')}var r=parseInt(this.maxShowNum/2,10);var i=this.pageIndex+r<=this.maxShowNum?1:this.pageIndex-this.maxShowNum+r;var s=i+this.maxShowNum-1;s=s>this.pageCount?this.pageCount:s;i=i>0?i:1;if(i>2){t.push('<a href="#" index="1">1</a>');t.push('<span class="doccolor">...</span>')}for(var o=i;o<=s;o++){if(o!==n){t.push('<a href="#" index="'+o+'">'+o+"</a>")}else{t.push('<a href="#" class="current">'+o+"</a>")}}if(s<this.pageCount-1){t.push('<span class="doccolor">...</span>');t.push('<a href="#" index="'+this.pageCount+'">'+this.pageCount+"</a>")}if(n!==this.pageCount){t.push('<a class="M_btn_c" index="next" href="#">下一页</a>')}}this.ui.html(t.join(""))};this.initUI3=function(){var e=[],t=this.pageIndex;this.uiMode=3;if(this.pageCount>1){if(t!==1){e.push('<a class="M_btn_c" href="#" index="prev">上一页</a>')}if(this.pageCount>1){e.push('<a href="#" class="current" index="'+t+'">'+t+"</a>")}if(t!==this.pageCount){e.push('<a class="M_btn_c" index="next" href="#">下一页</a>')}}this.ui.html(e.join(""))};this.gotoPage=function(e){var t=this;switch(e){case"prev":if(t.pageIndex-1>=1){t.pageIndex--}if(t.leftcallback&&typeof t.leftcallback==="function"){t.leftcallback.apply(t.scope,[t.pageIndex-1])}break;case"next":if(t.pageIndex+1<=t.pageCount){t.pageIndex++}if(t.rightcallback&&typeof t.rightcallback==="function"){t.rightcallback.apply(t.scope,[t.pageIndex-1])}break;default:e=parseInt(e,10)||parseInt(e.match(/\d{1,}/)[0],10);if(e===t.pageIndex){return}t.pageIndex=e;break}if(t.uiMode==1){t.initUI(true)}else if(t.uiMode==2){t.initUI2()}else if(t.uiMode==3){t.initUI3()}};this.initListener=function(){var e,t,n=/^(?:body|html)$/i,r=this;i(this.ui).click(function(i){i.preventDefault();t=i.target;while(t&&t!==this&&!n.test(t.tagName)){if(t.getAttribute("index")){e=t.getAttribute("index");if(e){r.gotoPage(e);if(r.callback&&typeof r.callback==="function"){r.callback.apply(r.scope,[r.getDataRange()])}}break}t=t.parentNode}i.stopPropagation()})};this.initListener();this.destroy=function(){i(this.ui).unbind("click");i(this.ui).remove()}};e.exports=s},h:function(e,t,n,r){var i=function(){function k(){if(w){return}try{var e=f.getElementsByTagName("body")[0].appendChild(z("span"));e.parentNode.removeChild(e)}catch(t){return}w=true;var n=h.length;for(var r=0;r<n;r++){h[r]()}}function L(e){if(w){e()}else{h[h.length]=e}}function A(t){if(typeof a.addEventListener!=e){a.addEventListener("load",t,false)}else if(typeof f.addEventListener!=e){f.addEventListener("load",t,false)}else if(typeof a.attachEvent!=e){W(a,"onload",t)}else if(typeof a.onload=="function"){var n=a.onload;a.onload=function(){n();t()}}else{a.onload=t}}function O(){if(c){M()}else{_()}}function M(){var n=f.getElementsByTagName("body")[0];var r=z(t);r.setAttribute("type",s);var i=n.appendChild(r);if(i){var o=0;(function(){if(typeof i.GetVariable!=e){var t=i.GetVariable("$version");if(t){t=t.split(" ")[1].split(",");N.pv=[parseInt(t[0],10),parseInt(t[1],10),parseInt(t[2],10)]}}else if(o<10){o++;setTimeout(arguments.callee,10);return}n.removeChild(r);i=null;_()})()}else{_()}}function _(){var t=p.length;if(t>0){for(var n=0;n<t;n++){var r=p[n].id;var i=p[n].callbackFn;var s={success:false,id:r};if(N.pv[0]>0){var o=U(r);if(o){if(X(p[n].swfVersion)&&!(N.wk&&N.wk<312)){$(r,true);if(i){s.success=true;s.ref=D(r);i(s)}}else if(p[n].expressInstall&&P()){var u={};u.data=p[n].expressInstall;u.width=o.getAttribute("width")||"0";u.height=o.getAttribute("height")||"0";if(o.getAttribute("class")){u.styleclass=o.getAttribute("class")}if(o.getAttribute("align")){u.align=o.getAttribute("align")}var a={};var f=o.getElementsByTagName("param");var l=f.length;for(var c=0;c<l;c++){if(f[c].getAttribute("name").toLowerCase()!="movie"){a[f[c].getAttribute("name")]=f[c].getAttribute("value")}}H(u,a,r,i)}else{B(o);if(i){i(s)}}}}else{$(r,true);if(i){var h=D(r);if(h&&typeof h.SetVariable!=e){s.success=true;s.ref=h}i(s)}}}}}function D(n){var r=null;var i=U(n);if(i&&i.nodeName=="OBJECT"){if(typeof i.SetVariable!=e){r=i}else{var s=i.getElementsByTagName(t)[0];if(s){r=s}}}return r}function P(){return!E&&X("6.0.65")&&(N.win||N.mac)&&!(N.wk&&N.wk<312)}function H(t,n,r,i){E=true;y=i||null;b={success:false,id:r};var s=U(r);if(s){if(s.nodeName=="OBJECT"){m=j(s);g=null}else{m=s;g=r}t.id=o;if(typeof t.width==e||!/%$/.test(t.width)&&parseInt(t.width,10)<310){t.width="310"}if(typeof t.height==e||!/%$/.test(t.height)&&parseInt(t.height,10)<137){t.height="137"}f.title=f.title.slice(0,47)+" - Flash Player Installation";var u=N.ie&&N.win?"ActiveX":"PlugIn",l="MMredirectURL="+encodeURI(a.location).toString().replace(/&/g,"%26")+"&MMplayerType="+u+"&MMdoctitle="+f.title;if(typeof n.flashvars!=e){n.flashvars+="&"+l}else{n.flashvars=l}if(N.ie&&N.win&&s.readyState!=4){var c=z("div");r+="SWFObjectNew";c.setAttribute("id",r);s.parentNode.insertBefore(c,s);s.style.display="none";(function(){if(s.readyState==4){s.parentNode.removeChild(s)}else{setTimeout(arguments.callee,10)}})()}F(t,n,r)}}function B(e){if(N.ie&&N.win&&e.readyState!=4){var t=z("div");e.parentNode.insertBefore(t,e);t.parentNode.replaceChild(j(e),t);e.style.display="none";(function(){if(e.readyState==4){e.parentNode.removeChild(e)}else{setTimeout(arguments.callee,10)}})()}else{e.parentNode.replaceChild(j(e),e)}}function j(e){var n=z("div");if(N.win&&N.ie){n.innerHTML=e.innerHTML}else{var r=e.getElementsByTagName(t)[0];if(r){var i=r.childNodes;if(i){var s=i.length;for(var o=0;o<s;o++){if(!(i[o].nodeType==1&&i[o].nodeName=="PARAM")&&!(i[o].nodeType==8)){n.appendChild(i[o].cloneNode(true))}}}}}return n}function F(n,r,i){var o,u=U(i);if(N.wk&&N.wk<312){return o}if(u){if(typeof n.id==e){n.id=i}if(N.ie&&N.win){var a="";for(var f in n){if(n[f]!=Object.prototype[f]){if(f.toLowerCase()=="data"){r.movie=n[f]}else if(f.toLowerCase()=="styleclass"){a+=' class="'+n[f]+'"'}else if(f.toLowerCase()!="classid"){a+=" "+f+'="'+n[f]+'"'}}}var l="";for(var c in r){if(r[c]!=Object.prototype[c]){l+='<param name="'+c+'" value="'+r[c]+'" />'}}u.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+a+">"+l+"</object>";d[d.length]=n.id;o=U(n.id)}else{var h=z(t);h.setAttribute("type",s);for(var p in n){if(n[p]!=Object.prototype[p]){if(p.toLowerCase()=="styleclass"){h.setAttribute("class",n[p])}else if(p.toLowerCase()!="classid"){h.setAttribute(p,n[p])}}}for(var v in r){if(r[v]!=Object.prototype[v]&&v.toLowerCase()!="movie"){I(h,v,r[v])}}u.parentNode.replaceChild(h,u);o=h}}return o}function I(e,t,n){var r=z("param");r.setAttribute("name",t);r.setAttribute("value",n);e.appendChild(r)}function q(e){var t=U(e);if(t&&t.nodeName=="OBJECT"){if(N.ie&&N.win){t.style.display="none";(function(){if(t.readyState==4){R(e)}else{setTimeout(arguments.callee,10)}})()}else{t.parentNode.removeChild(t)}}}function R(e){var t=U(e);if(t){for(var n in t){if(typeof t[n]=="function"){t[n]=null}}t.parentNode.removeChild(t)}}function U(e){var t=null;try{t=f.getElementById(e)}catch(n){}return t}function z(e){return f.createElement(e)}function W(e,t,n){e.attachEvent(t,n);v[v.length]=[e,t,n]}function X(e){var t=N.pv,n=e.split(".");n[0]=parseInt(n[0],10);n[1]=parseInt(n[1],10)||0;n[2]=parseInt(n[2],10)||0;return t[0]>n[0]||t[0]==n[0]&&t[1]>n[1]||t[0]==n[0]&&t[1]==n[1]&&t[2]>=n[2]?true:false}function V(n,r,i,s){if(N.ie&&N.mac){return}var o=f.getElementsByTagName("head")[0];if(!o){return}var u=i&&typeof i=="string"?i:"screen";if(s){S=null;x=null}if(!S||x!=u){var a=z("style");a.setAttribute("type","text/css");a.setAttribute("media",u);S=o.appendChild(a);if(N.ie&&N.win&&typeof f.styleSheets!=e&&f.styleSheets.length>0){S=f.styleSheets[f.styleSheets.length-1]}x=u}if(N.ie&&N.win){if(S&&typeof S.addRule==t){S.addRule(n,r)}}else{if(S&&typeof f.createTextNode!=e){S.appendChild(f.createTextNode(n+" {"+r+"}"))}}}function $(e,t){if(!T){return}var n=t?"visible":"hidden";if(w&&U(e)){U(e).style.visibility=n}else{V("#"+e,"visibility:"+n)}}function J(t){var n=/[\\\"<>\.;]/;var r=n.exec(t)!=null;return r&&typeof encodeURIComponent!=e?encodeURIComponent(t):t}var e="undefined",t="object",n="Shockwave Flash",r="ShockwaveFlash.ShockwaveFlash",s="application/x-shockwave-flash",o="SWFObjectExprInst",u="onreadystatechange",a=window,f=document,l=navigator,c=false,h=[O],p=[],d=[],v=[],m,g,y,b,w=false,E=false,S,x,T=true,N=function(){var i=typeof f.getElementById!=e&&typeof f.getElementsByTagName!=e&&typeof f.createElement!=e,o=l.userAgent.toLowerCase(),u=l.platform.toLowerCase(),h=u?/win/.test(u):/win/.test(o),p=u?/mac/.test(u):/mac/.test(o),d=/webkit/.test(o)?parseFloat(o.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,v=!+"1",m=[0,0,0],g=null;if(typeof l.plugins!=e&&typeof l.plugins[n]==t){g=l.plugins[n].description;if(g&&!(typeof l.mimeTypes!=e&&l.mimeTypes[s]&&!l.mimeTypes[s].enabledPlugin)){c=true;v=false;g=g.replace(/^.*\s+(\S+\s+\S+$)/,"$1");m[0]=parseInt(g.replace(/^(.*)\..*$/,"$1"),10);m[1]=parseInt(g.replace(/^.*\.(.*)\s.*$/,"$1"),10);m[2]=/[a-zA-Z]/.test(g)?parseInt(g.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else if(typeof a.ActiveXObject!=e){try{var y=new ActiveXObject(r);if(y){g=y.GetVariable("$version");if(g){v=true;g=g.split(" ")[1].split(",");m=[parseInt(g[0],10),parseInt(g[1],10),parseInt(g[2],10)]}}}catch(b){}}return{w3:i,pv:m,wk:d,ie:v,win:h,mac:p}}(),C=function(){if(!N.w3){return}if(typeof f.readyState!=e&&f.readyState=="complete"||typeof f.readyState==e&&(f.getElementsByTagName("body")[0]||f.body)){k()}if(!w){if(typeof f.addEventListener!=e){f.addEventListener("DOMContentLoaded",k,false)}if(N.ie&&N.win){f.attachEvent(u,function(){if(f.readyState=="complete"){f.detachEvent(u,arguments.callee);k()}});if(a==top){(function(){if(w){return}try{f.documentElement.doScroll("left")}catch(e){setTimeout(arguments.callee,0);return}k()})()}}if(N.wk){(function(){if(w){return}if(!/loaded|complete/.test(f.readyState)){setTimeout(arguments.callee,0);return}k()})()}A(k)}}();var K=function(){if(N.ie&&N.win){window.attachEvent("onunload",function(){var e=v.length;for(var t=0;t<e;t++){v[t][0].detachEvent(v[t][1],v[t][2])}var n=d.length;for(var r=0;r<n;r++){q(d[r])}for(var s in N){N[s]=null}N=null;for(var o in i){i[o]=null}i=null})}}();return{registerObject:function(e,t,n,r){if(N.w3&&e&&t){var i={};i.id=e;i.swfVersion=t;i.expressInstall=n;i.callbackFn=r;p[p.length]=i;$(e,false)}else if(r){r({success:false,id:e})}},getObjectById:function(e){if(N.w3){return D(e)}},embedSWF:function(n,r,i,s,o,u,a,f,l,c){var h={success:false,id:r};if(N.w3&&!(N.wk&&N.wk<312)&&n&&r&&i&&s&&o){$(r,false);L(function(){i+="";s+="";var p={};if(l&&typeof l===t){for(var d in l){p[d]=l[d]}}p.data=n;p.width=i;p.height=s;var v={};if(f&&typeof f===t){for(var m in f){v[m]=f[m]}}if(a&&typeof a===t){for(var g in a){if(typeof v.flashvars!=e){v.flashvars+="&"+g+"="+a[g]}else{v.flashvars=g+"="+a[g]}}}if(X(o)){var y=F(p,v,r);if(p.id==r){$(r,true)}h.success=true;h.ref=y}else if(u&&P()){p.data=u;H(p,v,r,c);return}else{$(r,true)}if(c){c(h)}})}else if(c){c(h)}},switchOffAutoHideShow:function(){T=false},ua:N,getFlashPlayerVersion:function(){return{major:N.pv[0],minor:N.pv[1],release:N.pv[2]}},hasFlashPlayerVersion:X,createSWF:function(e,t,n){if(N.w3){return F(e,t,n)}else{return undefined}},showExpressInstall:function(e,t,n,r){if(N.w3&&P()){H(e,t,n,r)}},removeSWF:function(e){if(N.w3){q(e)}},createCSS:function(e,t,n,r){if(N.w3){V(e,t,n,r)}},addDomLoadEvent:L,addLoadEvent:A,getQueryParamValue:function(e){var t=f.location.search||f.location.hash;if(t){if(/\?/.test(t)){t=t.split("?")[1]}if(e==null){return J(t)}var n=t.split("&");for(var r=0;r<n.length;r++){if(n[r].substring(0,n[r].indexOf("="))==e){return J(n[r].substring(n[r].indexOf("=")+1))}}}return""},expressInstallCallback:function(){if(E){var e=U(o);if(e&&m){e.parentNode.replaceChild(m,e);if(g){$(g,true);if(N.ie&&N.win){m.style.display="block"}}if(y){y(b)}}E=false}}}}();e.exports=i},H:function(e,t,n,r){function d(e){if(!h[e]){h[e]="\\u"+("0000"+(+e.charCodeAt(0)).toString(16)).slice(-4)}return h[e]}function v(e){return'"'+e.replace(c,d)+'"'}function m(e,t,n){var r={},i=e.getAttribute(o)||e.getAttribute("id");if(i&&(t||!e.disabled)){switch(e.tagName){case"INPUT":var s=e.getAttribute("type");if(s==="radio"||s==="checkbox"){if(e.checked){r[o]=i;r[u]=e.value}else{r=false}}else if(s==="reset"||s==="submit"||s==="image"){r=false}else if(i){r[o]=i;if(n){r[u]=e.value.trim()==e.title?"":e.value.trim()}else{r[u]=e.value.trim()}}else{r=false}break;case"SELECT":if(e.multiple){var a=e.options;r[o]=i;r[u]=[];for(var f=0,l=a.length;f<l;f++){if(a[f].selected){r[u].push(a[f].value)}}}else{r[o]=i;r[u]=e.value}break;case"TEXTAREA":r[o]=i;if(n){r[u]=e.value.trim()==e.title?"":e.value.trim()}else{r[u]=e.value.trim()}break;case"BUTTON":default:r[o]=i;r[u]=e.value||e.getAttribute("value")||e.innerHTML||false;break}return r}return false}function g(e,t,n,r,a){t=t||["INPUT","TEXTAREA","BUTTON","SELECT"];if(typeof e==="string"){e=s.forms[e]}if(!e||e.nodeType!==1){return false}var f={},l=t.length>>0,c;while(l--){c=e.getElementsByTagName(t[l]);for(var h=0,p=c.length,d;h<p;h++){d=m(c[h],r,a);if(!d||n&&d[u]===""){continue}if(f[d[o]]||f[d[o]]==""){if(i.isArray(f[d[o]])){f[d[o]].push(d[u])}else{f[d[o]]=[f[d[o]]].concat(d[u])}}else{f[d[o]]=d.value}}}return f}function y(e){var t=[],n,r,i,s,o,u;switch(e.nodeType){case 1:i=e.tagName;t.push("<"+i);u=-1;s=e.attributes;while(o=s[++u]){t.push(" "+o.nodeName+'="'+o.nodeValue+'"')}if(e.hasChildNodes()){u=-1;s=e.childNodes;t.push(">");while(o=s[++u]){t.push(y(o))}t.push("</"+i+">")}else{if(l.test(i)){t.push(" />")}else{t.push("></"+i+">")}}break;case 3:t.push(e.nodeValue);break;case 4:t.push("<![CDATA["+e.data+"]]>");break;default:break}return t.join("")}function b(e){var t,n;try{if(window.DOMParser){n=new DOMParser;t=n.parseFromString(e,"text/xml")}else{t=new ActiveXObject("Microsoft.XMLDOM");t.async="false";t.loadXML(e)}}catch(r){t=undefined}if(!t||!t.documentElement||t.getElementsByTagName("parsererror").length){}return t}function w(e){function n(e,r){var i=e[r],s=typeof i,o=[],u=":",a=",",f="null",l,c,h,d,m;if(i&&typeof i==="object"&&typeof i.toJSON==="function"){i=i.toJSON(r)}if(i!==e[r]){s=typeof i}if(i===null)return f;switch(s){case"object":break;case"string":return v(i);case"number":return isFinite(i)?i+"":f;case"boolean":default:return String(i)}for(c=t.length-1;c>=0;--c){if(t[c]===i){throw new Error("JSON.stringify. Cyclical reference")}}l=p.call(i)==="[object Array]"||"length"in i&&i.slice;t.push(i);if(l){for(c=i.length-1;c>=0;--c){o[c]=n(i,c)||f}}else{h=i;c=0;for(d in h){if(h.hasOwnProperty(d)){m=n(i,d);if(m){o[c++]=v(d)+u+m}}}}t.pop();return l?"["+o.join(a)+"]":"{"+o.join(a)+"}"}var t=[];return n({"":e},"")}var i=n("B");n("i");var s=window.document,o="name",u="value",a=function(e,t,n){t=t===undefined?10:t;var r=arguments;if(r.length<4&&!n){return setTimeout(e,t)}r=r.length>3?Array["prototype"].slice.call(r,3):[];return setTimeout(function(){e.apply(n,r)},t)},f=window.clearTimeout,l=/^(?:area|br|col|embed|hr|img|input|link|meta|param)$/i;var c=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,h={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},p=Object.prototype.toString;i.fn.extend({getCurPos:function(){var e=i(this).get(0);e.focus();if(e.selectionStart){return e.selectionStart}if(s.selection){var t=s.selection.createRange();if(t==null){return e.value.length}var n=e.createTextRange();var r=n.duplicate();n.moveToBookmark(t.getBookmark());r.setEndPoint("EndToStart",n);return r.text.length}return e.value.length},setCurPos:function(e){var t=i(this).get(0);t.focus();if(t.setSelectionRange){t.setSelectionRange(e,e)}else if(t.createTextRange){var n=t.createTextRange();n.collapse(true);n.moveEnd("character",e);n.moveStart("character",e);n.select()}}});var E={getInputOffset:function(e,t){var n=this,r="{$clone_div}",i="{$cloneLeft}",o="{$cloneFocus}",u="{$cloneRight}",a='<span style="white-space:pre-wrap;"> </span>',f=e[r]||s.createElement("div"),l=e[i]||s.createElement("span"),c=e[o]||s.createElement("span"),h=e[u]||s.createElement("span"),p=n._offset(e),d=this._getFocus(e),v={left:0,top:0};if(!e[r]){e[r]=f;e[i]=l;e[o]=c;e[u]=h;f.appendChild(l);f.appendChild(c);f.appendChild(h);s.body.appendChild(f);c.innerHTML="|";c.style.cssText="display:inline-block;width:0px;overflow:hidden";f.className=this._cloneStyle(e);f.style.cssText="/*visibility:hidden;*/display:inline-block;position:absolute;z-index:-9999;left:0;top:0;visibility:hidden;word-wrap:break-word;word-break:break-all;overflow:hidden"}f.style.width=this._getStyle(e,"width");f.style.height=this._getStyle(e,"height");try{f.scrollLeft=e.scrollLeft;f.scrollTop=e.scrollTop}catch(m){}l.innerHTML=e.value.substring(0,d).replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br/>").replace(/\s/g,a);h.innerHTML=e.value.substring(d,e.value.length).replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br/>").replace(/\s/g,a);c.style.display="inline-block";try{v=this._offset(c)}catch(m){}c.style.display="none";return{left:p.left+v.left,top:p.top+v.top+(t?c.offsetHeight:0)}},_cloneStyle:function(e,t){if(!t&&e["${cloneName}"])return e["${cloneName}"];var n,r,i=/^(number|string)$/,s=/^(content|outline|outlineWidth)$/,o=[],u=e.style;for(r in u){if(!s.test(r)){val=this._getStyle(e,r);if(val!==""&&i.test(typeof val)){r=r.replace(/([A-Z])/g,"-$1").toLowerCase();o.push(r);o.push(":");o.push(val);o.push(";")}}}o=o.join("");e["${cloneName}"]=n="clone"+(new Date).getTime();this._addHeadStyle("."+n+"{"+o+"}");return n},_addHeadStyle:function(e){var t=this._style[s];if(!t){t=this._style[s]=s.createElement("style");s.getElementsByTagName("head")[0].appendChild(t)}t.styleSheet&&(t.styleSheet.cssText+=e)||t.appendChild(s.createTextNode(e))},_style:{},_getStyle:"getComputedStyle"in window?function(e,t){return getComputedStyle(e,null)[t]}:function(e,t){return e.currentStyle[t]},_addEvent:function(e,t,n){e.addEventListener?e.addEventListener(t,n,false):e.attachEvent("on"+t,n)},_getFocus:function(e){var t=0;if(e.nodeName==="TEXTAREA"){if(s.selection){e.focus();var n=s.selection.createRange();var r=n.duplicate();r.moveToElementText(e);var t=-1;while(r.inRange(n)){r.moveStart("character");t++}}else if(e.selectionStart||e.selectionStart=="0"){t=e.selectionStart}var i=e.value.substring(0,t);var o=i.lastIndexOf("@");return o}else{if(s.selection){e.focus();var n=s.selection.createRange();n.moveStart("character",-e.value.length);t=n.text.length}else if(e.selectionStart||e.selectionStart=="0"){t=e.selectionStart}return t}},_offset:function(e){var t=e.getBoundingClientRect(),n=e.ownerDocument,r=n.body,i=n.documentElement,s=i.clientTop||r.clientTop||0,o=i.clientLeft||r.clientLeft||0,u=t.top+(self.pageYOffset||i.scrollTop)-s,a=t.left+(self.pageXOffset||i.scrollLeft)-o;return{left:a,top:u}}};e.exports={form2json:g,node2str:y,parseXML:b,stringify:w,textareaPosition:E,cookie:function(e,t,n,r){if(t===undefined){e+="=";t=s.cookie.split(";");for(var i=0,o=t.length;i<o;i++){for(r=t[i];r.charAt(0)===" ";)r=r.substring(1,r.length);if(r.indexOf(e)===0){return decodeURIComponent(r.substring(e.length,r.length))}}return null}else{var u="";if(n){u=new Date;u.setTime(u.getTime()+n*864e5);u="; expires="+u.toGMTString()}s.cookie=e+"="+t+u+"; path=/"+(r?";domain="+r:"")}},timer:function(e,t,n){var r=a(function i(){if(e.call(n)===true){r=a(i,t,this)}else{f(r);r=null}},t,n);return r}}},i:function(e,t,n,r){String.prototype.trim=function(){var e=this.replace(/(^\s*)|(\s*$)/g,"");return e.replace(/(^　*)|(　*$)/g,"")};String.prototype.encodeHTML=function(){var e=document.createElement("div");e.appendChild(document.createTextNode(this));return e.innerHTML.replace(/\s/g,"&nbsp;").replace(/"/g,"&quot;")};String.prototype.getByteLength=function(){return this.replace(/[^\x00-\xff]/g,"rr").length};String.prototype.decodeHTML=function(){return this.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&nbsp;/g," ").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&amp;/g,"&")};String.prototype.cutString=function(e,t,n){var r=this,t=t||"";if(!!n===false){r=this.decodeHTML();if(r.getByteLength()<=e)return r.encodeHTML();var i=Math.floor(e/2);for(var s=i,o=r.getByteLength();s<=o;s++){if(r.substr(0,s).getByteLength()>e){return(r.substr(0,s-1)+t).encodeHTML()}}return(r+t).encodeHTML()}else{if(r.getByteLength()<=e)return r;var i=Math.floor(e/2);for(var s=i,o=r.getByteLength();s<=o;s++){if(r.substr(0,s).getByteLength()>e){return r.substr(0,s-1)+t}}return r+t}};if(!Array.prototype.lastIndexOf){Array.prototype.lastIndexOf=function(e,t){var n=this.length,r=t===null?n-1:t;if(r<0)r=Math.max(0,n+r);for(;r>=0;r--){if(r in this&&this[r]===e)return r}return-1}}if(!Array.prototype.filter){Array.prototype.filter=function(e,t){var n=t||window;var r=[];for(var i=0,s=this.length;i<s;++i){if(!e.call(n,this[i],i,this)){continue}r.push(this[i])}return r}}var i={}.toString;if(!Array.prototype.forEach){Array.prototype.forEach=function(e){var t=this.length;if(i.call(e)!=="[object Function]"){throw new TypeError}var n=arguments[1];for(var r=0;r<t;r++){if(r in this){e.call(n,this[r],r,this)}}}}Object.keys||(Object.keys=function(e){var t=[];for(var n in e){t.push(n)}return t});String.prototype.hasDoubleByte=function(e){return e?/^[^\x00-\xff]+$/.test(this):/[^\x00-\xff]/.test(this)};String.prototype.getByteLength=function(){return this.hasDoubleByte()?this.replace(/[^\x00-\xff]/g,"**").length:this.length};String.prototype.sliceByte=function(e,t){var n=this.slice(0,e);if(n.hasDoubleByte()){var r=n.getByteLength();while(r>e){r-=n.charAt(n.length-1).getByteLength();n=n.slice(0,-1)}if(r<e&&t)n+=this.charAt(n.length)}return n};String.prototype.cutHtml=function(e,t,n){var r=arguments.length,i="",s=0,o=[],u=0;var a=/([\s\S]*?)(<\/?([a-zA-Z0-9]+)[^>]*>|$)/gi;var f=100,l=0,c=false;while(s<e&&a.exec(this)){l++;if(l>=f)break;var h=RegExp.$1,p=RegExp.$2,d=RegExp.$3,v=r>2?h.getByteLength():h.length;s+=v;if(p){if(p.indexOf("</")!==0){if(s>=e)p="</"+o.splice(o.length-1,1)+">";else o.push(d)}else if((u=o.lastIndexOf(d))>-1){o.splice(u,1)}}if(s>e){var m=r>2?h.sliceByte(e-s+v,n):h.slice(0,e-s+v);i+=m+t+p}else if(s==e)i+=h+t+p;else i+=h+p}var g=o.length;if(g){if($.msie&&/^(p|li|dt|dd|tr|th|td)$/i.test(o[g-1])&&!RegExp("</"+RegExp.$1+">$","i").test(i))i+="</"+o.splice(g-1,1)+">";o=o.filter(function(e){return!this.test(e)},$.msie?/^(abbr|br|col|img|input|link|meta|param|hr|area|embed|p|li|dt|dd|tr|th|td)$/i:/^(abbr|br|col|img|input|link|meta|param|hr|area|embed)$/i);if(o.length)i+="</"+o.reverse().join("></")+">"}return i}},I:function(e,t,n,r){var i=n("B");var s=function(e){var t={target:null,goal:null,type:"mouseenter"};i.extend(t,e);this.config=t;this.timer=null};s.prototype={constructor:s,__setTimer:function(e){var t=this,n=t.config;if(e){t.timer=setTimeout(function(){if(n.goal)n.goal.hide()},100)}},destroy:function(){var e=this,t=e.config;i(t.target).die();i(t.goal).die();if(e.timer)e.timer=null},init:function(){var e=this,t=e.config;if(!t.target)new Error("target must be have");t.target.each(function(n,r){var s="mouseleave",o=t.goal&&t.goal.length===1;if(t.type==="enter"){t.type="focus";s="blur"}i(r).live(t.type,function(s){clearTimeout(e.timer);s.preventDefault();i(e).trigger("enter",[this,n,s]);if(t.type==="focus"){if(r.title==i.trim(r.value))r.value=""}else{if(t.goal&&i.trim(t.goal.eq(n).text())!==""){t.goal.eq(n).show()}}});if(t.goal){t.goal.live("mouseenter focus click mousemove",function(){if(e.timer)clearTimeout(e.timer)});t.goal.live(s,function(){clearTimeout(e.timer);e.__setTimer(o)})}i(r).live(s,function(t){var u=this;clearTimeout(e.timer);i(e).trigger("leave",[u,n,t]);if(s==="blur"){if(i.trim(r.value)==="")r.value=r.title}else{e.__setTimer(o)}})})}};e.exports=s},j:function(e,t,n,r){var i=n("B");var s=n("b");var o=n("I");var u=n("J");var a=n("d");var f={init:function(){function f(e,t){if(a.isLogin()){i(t).addClass("focus")}}function l(e,t){i(t).removeClass("focus")}var e=i("li[node-type=show_menu]"),t=i("input[node-type=search_input]"),n=i("a[node-type=search_btn]"),r=new o({target:e}),s=new o({target:t,type:"enter"});i(r).bind("enter",f);i(r).bind("leave",l);r.init();s.init();if(t.get(0)){(new u(t.get(0),n.get(0))).init()}}};e.exports=f},J:function(e,t,n,r){var i=n("B");var s=n("C");var o=n("e");var u=n("k");n("i");var a=o.baseURL;var f=10;var l=function(e,t,n,r){var o=this;this.count=r||10;this.inputEl=e;this.autoComplete=null;this.container=n;this.searchBtn=t;var f=i("[node-type=search_input]");this.init=function(){if(this.searchBtn){i(this.searchBtn).click(this.onclick);var e=i(this.searchBtn).parent("form").get(0);if(e)e.onsubmit=this.onclick}f.focus(function(){i(this).closest("div.search").addClass("focus")});f.blur(function(){i(this).closest("div.search").removeClass("focus")})};this.onclick=function(){var e=o.inputEl.value;if(e.trim()===""||e=="搜索您感兴趣的标签"){i(this).val("");f[0].focus()}else{var t=a+"tags/search?tag="+encodeURIComponent(e);location.href=t}return false};this.init2=function(){if(!this.container){var e=i('<div class="L_menu_list"></div>');this.container=e.get(0);i(document.body).append(e)}if(this.searchBtn){i(this.searchBtn).click(function(e){var t=i.trim(o.inputEl.value);if(t)o.openWindow(t);e.preventDefault()})}this.autoComplete=new u({inputEle:this.inputEl,itemTagName:"li",highlightClassName:"cur",normalClassName:"",position:true,width:180,createListFun:function(e,t){var n=this;o.getData(e,function(e){var r=[],i;if(e.length>0){r.push('<ul class="srchList">');for(var s=0,o=e.length;s<o;s++){i=e[s].suggestion||"";r.push('<li id="s_'+s+'" key="'+i+'" ><a href="#" target="_blank">搜<span class="M_txte">"<em>'+i.cutString(12,"...")+'</em>"</span>相关微博»</a></li>')}r.push("</ul>")}if(t&&typeof t=="function"){t.call(n,r.join(""))}})},afterItemSelected:function(e){o.openWindow(e)},container:o.container})};this.getData=function(e,t){s({url:a+"sina/aj_search_status",type:"post",dataType:"json",data:{key:e,count:this.count},success:function(n){if(n&&n.result){if(t&&typeof t==="function"){t.call(this,n.data,e)}}}})};this.openWindow=function(e){var t;if(e){t=encodeURI("http://s.weibo.com/weibo/"+e+"?&topsug=1");window.open(t,"_blank")}}};e.exports=l},k:function(e,t,n,r){function s(e,t){return e.getElementsByTagName(t)}var i=n("B");var o=function(e){this.options=e||{};this.containerWidth=e.width||null;this.inputEle=e.inputEle;this.container=e.container;this.position=e.position;this.options.beforeItemSelected=e.beforeItemSelected||"";this.options.afterItemSelected=e.afterItemSelected||"";this.initCallback=e.initCallback||function(){};this.eventKeycode="";this.lastText=this.inputEle.value;this.selectedIndex=-1;this.initialize()};o.prototype={constructor:o,initialize:function(){var e=this;this.inputEle.setAttribute("autocomplete","off");i(this.inputEle).bind("blur",function(t){e.onBlurHandler(t)});i(this.inputEle).bind("keyup",function(t){e.onKeyUpHandler(t)});i(this.inputEle).bind("keydown",function(t){e.onKeyDownHandler(t)});i(this.inputEle).bind("paste",function(t){e.onPaste(t)});this.initContainer();this.initCallback(this)},onPaste:function(){var e=this;setTimeout(function(){e.inputCheck()},1)},onSize:function(e){try{e.data.host.calculateContainerWidth();e.data.host.calculateContainerPos()}catch(e){}},initContainer:function(){var e=this.container,t=this;e.id=e.id||"suggest_"+(new Date).getTime();if(this.position)e.style.position="absolute";e.style.zIndex=11e3;e.style.display="none";this.calculateContainerWidth();this.calculateContainerPos();i(window).bind("resize",{host:t},this.onSize)},calculateContainerPos:function(){if(this.position){var e=this.inputEle,t=i(e).position(),n=i(this.container);n.css({top:t.top+e.offsetHeight,left:t.left})}},calculateContainerWidth:function(){var e=i(this.container);if(this.containerWidth){e.css("width",this.containerWidth)}else{var t=parseInt(e.css("borderLeftWidth")||0,10),n=parseInt(e.css("borderRightWidth")||0,10),r=parseInt(e.css("paddingLeftWidth")||0,10),s=parseInt(e.css("paddingRightWidth")||0,10);e.css("width",this.inputEle.offsetWidth-t-n-r-s-2)}},onKeyDownHandler:function(e){var t=this.eventKeycode=e.keyCode||e.which;if(t===38||t===40){e.stopPropagation();this.handleKeyUpDown()}},handleKeyUpDown:function(){if(this.container.style.display==="none"){return}this.highlightItem(parseInt(this.selectedIndex,10)+(this.eventKeycode===40?1:-1))},highlightItem:function(e){var t=i(this.container).find(this.options.itemTagName),n,r=t.length;for(n=0;n<r;n++){t[n].className=this.options.normalClassName}if(e<0){e=r-1}if(e>r-1){e=0}t[e].className=this.options.highlightClassName;this.selectedIndex=e},onKeyUpHandler:function(e){this.eventKeycode=e.keyCode||e.which;if(this.eventKeycode===13&&this.selectedIndex>=0){this.selectItem(s(this.container,this.options.itemTagName)[this.selectedIndex]);return}this.inputCheck()},selectItem:function(e){var t=this.options,n=t.beforeItemSelected,r=t.afterItemSelected,i=true;typeof n==="function"&&(i=n.call(this,e));if(i===false){return}this.lastText=this.inputEle.value=e.getAttribute("key");this.hideContainer();this.selectedIndex=-1;typeof r==="function"&&r(this.lastText)},inputCheck:function(){var e=this.inputEle.value;if(this.lastText!==e){this.lastText=e;if(e){this.clearData();this.createList(e)}else{this.hideContainer()}}},createList:function(e){var t=this.options,n=t.createListFun;if(n&&typeof n=="function"){n.call(this,e,function(e){this.container.innerHTML=e;this.attachEvents();this.selectedIndex=-1;this.showContainer()})}},attachEvents:function(){var e=s(this.container,this.options.itemTagName),t,n=e.length,r=this;for(t=0;t<n;t++){(function(e){i(e).mouseover(function(t){r.itemMOverHandlder(t,e)});i(e).mousedown(function(t){r.itemMDownHandlder(t,e)});i(e).mouseout(function(t){r.itemMOutHandlder(t,e)})})(e[t])}},itemMDownHandlder:function(e,t){this.selectItem(t)},itemMOverHandlder:function(e,t){if(t.id)this.highlightItem(parseInt(t.id.split("_")[1],10))},itemMOutHandlder:function(e,t){t.className=this.options.normalClassName;this.selectedIndex=-1},onBlurHandler:function(){this.hideContainer()},showContainer:function(){i(this.container).show()},hideContainer:function(){i(this.container).hide()},clearData:function(){var e=i(this.container);e.hide();e.html("")},reset:function(){i(this.inputEle).unbind();i(window).unbind("resize",this.onSize)},destory:function(){i(this.container).remove();this.inputEle.setAttribute("autocomplete","on");this.reset();i(s(this.container,this.options.itemTagName)).each(function(){i(this).unbind()})},setPosition:function(e){i(this.container).css({top:e.top,left:e.left})}};e.exports=o},K:function(e,t,n,r){var i=n("l");var s=n("B");var o=n("b");var u=n("e");var a=n("C");var f=n("L");var l=n("m");var c=n("M");var h=n("G");var p=n("g");var d=n("D");var v=n("n").DetailTool;n("o");n("i");n("p");var m=u.baseURL;var g=new d;var y=function(e){var t=this,n=["comment_wrap","count_wrap","comment_txt","comment_reply_box","comment_reply_txt","comment_reply_btn","comment_del_btn","comment_report_btn","comment_content","comment_face","comment_intransit","comment_allreply_wrap","comment_mini_reply_wrap","comment_mini_txt","comment_mini_reply_btn","comment_mini_reply_box","comment_mini_intransit","comment_card","comment_pag"];this._dom={};this.lock=false;this.forceClear=false;this.CacheData={};this.createDOM=function(e){var t=this;s.each(e,function(e,n){t._dom[n]='node-type="'+n+(new Date).valueOf()+'"'})};this.createDOM(n);this.config={hasCache:true,hasRep:true,allow_Comment:true,CacheTimer:1e3*60*3,wrap:null,target_id:null,type:null,album_id:null,album_type:null,comment_uid:null,initdata:{total:30,maxShowNum:10,minx:20,current:1,loginUid:321,data:[{comment_id:1234,reply_cid:12345,screen_name:"test",profile_image_url:"http://tp4.sinaimg.cn/1656730135/50/5623659992/1",uid:123456,created_at:"23分钟前",comment_uid:1235,content:'你妹子，<a href="#">@test</a>'}]}};s.extend(this.config,e)};y.prototype={constructor:y,postDatas:function(e,t){var n=this;var r=n.config.hasCache;e.album_id=this.config.album_id;e.album_type=this.config.album_type;successHandle=function(e,i){if(e){g.alert("插入请求超时，请重试");n.lock=false;return}else if(!i.result){if(i.code==15001||i.code==15002){t({needCheckCode:true,code:i.code})}else{g.alert(i.msg)}n.lock=false;return}else{if(n.hasOwnProperty("total"))n.total++;if(r){var s=i.data;var o=s["target_id"]+"_"+s["comment_uid"];t(s);n.destroyCache(o)}else{t(i.data)}n.lock=false}};if(!n.lock){n.lock=true;a(m+"comments/insert",successHandle,e)}},delData:function(e,t){var n=this,r=n.config.hasCache,i=function(i,s){if(i){g.alert("删除请求超时，请重试");n.lock=false;return}else if(s.result.toString()=="false"){g.alert(s.msg);n.lock=false;return}else{if(r){var o=e["target_id"]+"_"+e["comment_uid"];n.destroyCache(o)}if(n.total)n.total--;t(e["comment_id"]);n.lock=false}};if(!n.lock){n.lock=true;a(m+"comments/delete",i,{comment_uid:e["comment_uid"],comment_id:e["comment_id"],type:n.config["type"],album_id:this.config.album_id,album_type:this.config.album_type})}},getDatas:function(e,t,n,r,i){function l(e,t){if(e){g.alert("获取评论数据超时，请刷新页面重试");return}else if(t.result.toString()=="false"){g.alert(t.msg);return}else{s.total=t.data.total;if(u){s.CacheData[f]=t.data;s.CacheData[f+"total"]=t.data.total;n(s.CacheData[f])}else{n(t.data)}}}var s=this,o=t,u=s.config.hasCache;var f=o["target_id"]+"_"+o["comment_uid"]+"_"+e;o["page"]=e;if(u&&s.CacheData[f]&&!s.forceClear&&!r){s.total=s.CacheData[f+"total"];n(s.CacheData[f])}else{a(m+(i||"comments/lists"),l,o,"get")}},createCounts:function(){var e=this;return'<p class="cmnt_count  M_txtb" >评论(<span '+e._dom["count_wrap"]+">{total}</span>)</p>"},createCommentTxt:function(){var e=this;return'<textarea class="M_txtarea" '+e._dom["comment_txt"]+' id="_'+(new Date).valueOf()+'" style="overflow:hidden;"></textarea>'},createCommentBar:function(){var e=this;var t='<label class="t"><input '+e._dom["comment_intransit"]+' type="checkbox" class="M_checkbox">同时分享到微博</label>';return'<div class="submit M_txtb">                  <div class="forward">                    <span '+e._dom["comment_face"]+' class="M_ico M_icon30"></span>'+t+'                    </div>                  <a class="M_btn_c" '+e._dom["comment_reply_btn"]+' href="#">评论</a>              </div>'},createCommentBox:function(e,t,n){var r=this;var i=r.config.allow_Comment?"":'style="padding-bottom:0px"';return'<div class="m_commentBox" '+i+">"+e+'<div class="cmnt_area" node-type="face_parent">'+t+n+"</div></div>"},createCommentList:function(e){var t=this;return'<div class="m_commentList" '+t._dom["comment_allreply_wrap"]+">"+e+"</div>"},createCommentListItem:function(e){var t=this;return'<dl class="reply_items clearfix" node-data-name="{screen_name}" node-data-user-id="{uid}" node-data-target="{target_id}" node-data-uid="{comment_uid}" node-data-id="{comment_id}">                    <dt class="m_thumb m_thumb_b">                      <a title="{screen_name}" href="{user_href}" action-type="get_card" action-data="{screen_name}"><img src="{profile_image_url}"></a>                    </dt>                    <dd class="reply_cont">                        <div class="contBox" node-type="reply_mini">                            <p class="M_txtb">                              <span class="reply_nm">                                <a href="{user_href}" action-type="get_card" action-data="{screen_name}">{screen_name}</a>{v}:                               </span>                              <span class="cont" '+t._dom["comment_content"]+">{content}</span>                            </p>                            "+e+"                        </div>                    </dd>             </dl>"},createCommentListItemBar:function(){var e=this;var t=e.config.allow_Comment?'<span class="reply_lk M_linkc"><a href="#" '+e._dom["comment_reply_txt"]+' node-data="{comment_uid}">回复</a></span>':"";return'<p class="time_reply M_txtb">                     <span class="time">{created_at}</span>{comment_bar}'+t+"              </p>"},createMiniComment:function(e,t){var n=this;return'<div class="cmnt_area" '+n._dom["comment_mini_reply_wrap"]+'>                <span class="arr_top">&diams</span>                <div class="reply" node-type="face_parent">                  '+e+t+"                </div>              </div>"},createMiniCommentTxt:function(){var e=this;return'<textarea class="M_txtarea" id="_'+(new Date).valueOf()+'" '+e._dom["comment_mini_txt"]+"></textarea>"},createMiniCommentBar:function(){var e=this;var t=e.config.hasRep?'<label class="t"><input '+e._dom["comment_mini_intransit"]+' type="checkbox" class="M_checkbox">同时分享到微博</label>':"";return'<div class="submit M_txtb">                   <div class="forward">                      <span '+e._dom["comment_face"]+' class="M_ico M_icon30"></span>'+t+'                    </div>                   <a href="#" '+e._dom["comment_mini_reply_btn"]+' class="M_btn_c">评论</a>              </div>'},showFace:function(e){var t=s(this).closest("div[node-type=face_parent]").find("textarea");p.ShowFace(this,t);return false},reportComment:function(e,t){if(t.length<12){var n=12-t.length;for(var r=0;r<n;r++){t="0"+t}}var i=e+t;f(i,"10","http://new.weibo.com/aj/comment/small")},returnFirstPage:function(e,t){var n=this,r=n.config;n.forceClear=true;n.getDatas(1,{target_id:r.target_id,comment_uid:r.comment_uid,type:r.type,album_id:r.album_id,album_type:r.album_type},function(e){n.updateComment(e);n.destroyCache(e["target_id"]+e["comment_uid"]);n.delMiniComment();n.PAG.gotoPage(1);n.forceClear=false},null,null,t)},initAction:function(){function n(){v.isLogin(function(){var n=s("input["+e._dom["comment_intransit"]+"]"),r=s("textarea["+e._dom["comment_txt"]+"]").val(),i=0;if(n.attr("checked")=="checked")i=1;if(s.trim(r)===""){g.alert("评论内容不能为空");return false}if(r.getByteLength()>260){g.alert("评论内容不能超过130个汉字或260个字符");return false}e.postDatas({content:r,comment_uid:t.comment_uid,target_id:t.target_id,type:t.type,retweet:i},function(t){if(e.PAG.pageIndex==1){e.insertNewItem(t)}else{e.returnFirstPage(t,true)}e.updateCount()})});return false}var e=this,t=e.config;s("span["+e._dom["comment_face"]+"]").live("click",e.showFace);s("textarea["+e._dom["comment_txt"]+"]").textAutoHeight(null,66);s("a["+e._dom["comment_reply_btn"]+"]").live("click",n);s("body").live("keypress",{host:e},function(t){var r='node-type="'+s(t.target).attr("node-type")+'"';if(t.ctrlKey&&(t.which==13||t.which==10)&&r==e._dom["comment_txt"]){n()}else if(t.ctrlKey&&(t.which==13||t.which==10)&&r==e._dom["comment_mini_txt"]){e.minitocomment(t)}});s("a["+e._dom["comment_del_btn"]+"]").live("click",function(){var t=s(this).closest("dl"),n=t.attr("node-data-target"),r=t.attr("node-data-id"),i=s(this).attr("node-data");g.confirm("确定要删除该回复吗？",{ok:function(){e.delData({comment_id:r,comment_uid:i,target_id:n,page:e.PAG.pageIndex},function(t){e.delItem(t);e.updateCount()})}});return false});s("a["+e._dom["comment_reply_txt"]+"]").live("click",function(t){var n=s(this).closest("div[node-type=reply_mini]"),r=s(this).closest("dl").attr("node-data-name");v.isLogin(function(){if(!e.hasMini){e.ShowMiniComment(n,r);e.hasMini=true;s("textarea["+e._dom["comment_mini_txt"]+"]").focusEnd();i.init(s("textarea["+e._dom["comment_mini_txt"]+"]").get(0))}else{var t="div["+e._dom["comment_mini_reply_wrap"]+"]",o=s(t);if(n.parent().find(t).length){e.delMiniComment()}else{o.insertAfter(n);s("textarea["+e._dom["comment_mini_txt"]+"]").focusEnd();s("textarea["+e._dom["comment_mini_txt"]+"]").val("@"+r+": ")}}});return false});s("a["+e._dom["comment_report_btn"]+"]").live("click",function(t){var n=s(this).attr("node-data"),r=s(this).attr("uid");e.reportComment(n,r);return false})},insertNewItem:function(e){var t=this,n=t.createItemTemp(e);e["user_href"]=m+e["uid"]+"/photos/";e["comment_bar"]=t.createUserBar(e);e["v"]=l(e["verified"]);n=c(n,e);s("div["+t._dom["comment_allreply_wrap"]+"]").prepend(n);s(t).trigger("insertAfter",[t.total])},delItem:function(e){var t=this;s("dl[node-data-id="+e+"]").remove();s(t).trigger("delAfter",[t.total])},minitocomment:function(e){var t=e.data.host,n=t.config;var r=s("textarea["+t._dom["comment_mini_txt"]+"]").val(),i=s(this).closest("dl"),o=i.attr("node-data-id"),u=i.attr("node-data-user-id"),a=s("input["+t._dom["comment_mini_intransit"]+"]");retweet=0;if(!!a.attr("checked"))retweet=1;if(s.trim(r)==t.miniContent){g.alert("评论内容不能为空");return false}if(r.getByteLength()>260){g.alert("评论内容不能超过130个汉字或260个字符");return false}t.postDatas({content:r,comment_uid:n.comment_uid,target_id:n.target_id,type:n.type,retweet:retweet,reply_cid:o,reply_uid:u},function(e){if(t.PAG.pageIndex==1){t.insertNewItem(e)}else{t.returnFirstPage(e)}t.updateCount();t.delMiniComment()});return false},initminiAction:function(){var e=this,t=e.config,n=18;s("a["+e._dom["comment_mini_reply_btn"]+"]").live("click",{host:e},e.minitocomment);s("textarea["+e._dom["comment_mini_txt"]+"]").textAutoHeight(null,n*5+4)},createUserBar:function(e){var t=this,n='<span class="del_lk M_linkc"><a href="#" '+t._dom["comment_report_btn"]+' node-data="{comment_id}" uid="{comment_uid}">举报</a><em class="M_vline"></em></span>',r='<span class="del_lk M_linkc"><a href="#" '+t._dom["comment_del_btn"]+' node-data="{comment_uid}">删除</a><em class="M_vline"></em></span>',i=$GLOBAL_INFO["account_uid"],s=e["comment_uid"],o=e["uid"],u="";if(i==s&&i!=o){u=r+n}else if(i==o){u=r}else{u=n}if(!t.config.allow_Comment){var a='<em class="M_vline"></em>',f=u.lastIndexOf(a);u=u.slice(0,f)+u.slice(f+a.length)}return c(u,e)},checkTextArea:function(e,t,n){var r=this;s(e).bind("propertychange input keyup",function(){if(s(this).val().getByteLength()>t)n(this,this.value)})},allowToggle:function(e){var t=this;if(t.config.hasRep){s("["+t._dom["comment_intransit"]+"]").parent().show()}else{s("["+t._dom["comment_intransit"]+"]").parent().hide()}if(e){s("textarea["+t._dom["comment_txt"]+"]").parent().show();s("a["+t._dom["comment_reply_txt"]+"]").show();s("a["+t._dom["comment_reply_txt"]+"]").closest("p").find("em:last").show()}else{s("textarea["+t._dom["comment_txt"]+"]").parent().hide();s("a["+t._dom["comment_reply_txt"]+"]").hide();s("a["+t._dom["comment_reply_txt"]+"]").closest("p").find("em:last").hide()}},createItemTemp:function(e){var t=this,n=t.createCommentListItemBar();return t.createCommentListItem(n)},updateComment:function(e){var t=this,n=t.config,r,i="",o=function(e,n){s.each(e,function(e,r){var s=t.createItemTemp(r);r["loginUid"]=n;r["user_href"]=m+r["uid"]+"/photos/";r["comment_bar"]=t.createUserBar(r);r["v"]=l(r["verified"]);i+=c(s,r)})};if(e){r=e;o(r.data,r["loginUid"]);s("["+t._dom["comment_allreply_wrap"]+"]").html(i);t.updateCount();t.allowToggle(!!e["is_allowed"])}else{r=t.config.initdata;o(r.data,r["loginUid"]);var u=t.createCommentList(i);s(t.config.wrap).append(u);t.PAG=new h({total:r.total,pageSize:r.minx,maxShowNum:r.pageSize,pageIndex:r.current,node:s('<div class="m_pages m_pages_comment M_linke" style="padding:20px 10px 0 0;"></div>'),callback:function(e){t.update(e.page)}});t.PAG.initUI2();s(t.config.wrap).append(t.PAG.ui);t.PAG.gotoPage(r.current)}},update:function(e,t,n){var r=this,i=r.config;r.getDatas(e,{target_id:i.target_id,comment_uid:i.comment_uid,type:i.type,album_id:i.album_id,album_type:i.album_type},function(t){r.updateCount();r.updateComment(t);r.PAG.updateUI(r.total,e);r.destroyCache(t["target_id"]+t["comment_uid"]);r.delMiniComment();if(n)n()},t)},destroy:function(){var e=this;s(e.config.wrap).remove()},destroyCache:function(e){var t=this,n=t.CacheData,r=1;while(t.CacheData[e+"_"+r]){delete t.CacheData[e+"_"+r];r++}},updateCount:function(){var e=this;s("span["+e._dom["count_wrap"]+"]").html(e.total);s("textarea["+e._dom["comment_txt"]+"]").val("")},createComent:function(e,t){var n=this,r,i=n.createCounts(),o=n.createCommentTxt(),u=n.createCommentBar();commentBox=n.createCommentBox(i,o,u,t);s(e).html(commentBox)},initComment:function(e){var t=this,n=t.config;if(n.wrap&&!t.hasInit){t.getDatas(1,{target_id:n.target_id,comment_uid:n.comment_uid,type:n.type,album_id:n.album_id,album_type:n.album_type},function(r){t.config.initdata=r;t.createComent(n.wrap,r);t.updateComment();t.initAction();t.allowToggle(!!r["is_allowed"]);if(e)e(r)});if(t.config.hasCache){setInterval(function(){t.CacheData={}},t.config.CacheTimer)}t.hasInit=true}else{throw new Error("comment config'wrap must be have or it is inited")}},getConf:function(){var e=this;return e.config},setConf:function(e){var t=this;s.extend(t.config,e)},delMiniComment:function(){var e=this;e.hasMini=false;s("a["+e._dom["comment_mini_reply_btn"]+"]").die();s("textarea["+e._dom["comment_mini_txt"]+"]").unbind();s("["+e._dom["comment_mini_reply_wrap"]+"]").remove()},ShowMiniComment:function(e,t){var n=this,r=n.createMiniCommentTxt(),i=n.createMiniCommentBar(),o=n.createMiniComment(r,i);s(e).after(o);s("textarea["+n._dom["comment_mini_txt"]+"]").val("回复@"+t+": ");n.miniContent="回复@"+t+":";n.initminiAction()}};e.exports=y},l:function(e,t,n,r){var i=n("B");var s=n("C");var o=n("k");var u=n("H");var a=n("e");n("i");var f=a.baseURL;var l={textArea:null,container:null,str_before:"",str_after:"",curPos:0,init:function(e,t){this.textArea=e;if(!t){if(i("div[node-type=suggest").get(0)){this.container=i("div[node-type=suggest]")}else{this.container=i('<div node-type="suggest" class="L_menu_list"></div>');i(document.body).append(this.container)}}this.autoComp()},autoComp:function(){var e=this;var t=new o({inputEle:e.textArea,itemTagName:"li",highlightClassName:"cur",container:e.container.get(0),normalClassName:"",position:true,width:180,createListFun:function(n,r){e.getData(n,function(n){var i=[],s,o=0,a=n.length,f=n;if(a>0){i.push('<span class="title">想用@提到谁</span>');i.push('<ul class="atList">');for(;o<a;o+=1){s=f[o].nickname||"";i.push('<li key="'+s+'"><a href="javascript:void(0)">'+s+"</a></li>")}i.push("</ul>")}var l=u.textareaPosition.getInputOffset(e.textArea,true);l.top+=20;t.setPosition(l);if(r&&typeof r=="function"){r.call(t,i.join(""))}})},beforeItemSelected:function(t){var n=i(t).attr("key");var r=e.str_before+"@"+n+" "+e.str_after;var s=(e.str_before+" @"+n+" ").length;var o=n.length+e.curPos;i(e.textArea).val(r).focus().setCurPos(o);this.hideContainer();return false}});e.reset=t.reset},getData:function(e,t){var n=this;var r=e;var o=e.lastIndexOf("@");if(o<0)return;this.curPos=i(this.textArea).getCurPos();var u=e.substring(0,this.curPos);var a=u.lastIndexOf("@");var l=u.substring(a+1,this.curPos);if(l.indexOf(" ")!=-1||l==""||a==-1||l.indexOf("\n")!=-1){return false}var c=l.getByteLength();this.str_before=r.substring(0,a);this.str_after=r.substring(this.curPos,r.length);if(c>20){return false}if(l){s({url:f+"sina/aj_searchat",dataType:"json",type:"get",data:{key:l,count:20},success:function(e){if(e&&e.result){if(t&&typeof t==="function")t.call(n,e.data.data)}}})}}};e.exports=l},L:function(e,t,n,r){var i=function(e,t,n){var r="http://service.account.weibo.com/reportspam?rid="+e+"&type="+t+"&from=10902&url="+encodeURIComponent(n);window.open(r,"newwindow","height=700, width=550, toolbar =no, menubar=no, scrollbars=no, resizable=no, location=no, status=no")};e.exports=i},m:function(e,t,n,r){var i=0;var s=1;var o=2;var u=3;var a=function(e){var t="";switch(e||i){case s:t='<a class="M_approve" action-islogin="islogin" title="新浪个人认证" href="http://verified.weibo.com/verify" target="_blank"></a>';break;case o:t='<a class="M_approve_co" action-islogin="islogin" title="新浪机构认证" href="http://verified.weibo.com/verify" target="_blank"></a>';break;case u:t='<a class="M_club" action-islogin="islogin" title="微博达人" href="http://club.weibo.com/intro" target="_blank"></a>';break;default:break}return t};e.exports=a},M:function(e,t,n,r){var i=function(e,t,n){return e.replace(n||/\\?\{([^{}]+)\}/g,function(e,n){if(e.charAt(0)==="\\"){return e.slice(1)}return t[n]===undefined?"":t[n]})};e.exports=i},n:function(e,t,n,r){var i=n("b");var s=n("B");var o=n("d");var u=n("e");var a=n("N");var f={};var l=166+97,c=37;f["DetailTool"]={resetTitle:function(e){setTimeout(function(){document.title=e},10)},setParentBox:function(e){var t=s(e),n=this.getBox(e);n.width=t.width();if(n.width<l||n.height<c){n.height=n.height+c;n.width=n.width<l?l:n.width}t.parent().css(n);return n},getBox:function(e){var t=s(e);return{height:t.height()}},isLogin:function(e){if(o.isLogin()){if(e)e()}else{a()}},emStyle:function(){var e=s(".desc>em").html();if(e===""){s(".desc>em").css("display","none")}else{s(".desc>em").css("display","inline")}},addTagItem:function(e,t,n){var r=this,i=s("span[node-type=tag_list]");if(!e&&t){s("#photo_tag").hide()}else{s("#photo_tag").show()}if(!e){if(n)i.html('<span class="no_tag" node-type="no-tag">暂无标签</span>');return}else{s("[node-type=no-tag]").remove()}var o=e.split(/\s/),a='<span class="M_ico M_icon29" action-type="tag_del"></span>',f="";s.each(o,function(e,i){if(t){a=""}var s=i;s=s.decodeHTML();if(!n)i=i.encodeHTML();r.tagIndex++;if(!!i)f+='<a href="'+u.baseURL+"tags/search?prel=p1_1&tag="+encodeURIComponent(s)+'" data-tagid="'+r.tagIndex+'" title="'+i+'" class="tag">'+i.cutString(13,"...")+a+"</a>"});if(n)i.html("");i.append(f)},tagIndex:0};e.exports=f},N:function(e,t,n,r){var i=n("B");var s=function(e){if(typeof window.WBtopGlobal_loginLayer!=="undefined"){WBtopGlobal_loginLayer({lang:"zh-cn",loginSuccessUrl:encodeURIComponent(e||window.location.href)});return}i.getScript("http://tjs.sjs.sinajs.cn/t5/register/js/page/remote/loginLayer.js",function(){s(e)})};e.exports=s},o:function(e,t,n,r){var i=n("B");var s=n("C");var o=n("b");var u=n("e");var a=n("O");var f=n("m");var l=n("d");var c=u.baseURL;var h=$GLOBAL_INFO.account_uid;var p={};p.init=function(){function S(e){s({type:"post",dataType:"json",url:c+"sina/get_namecard",data:{screen_name:t},success:function(n){if(n&&n.result){d[t]=n.data;if(e&&typeof e==="function"){e.apply(this,[n.data])}}}})}function x(t){var n=t.user_info,i=t.friendships_info.target,s=t.photos_list,o=t.photos_count,u="";var l={uid:n.id,screen_name:n.name,profile_image_url:n.profile_image_url,friends_count:n.friends_count,followers_count:n.followers_count,statuses_count:n.statuses_count,description:n.description||"暂无",location:n.location,tsex:n.gender=="m"?"男":"女",tsex_en:n.gender=="m"?"male":"female",twhose:h==n.id?"我":n.gender=="m"?"他":"她",tfollow:i.following?'<a class="M_btn_d_done" href="javascript:void(0)" onclick="return false">'+(i.followed_by?'<span class="M_ico M_icon32"></span>相互关注':"已关注")+'</a><a href="#" action-data="'+n.id+'" action-type="follow_destroy">取消</a>':'<a href="#" action-data="'+n.id+'" action-type="follow" class="M_btn_d">加关注</a>'};if(h==n.id)l.tfollow="";e=l.uid;var p=n.count;var d,v;if(o>0){for(var m in s){var g=s[m];if(g){v=a(g,"square");d=c+l.uid+"/photos/detail/photo_id/"+g.photo_id;u+='<li><a href="'+d+'" target="_blank"><img alt="" src="'+v+'"></a></li>'}}}else{u+='<li class="nophoto">暂无最新照片</li>'}var y='<div class="bg">                        <table cellspacing="0" cellpadding="0" border="0">                          <tbody>                            <tr>                              <td>                              <div class="content">                                  <div class="L_name_card">                                    <dl class="name clearfix">                                      <dt><a href="'+n.profile_url+'" title="'+l.screen_name+'" target="_blank"><img src="'+l.profile_image_url+'" title="'+l.screen_name+'" class="picborder_r"></a></dt>                                      <dd>                                        <p><a href="'+n.profile_url+'" title="'+l.screen_name+'" target="_blank">'+l.screen_name+"</a>"+f(n.verified)+'</p>                                        <p class="address M_txtb"><span title="'+l.tsex+'" class="'+(n.gender=="m"?"M_ico M_icon34":"M_ico M_icon35")+'"></span>'+l.location+'</p>                                        <div>                                          <ul class="userdata clearfix">                                            <li><a href="'+c+l.uid+"/albums"+'" target="_blank">专辑</a>'+p.albums+'<span class="M_vline M_txtb"></span></li>                                            <li><a href="'+c+l.uid+"/photos"+'" target="_blank">照片</a>'+p.photos+'<span class="M_vline M_txtb"></span></li>                                            <li><a href="'+c+l.uid+"/likes/photos"+'" target="_blank">赞过</a>'+p.likes+'</li>                                          </ul>                                        </div>                                      </dd>                                    </dl>                                    <dl class="info clearfix">                                      <dt class="M_txtb">简介：</dt>                                      <dd>'+l.description+'</dd>                                    </dl>                                    <div class="list clearfix">                                      <div class="my_pic"><span class="M_txtb t">'+l.twhose+'的最新照片</span><a href="'+c+e+"/photos/"+'" class="more" target="_blank">更多</a></div>                                        <ul class="uplist clearfix">'+u+'</ul>                                    </div>                                    <div class="links M_txtd" node-type="follow_status">'+l.tfollow+'</div>                                  </div>                                </div>                                </td>                            </tr>                          </tbody>                        </table>                        </div>                        <div node-type="arrow" class="arrow arrow_t"></div>';r.html(y)}function T(){var e=i(document).scrollTop();var t=i(document).scrollLeft();var n=10;var s=35;var o=i(window).height();var a=i(window).width();var f=u.offset();var l,c,h,p,d,v;if(u.get(0).getClientRects){var y=u.get(0).getClientRects();var b;for(var E=0,S=y.length;E<S;E++){b=y[E];if(w>=b.left&&w<=b.right){break}}l=b.top+e;c=b.left+t;h=b.bottom+e;p=b.right+t;d=p-c;v=h-l}else{l=f.top;c=f.left;h=l+u.height();p=c+u.width();d=u.width();v=u.height()}var x,T,N=false;var C="arrow arrow_t";g=r.width();m=r.height();if(l-e>e+o-h){x=l-m-n;C="arrow arrow_b"}else{N=true;x=h+n}if(t+a-p>g){T=p-d/2-s}else{C=N?"arrow arrow_rt":"arrow arrow_rb";T=p-d/2-g+s}r.find("div[node-type=arrow]").get(0).className=C;r.css({top:x,left:T})}function N(){if(u)T();r.slideDown("slow")}function C(){if(r)r.slideDown("slow").hide()}function k(){var e=i(document.body);e.delegate("[action-type=get_card]","mouseover",O);e.delegate("[action-type=get_card]","mouseout",L);r.delegate("[action-type=follow_destroy]","click",_);r.delegate("[action-type=follow]","click",M);r.mouseover(A);r.mouseout(L)}function L(e){u=null;if(b){window.clearTimeout(b);b=null}y=window.setTimeout(C,500)}function A(e){if(y){window.clearTimeout(y);y=null}}function O(e){u=i(this);w=e.clientX;E=e.clientY;A(e);b=window.setTimeout(function(){if(!u)return;t=u.attr("action-data");if(t){if(t&&t in d){x(d[t]);N()}else{S(function(e){x(e);N()})}}},1e3)}function M(t){if(!l.isLogin()){location.reload();return}var n=i(this).attr("action-data");t.preventDefault();s({dataType:"json",url:c+"users/follow",data:{uid:n},type:"post",success:function(t){if(t&&t.result){var i="已关注";D(n,true);if(n==e){if(t.data.isFollow&&t.data.isFollow==3){i='<span class="M_ico M_icon32"></span>相互关注'}r.find("div[node-type=follow_status]").html('<a class="M_btn_d_done" href="javascript:void(0)" onclick="return false">'+i+'</a><a action-type="follow_destroy" action-data="'+n+'" href="#">取消</a>')}}}})}function _(t){if(!l.isLogin()){location.reload();return}t.preventDefault();var n=i(this).attr("action-data");s({dataType:"json",url:c+"users/follow_destroy",data:{uid:n},type:"post",success:function(t){if(t&&t.result){if(n==e){r.find("div[node-type=follow_status]").html('<a href="#" action-data="'+n+'" action-type="follow" class="M_btn_d">加关注</a>')}D(n,false)}}})}function D(e,t){var n;for(var r in d){n=d[r];if(n.user_info.id==e){n.friendships_info.target.following=t}}}var e;var t;var n;var r;var o;var u;var p;var d={};var v=null;var m=216;var g=362;var y=null;var b=null;var w;var E;return function(){r=i('<div class="L_layer"></div>');r.hide();i(document.body).append(r);k()}}();p.init();e.exports=p},O:function(e,t,n,r){var i=function(e,t){if(!e)return undefined;var n=e["pic_host"],r=e["pic_type"],i=e["uid"],s=e["pic_name"];if(e["pic_type"]==2&&e["pri_"+t+"_pic"]){return e["pri_"+t+"_pic"]}if(n&&s){if(r==1){return n+"/"+t+"/"+s}else if(r==0&&e["avatar_large"]){return e["avatar_large"]}}else{return e[t+"_pic"]}};e.exports=i},p:function(e,t,n,r){var i=n("B");n("i");(function(e){var t=function(e){var t=e.trim();if(typeof t=="undefined"){return 0}var n=t.match(/[^\x00-\x80]/g);return t.length+(!n?0:n.length)};e.fn.textAuto=function(n,r,i,s,o){var u=e(this);var a=n.find(".letrCount");i=i||"";s=s||"M_alert";var f=function(e){var n=e;var u=n.val()||"";var f=Math.ceil(t(u)/2);if(f>r){n.val(u=u.cutString(r*2,"",true));f=Math.ceil(t(u)/2)}if(f>r){a.html('超出<span class="'+s+'">'+(f-r)+"</span>个字</p>")}else{a.html('还可以输入<span class="'+i+'">'+(r-f)+"</span>个字")}if(o&&typeof o==="function"){o.apply(this,arguments)}};f(u);var l=null;u.unbind();u.bind({focus:function(t){l=window.setInterval(function(){f(e(t.target))},100)},blur:function(e){if(l)window.clearInterval(l)}})};e.fn.textAuto2=function(n,r){var i=e(this);var s=function(e){var i=e;var s=i.val()||"";var o=Math.ceil(t(s)/2);if(o>n/2){i.val(s=s.cutString(n,"",true));o=Math.ceil(t(s)/2)}if(r&&typeof r==="function"){r.call(this,o)}};s(i);var o=null;i.unbind();i.bind({focus:function(t){o=window.setInterval(function(){s(e(t.target))},100)},blur:function(e){if(o)window.clearInterval(o)}})};e.fn.textAuto3=function(n,r){var i=e(this);var s=function(i){var s=e(i.target);var o=s.val()||"";var u=t(o);if(u>n){if(r&&r.test(o)){return}s.val(o.cutString(n,"",true))}};var o=null;i.unbind();i.bind({focus:function(e){o=window.setInterval(function(){s(e)},50)},blur:function(e){if(o)window.clearInterval(o)}})};e.fn.textAutoHeight=function(t,n){t=t||function(){};var r=n||200;var i=e(this);var s=i.height();var o=function(){if(t){t()}var n=e.getTextAreaHeight(i,s);if(n>r){n=r;i.css("overflow-y","auto")}else{i.css("overflow-y","hidden")}i.css("height",n)};i.bind("keyup focus blur",o)};e.getTextAreaHeight=function(t,n){var r;var i=n;if(e.browser.msie){var s=t.attr("id");r=Math.max(document.getElementById(s).scrollHeight,i)}else{var o=e("#_____textarea_____");if(!o.length&&o.attr("id")==undefined){o=document.createElement("textarea");o.id="_____textarea_____";e("body").append(o)}if(e("#_____textarea_____").currentTarget!=t){e("#_____textarea_____").css({top:"-1000px",height:"0px",position:"absolute",overflow:"hidden",width:t.css("width"),"font-size":t.css("font-size"),"font-family":t.css("font-family"),"line-height":t.css("line-height"),padding:t.css("padding")})}e("#_____textarea_____").val(t.val());var u=document.getElementById("_____textarea_____").scrollHeight;r=Math.max(u,i);document.getElementById("_____textarea_____").currentTarget=t}return r}})(i);(function(){function r(e,t){var n=["font-family","font-size","font-weight","font-style","letter-spacing","line-height","width","height","padding-top","padding-right","padding-bottom","padding-left","margin-top","margin-right","margin-bottom","margin-left"];for(var r=0,i=n.length;r<i;r++){e.css(n[r],t.css(n[r]))}}function i(e){var n=$(this),r=n.val().replace(/ /g,"&nbsp;").replace(/((&nbsp;)*)&nbsp;/g,"$1 ").replace(/\n/g,"<br />");height=t.html(r).height();if(height>e.data.maxHeight){n.css({"overflow-y":"auto",height:e.data.maxHeight})}else{n.height(height).css("overflow-y","hidden")}}var e=$.browser.msie,t;var n=$.fn.autoHeight=function(e){e=$.extend({},n.defaults,e);$.each(this,function(){var n=$(this);if(!t){t=$("<div/>");r(t,n);t.css({position:"absolute","word-wrap":"break-word",top:"-3000px",left:"-3000px",height:"auto","min-height":n.height()}).appendTo(document.body)}n.on("keyup focus blur",e,i)})};n.defaults={maxHeight:200}})(i)},P:function(e,t,n,r){var i=n("B");var s=n("E");var o=n("e");var u=n("O");var a=n("C");var f=n("G");var l=n("D");var c=n("q");var h=n("b");var p=n("r");var d=new l;var v=i.browser.msie&&i.browser.version=="6.0";var m=function(e){this.config={data:[],total:null,albumdata:null,current:null,pageSize:36,dataurl:null,inpage:1};this.speed=4e3;this.stoptime=8e3;this.stoptimer=null;this.lay=null;this.mask=new s(100,"#000",1e4);this.showlistnum=8;this.timer=null;this.current=0;this.closeCallback=function(){};this.isStop=false;this.loaded=false;this.isend=false;this.isstart=false;i.extend(this.config,e);this.config.data=this.initDB(this.config.data)};m.prototype={constructor:m,initDB:function(e){var t=this,n=t.config,r=[];r.length=n.total;var i=[(n.inpage-1)*n.pageSize,e.length].concat(e);r.splice.apply(r,i);return r},calculateSize:function(){var e=this,t=e.config,n=t.total,r=t.current,i=t.pageSize,s=t.inpage-1,o=e.showlistnum,u=e.photos,a=e.findPhoto(r,t.data)["current"];return{lastcount:n%i,datapage:Math.ceil(n/i),dataindex:a,index:s*i+a}},checkload:function(){var e=this,t=e.config,n=e.calculateSize();if(!t.dataurl)return;var r=n["dataindex"];var s=Math.ceil(e.showlistnum/2)+2;var o=r+s;var u=r-s;if(!t.data[o]&&o<=t.data.length){e.loaded=true;e.loadright(function(n){var r=n.data["photo_list"];i.each(r,function(e,n){t.data[t.inpage*t.pageSize+e]=n});t.inpage++;i("[node-type=slide_list]>li:last").after(e.createList(e.initDB(r)));e.loaded=false})}else if(!t.data[u]&&u>0){e.loaded=true;e.loadleft(function(n){var r=n.data["photo_list"];i.each(r,function(e,n){t.data[(t.inpage-2)*t.pageSize+e]=n});t.inpage--;i("[node-type=slide_list]>li:first").before(e.createList(e.initDB(r)));e.loaded=false})}if(r==t.total-1&&!t.data[0]){e.loadDB({page:1,count:e.config.pageSize},function(n){var r=n.data["photo_list"];i.each(r,function(e,n){t.data[e]=n});i("[node-type=slide_list]").prepend(e.createList(r));e.loaded=false})}},successhandle:function(e,t){var n=this;if(e.result){t(e)}else{alert(e.msg||"照片获取失败")}},errorhandle:function(){var e=this;alert("数据获取超时");e.loaded=false},loadDB:function(e,t){var n=this;a({url:n.config.dataurl,type:"get",dataType:"json",data:e,success:function(e){n.successhandle(e,t)},error:function(){n.errorhandle()}})},loadright:function(e){var t=this;var n=t.config.inpage+1;var r={page:n,count:t.config.pageSize};t.loadDB(r,e)},loadleft:function(e){var t=this;var n=t.config.inpage-1;var r={page:n,count:t.config.pageSize};t.loadDB(r,e)},createTop:function(e,t){var n=this,r='<div class="topMenu" node-type="bar_top">            <div class="alpha"></div>                <div class="content">                    <div class="user">'+e+'</div>                    <div class="share">'+t+'</div>                    <div class="M_pages_a" node-type="top_pag"></div>                </div>            </div>';return r},createUserBox:function(){var e=this,t=' <div class="m_thumb m_thumb_c"><a title="'+$GLOBAL_INFO["owner_data"]["name"]+'" href="'+o.baseURL+$GLOBAL_INFO["owner_uid"]+"/photos"+'"><img src="'+$GLOBAL_INFO["owner_data"]["profile_image_url"]+'"></a> </div>                    <span class="name"><a href="'+o.baseURL+$GLOBAL_INFO["owner_uid"]+"/photos"+'">'+$GLOBAL_INFO["owner_data"]["name"]+"</a></span>";return t},createTopBar:function(){var e=this,t='<a class="M_linke M_transmit_sm" title="分享" action-type="lay_transmit" href="#">                    <span class="M_ico M_icon4_ly"></span>                </a>			    <a class="M_linke M_comment_sm" title="评论" action-type="lay_comment" target="_blank" href="#">                    <span class="M_ico M_icon5_ly"></span>                </a>                <a class="M_linke M_like_sm" href="#" title="赞" action-type="lay_like">                    <span class="M_ico M_icon6_ly"></span>                </a>';return t},createTopPag:function(e){var t=this;t.pag=new f({total:t.config.total,pageSize:1,node:i('<div style="text-align:center;">')});t.pag.initUI=function(){var e=[],t=this.pageIndex;if(this.pageCount>1){e.push('<span class="count"><em>'+t+"</em>/<em>"+this.total+"</em></span>")}this.ui.html(e.join(""))};t.pag.initUI();return t.pag.ui},createPic:function(){var e=this,t='<div class="pic"><img node-type="slide_pic"></div>';return t},createConsole:function(e,t){var n=this,r='<div class="console" node-type="bar_down">                        <div class="alpha"></div>                        <div class="content clearfix">'+t+'                             <div class="picLists">';r+='<ul node-type="slide_list">'+e+"</ul>";r+="</div></div></div>";return r},createList:function(e){var t=this,n=t.config,r="";for(var i=0;i<e.length;i++){var s=e[i];if(s){s["square_pic"]=u(s,"square");r+='<li current="'+i+'" style="position:absolute;top:12px;left:'+78*i+'px;" data-id="'+s["photo_id"]+'" class="'+(s["photo_id"]==t.config.current?"current":"")+'"><img width="60" height="60" src="'+s["square_pic"]+'"></li>'}}return r},createConsoleBar:function(){var e=this,t='<div class="play_prev"><span class="pause" action-type="control_slide"></span><span class="prev" action-type="prev_slide"></span></div>                    <div class="defl_next"><span class="next" action-type="next_slide"></span></span></div>';return t},createClose:function(){return'<div class="closearea" action-type="close_slide"><span class="M_ico M_icon41" title="关闭"></span></div>'},rebuildPic:function(){var e=this;e.imgLoaded=true;i("#J_Slide_Loading").remove();var t=i(window).height()*.8,n=i(window).width()*.8,r=i("img[node-type=slide_pic]").outerHeight(),s=i("img[node-type=slide_pic]").outerWidth(),o=Math.max(n,s),u=Math.max(t,r);if(o>n||u>t){var a={};if(s>n&&s>r&&r<t){a["width"]=s*(n/s)}else{a["height"]=r*(t/r)}i("img[node-type=slide_pic]").css(a)}i("img[node-type=slide_pic]").fadeIn(1e3);e.removeTip();e.windowRest()},cacheDB:{},changePhoto:function(e,t){var n=this,r=n.config,s=n.findPhoto(e,n.config.data);if(e){if(s){n.imgLoaded=false;var a=i("[node-type=slide_list] li");i("img[node-type=slide_pic]").unbind("load").bind("load",function(){n.rebuildPic();n.cacheDB[this.src]=true;if(v){if(t){n.barshow();n.barhide()}n.barshow()}if(!n.isStop)n.play()});s["data"]["original_pic"]=u(s["data"],"mw690");i("img[node-type=slide_pic]").attr({src:s["data"]["original_pic"]}).css({width:"",height:""}).hide();if(n.cacheDB[s["data"]["original_pic"]]){setTimeout(function(){n.rebuildPic()},50)}if(!n.imgLoaded){i("#J_Slide_Loading").remove();i("img[node-type=slide_pic]").after('<div id="J_Slide_Loading" class="M_loading" style="width:25px;height:25px;margin:'+(i(window).height()-25)/2+'px auto 0px auto;"></div>')}else{i("img[node-type=slide_pic]").fadeIn(1e3)}n.current=s.current;if(n.current===0){n.isstart=true}else{n.isstart=false}if(n.current==r.total-1){n.isend=true}else{n.isend=false}r.current=e;n.photoid=e;n.fixPhotoList(t);a.removeClass("current");a.filter("[current="+n.current+"]").addClass("current");if(s["data"]["type"]==15){i("a[action-type=lay_comment]").attr("href",o.baseURL+s["data"]["uid"]+"/talbum/detail/photo_id/"+s["data"]["photo_id"])}else{i("a[action-type=lay_comment]").attr("href",o.baseURL+s["data"]["uid"]+"/photos/detail/photo_id/"+s["data"]["photo_id"])}i("a[action-type=lay_like]>span").attr("class",s["data"]["is_liked"]?"M_ico M_icon6_on":"M_ico M_icon6");var f=n.config.data[n.current];if(f["visible_type"]==1||f["visible_type"]==6||f["visible_type"]==3||f["visible_type"]==4||n.config.albumdata&&n.config.albumdata.property!=1||f["property"]&&f["property"]!=1){i("a[action-type=lay_transmit]").hide()}else{i("a[action-type=lay_transmit]").show()}n.checkend()}else{throw new Error("photo id is wrong")}}},play:function(){var e=this;e.timer=setTimeout(function(){e.isStop=false;e.moveright();e.pag.gotoPage(e.current+1)},e.speed);i("span[action-type=control_slide]").attr("class","pause")},stop:function(){var e=this;if(e.timer)clearTimeout(e.timer);i("span[action-type=control_slide]").attr("class","play");e.isStop=true},moveto:function(e){var t=this,n=i("[node-type=slide_list]").find("li[current="+e+"]").attr("data-id");t.config.current=n;t.checkload();t.removeTip();t.changePhoto(n)},moveleft:function(){var e=this;if(e.current<1){e.stop();e.isstart=true;return}if(e.current<=0){return}if(e.loaded)return;e.current--;e.moveto(e.current);e.isstart=false},checkend:function(){var e=this;if(e.isstart){i("[action-type=prev_slide]").attr("class","prev_f")}else{i("[action-type=prev_slide]").attr("class","prev")}if(e.isend){i("[action-type=next_slide]").attr("class","next_f")}else{i("[action-type=next_slide]").attr("class","next")}},lastTip:function(e){var t=this;var n="",r="",s,u='<div class="rbd" action-type="slide_replay" style="margin-top:150px;"><span class="replay"></span><em>再次播放</em></div>'+r;if(!e){s=o.baseURL+$GLOBAL_INFO["owner_uid"]+"/albums/detail/album_id/"+t.config.albumdata["album_id"];if(t.config.albumdata["type"]==3){s=o.baseURL+$GLOBAL_INFO["owner_uid"]+"/talbum/index"}n='<div class="user M_txte">                                  <div class="m_thumb m_thumb_b"> <a title="'+$GLOBAL_INFO["owner_data"]["name"]+'" target="_blank" href="'+o.baseURL+$GLOBAL_INFO["owner_uid"]+'/photos"><img src="'+$GLOBAL_INFO["owner_data"]["profile_avatar_url"]+'"></a></div>                                  <div class="info">                                      <p class="user_album">来自 <a href="'+o.baseURL+$GLOBAL_INFO["owner_uid"]+"/photos"+'" target="_blank">'+$GLOBAL_INFO["owner_data"]["name"].cutString(20,"...")+'</a> 的专辑</p>                                      <p class="desc"><a href="'+s+'" target="_blank">'+t.config.albumdata["caption"]+"</a></p>                                  </div>                              </div>";r='<div class="b M_linkf"><a class="M_linkb" href="#" action-type="album_transmit"><span class="M_ico M_icon8"></span>分享</a></div>';if(t.config.albumdata["type"]==32||t.config.albumdata["type"]==42)r="";u='<div class="rbd" action-type="slide_replay"><span class="replay"></span><em>再次播放</em></div>'+r}var a='<div class="L_alpha L_alpha_b">                        <div style="height:400px;" class="alpha"></div>                            <div style="height:400px;" class="content">'+n+u+"                            </div>                    </div>";if(!t.tips){t.tips=i('<div node-type="slide_tips">'+a+"</div>");t.lay.prepend(t.tips);t.resetTips()}if(t.config.albumdata&&t.config.albumdata.property!=1){i("a[action-type=album_transmit]").hide()}else{i("a[action-type=album_transmit]").show()}},moveright:function(){var e=this;if(e.current>e.config.total-2){e.stop();if(e.config.albumdata)e.lastTip();else e.lastTip(true);e.isend=true;return}if(e.current>=e.config.total-1){return}if(e.loaded)return;e.current++;e.isend=false;e.moveto(e.current)},initAction:function(){var e=this;i(".L_slide .pic").live("mousemove",function(t){e.imageOnmousemove(this,t)});i(".L_slide .pic").live("click",function(t){e.imageOnclick(this,t)});i("span[action-type=prev_slide]").live("click",function(){e.stop();e.moveleft();e.pag.gotoPage(e.current+1);return false});i("span[action-type=next_slide]").live("click",function(){e.stop();e.moveright();e.pag.gotoPage(e.current+1);return false});i("[node-type=slide_list] li").live("click",function(){e.current=parseInt(i(this).attr("current"),10);e.stop();e.moveto(e.current);e.pag.gotoPage(e.current+1);return false});i("[action-type=close_slide]").live("click",function(){e.close();return false});i("div.L_slide *").live("click mousemove",function(){e.barshow();e.stoptimer=setTimeout(function(){e.barhide()},e.stoptime)});e.stoptimer=setTimeout(function(){e.barhide()},e.stoptime);i("span[action-type=control_slide]").live("click",function(){var t=i(this).attr("class");if(e.isend){e.replay()}else if(t=="pause"){e.stop()}else{e.play()}});i("[action-type=slide_replay]").live("click",function(){e.replay();return false});i("[action-type=slide_like]").live("click",function(t){function h(){a(o.baseURL+u,function(o,u){if(u&&u.result){l=r?"取消赞图成功！":"赞图成功！";s=r?"M_ico M_icon6_ly":"M_ico M_icon6_on";if(c&&!e.config.albumdata["is_liked"]&&e.config.albumdata["property"]==1&&!e.config.albumdata["is_private"]){(new p).likeTip.call(null,t.target,null,{target_id:e.config.albumdata["album_id"],like_uid:e.config.albumdata["uid"],type:e.config.albumdata["type"],is_feed:u.data.result.is_feed,is_private:e.config.albumdata["is_private"],property:e.config.albumdata["property"]})}else if(!e.config.albumdata["is_liked"]){(new p).like_feed.call(null,{target_id:e.config.albumdata["album_id"],is_feed:u.data.result.is_feed,like_uid:e.config.albumdata["uid"],type:e.config.albumdata["type"],is_private:e.config.albumdata["is_private"],property:e.config.albumdata["property"]})}e.config.albumdata["is_liked"]=r?false:true;f="success";n.find("span").attr("class",s);i(e).trigger("fire:album_like",[e.config.albumdata["album_id"],e.config.albumdata["is_liked"],u.data.like_total])}if(!c||r||e.config.albumdata.property!=1){d.miniTip(u.msg||l,{status:f,autoClose:1500})}},{target_id:e.config.albumdata["album_id"],like_uid:e.config.albumdata["uid"],property:e.config.albumdata["property"],is_private:e.config.albumdata["is_private"],type:e.config.albumdata["type"]!=3?1:3})}var n=i(this),r=e.config.albumdata["is_liked"],s="M_ico M_icon6"+r?"_on":"",u=r?"likes/dislike":"likes/like",f="error",l="赞图失败";var c=$GLOBAL_INFO["account_settings"]["like_tip"];h()});i("a[action-type=lay_like]").live("click",function(t){function h(){a(o.baseURL+s,function(s,o){if(o&&o.result){f=l["is_liked"]?"取消赞图成功！":"赞图成功！";r=l["is_liked"]?"M_ico M_icon6":"M_ico M_icon6_on";l["is_liked"]=l["is_liked"]?false:true;u="success";n.find("span").attr("class",r);var a=l["property"]==1?true:e.config.albumdata?e.config.albumdata["property"]==1:false;if(c&&l["is_liked"]&&a&&l["visible_type"]!=1&&l["visible_type"]!=4&&l["visible_type"]!=3){(new p).likeTip.call(null,t,null,{target_id:l["photo_id"],like_uid:l["uid"],type:l["type"],is_feed:o.data.result.is_feed,is_private:l["visible_type"]==1||l["visible_type"]==4||l["visible_type"]==3?true:false,property:l["property"]})}else if(l["is_liked"]){d.miniTip(o.msg||f,{status:u,autoClose:1500});(new p).like_feed.call(null,{target_id:l["photo_id"],is_feed:o.data.result.is_feed,like_uid:l["uid"],type:l["type"],is_private:l["visible_type"]==1||l["visible_type"]==4||l["visible_type"]==3?true:false,property:l["property"]})}i(e).trigger("fire:photo_like",[l["photo_id"],l["is_liked"],o.data.like_total])}if(!c||!l["is_liked"]||l["property"]!=1&&(l["visible_type"]==1||l["visible_type"]==4||l["visible_type"]==3)){d.miniTip(o.msg||f,{status:u,autoClose:1500})}},{target_id:l["photo_id"],like_uid:l["uid"],type:l["type"],is_private:l["visible_type"]==1||l["visible_type"]==4||l["visible_type"]==3?true:false,property:l["property"]})}e.stop();var n=i(this),r="M_ico M_icon6_ly",s="likes/like",u="error",f="赞图失败",l=e.config.data[e.current];if(l["is_liked"]){s="likes/dislike"}var c=$GLOBAL_INFO["account_settings"]["like_tip"];h();return false});i("a[action-type=lay_transmit]").live("click",function(){var t=e.config.data[e.current];t["thumb150_pic"]=u(t,"thumb150");e.stop();var n={who:$GLOBAL_INFO["owner_data"]["name"],uid:$GLOBAL_INFO["owner_uid"],photoId:t["photo_id"],img:t["thumb150_pic"],url:t["thumb150_pic"],target_id:t["photo_id"],target_uid:t["uid"],mask:false,type:t["type"]==15?15:2,parent:".L_slide",afterEvent:function(n){i(e).trigger("fire:photo_transmit",[t["photo_id"],n.comment_count,n.retweet_count])}};if(e.config.albumdata){n["caption"]=e.config.albumdata["caption"];c.forwardDialog(n,true)}else{a(o.baseURL+"photos/get_photo_album_info?photo_id="+t["photo_id"]+"&uid="+t["uid"]+"&type="+t["type"],function(e,t){n["caption"]=t.data["caption"];c.forwardDialog(n,true)},null,"get")}return false});i("[action-type=album_transmit]").live("click",function(){var t=e.config.albumdata,n=t["cover_pic"]!==""?t["cover_pic"]:o.baseIMG+"common/status_0.png";e.stop();var r={caption:t["caption"],who:$GLOBAL_INFO["owner_data"]["name"],uid:$GLOBAL_INFO["owner_uid"],albumId:t["album_id"],img:n,url:n,mask:false,target_id:t["album_id"],target_uid:t["uid"],type:t["type"]==3?3:1,parent:".L_slide",afterEvent:function(n){i(e).trigger("fire:album_transmit",[t["album_id"],n.comment_count,n.retweet_count])}};c.forwardDialog(r);return false});i(window).keypress(function(t){if(t.keyCode==27){e.close()}})},barshow:function(){var e=this;if(e.stoptimer)clearTimeout(e.stoptimer);i("[node-type=bar_top]").fadeIn();i("[node-type=bar_down]").fadeIn();i("[action-type=close_slide]").fadeIn()},barhide:function(){if(d.hasPop)return;i("[node-type=bar_top]").fadeOut("slow");i("[node-type=bar_down]").fadeOut("slow");i("[action-type=close_slide]").fadeOut("slow")},removeTip:function(){var e=this;if(e.tips){e.tips.remove();e.tips=null}i("img[node-type=slide_pic]").parent().show()},replay:function(){var e=this;e.isStop=false;e.changePhoto(e.config.data[0]["photo_id"]);e.pag.gotoPage(1)},windowRest:function(e){var t=!!e?e.data.host:this;t.reset();t.resetPic();t.resetTips()},moveList:function(e,t){var n=this,r=i("[node-type=slide_list]");r.parent().css({position:"relative",height:90});r.css("position","absolute");if(t){r.css({top:0,left:-e*n.liwidth})}else{r.animate({top:0,left:-e*n.liwidth},200)}},fixPhotoList:function(e){var t=this,n=t.config.total,r=t.current,s=Math.ceil(t.showlistnum/2),o=i("[node-type=slide_list]");if(!t.initWidth){var u=o.find("li").eq(0);t.liwidth=u.outerWidth()+12;o.width(t.liwidth*n);o.height(90);t.initWidth=true;o.css({position:"absolute",top:0,left:r*t.liwidth*o.find("li").size(),width:t.liwidth*o.find("li").size()})}if(r<=s||n<=t.showlistnum){t.moveList(0,e)}else if(r>s&&r<n-s){t.moveList(r-s,e)}else if(r>=n-s){t.moveList(n-t.showlistnum-1,e)}},findPhoto:function(e,t){var n=false;for(var r=0;r<t.length;r++){if(t[r]&&t[r]["photo_id"]==e){n={data:t[r],current:r};break}}return n},getcursoper:function(e,t){var n=(parseInt(t.clientX,10)-i(e).offset().left)/i(e).width();return n<.5?"left":"right"},imageOnmousemove:function(e,t){var n=this;if(n.current<1&&n.getcursoper(e,t)=="left"){i(e).removeClass("M_cur_ph_prev").removeClass("M_cur_ph_next");return false}if(n.current>n.config.total-2&&n.getcursoper(e,t)=="right"){i(e).removeClass("M_cur_ph_prev").removeClass("M_cur_ph_next");return false}if(n.getcursoper(e,t)=="left"){i(e).removeClass("M_cur_ph_next").addClass("M_cur_ph_prev")}else{i(e).removeClass("M_cur_ph_prev").addClass("M_cur_ph_next")}return false},imageOnclick:function(e,t){var n=this;var r={left:function(){n.stop();n.moveleft();n.pag.gotoPage(n.current+1)},right:function(){n.stop();n.moveright();n.pag.gotoPage(n.current+1)}};r[n.getcursoper(e,t)]();return false},createSlide:function(e){var t=this,n=t.config,r=t.findPhoto(n.current,e);if(!r)throw new Error("photo current id nonentity");var i=t.createPic(),s=t.createUserBox(),o=t.createTopBar(),u=t.createTop(s,o),a=t.createConsoleBar(),f=t.createList(n.data),l=t.createConsole(f,a,n.total),c=t.createClose();t.current=r.current;return'<div class="L_slide" style="display:none;">'+i+u+l+c+"</div>"},reset:function(){var e=this;e.lay.css({width:i(window).width(),height:i(window).height(),position:v?"absolute":"fixed",top:v?i(document).scrollTop()+"px":0,left:v?i(document).scrollLeft()+"px":0,"z-index":10001})},resetTips:function(){var e=this,t=i("div[node-type=slide_tips]"),n=400,r=400,s=i(window).height(),o=i(window).width();t.css({top:parseInt((s-n)/2,10),left:parseInt((o-r)/2,10),width:r+"px",height:n+"px",position:"absolute"})},resetPic:function(){var e=this,t=i("img[node-type=slide_pic]"),n=t.height(),r=i(window).height();t.css({"margin-top":parseInt((r-n)/2,10)})},init:function(){var e=this,t=e.config;e.lay=i(e.createSlide(t.data));i("body").append(e.lay);var n=e.createTopPag(t.data);i("[node-type=top_pag]").append(n);e.showPic();e.open(t.current);e.initAction()},update:function(e,t,n,r,s){var o=this,u=o.config;u.inpage=n;u.total=r;u.albumdata=s;u.data=o.initDB(t);u.current=e;o.lay.remove();o.lay=null;o.lay=i(o.createSlide(u.data));i("body").append(o.lay);var a=o.createTopPag(u.data);i("[node-type=top_pag]").append(a);o.open(e);o.showPic()},destory:function(){},showPic:function(){var e=this;e.mask.show();e.windowRest()},close:function(){var e=this;e.lay.hide();e.mask.hide();i(window).unbind("resize scroll",e.windowRest);i("html,body").css("overflow","");e.stop();d.mask.hide();if(d.hasPop)d.close();e.closeCallback(e.photoid,e.config.inpage);e.isStop=false},open:function(e){var t=this;t.lay.show();t.showPic();i(window).bind("resize scroll",{host:t},t.windowRest);i("body,html").css("overflow","hidden");t.changePhoto(e,true);t.pag.gotoPage(t.current+1);t.checkload()}};e.exports=m},q:function(e,t,n,r){function d(e,t){if(!f.isLogin()){location.reload();return}s({url:a.baseURL+"sina/get_comment_setting",dataType:"json",type:"get",data:{target_id:e},success:function(e){if(t&&typeof t==="function"){t.call(this,e)}}})}function v(e,t){if(!f.isLogin()){location.reload();return}s({url:a.baseURL+"sina/retweet",dataType:"json",type:"post",data:e,success:function(e){if(t&&typeof t==="function"){t.call(this,e)}}})}var i=n("B");var s=n("C");var o=n("D");var u=n("M");var a=n("e");var f=n("d");var l=n("g");var c=n("l");var h=n("Q");n("p");n("i");var p=new o;i.extend(p,{forwardDialog:function(e,t){var n=this,r,s={title:"分享到我的微博",albumInfo:"@{who} 的专辑 {caption} 很棒，推荐给大家！",photoInfo:"@{who} 的照片很棒(来自专辑 {caption})，推荐给大家！",who:$GLOBAL_INFO.owner_data.name,img:"",caption:"",photoID:"",albumID:"",album_type:"",uid:"",type:t?2:1,close:function(){l.hide()}};if(e)i.extend(s,e);r=t?s.photoInfo:s.albumInfo;r=u(r,s);var o='<label class="t M_txtb"><input type="checkbox" class="M_checkbox">同时评论给</label><a href="http://weibo.com/u/'+s.uid+'">@'+s.who+"</a>";var a=s.html&&s.html(r,o,s.img)||'<div class="L_forward">                            <div class="m_forward">                              <p class="M_txte letrCount">还可以输入<span class="M_txtb">104</span>个字</p>                              <div class="txtarea">                              <textarea class="M_txtarea" node-type="textEl">'+r+'</textarea>                              <div node-type="suggestContainer"></div>							</div>                              <div class="face_cmn clearfix">                                <div class="face">                                  <span class="M_ico M_icon30" action-type="show_face"></span>'+o+'</div>                                <div class="send_cmn"><a href="javascript:void(0);" action-type="submit" class="M_btn_e" action-data="disabled=0"><span>分享</span></a></div>                              </div>                            </div>                            <dl class="forwardAlbum">                                <dt class="phto"><img width="150" height="150" src="'+s.img+'"></dt>                            </dl>                        </div>';d(s.uid,function(e){!e.data&&(a=a.replace(o,""));n.basicDialog(a,s);var t=n.popLay.find("textarea");t.textAuto(n.popLay,130);(function(){var e=null,r=n.popLay.find("[action-type=submit]");var i=function(e){var n=t.val().replace(/^[\s\u3000]+/,"").replace(/[\s\u3000]+$/,"");if(!n){e.addClass("M_btn_disb").attr("action-data","disabled=1")}else{e.removeClass("M_btn_disb").attr("action-data","disabled=0")}};t.focus(function(){e=setInterval(function(){i(r)},200)});t.blur(function(){if(e){clearInterval(e)}i(r)})})();s.close=function(){c.reset()};n.popLay.delegate("[action-type=show_face]","click",function(e){l.ShowFace(this,t)});n.popLay.delegate('[action-type=submit][action-data="disabled=0"]',"click",function(e){function u(e){n.close();if(e&&e.result){if(s.afterEvent&&typeof s.afterEvent=="function"){s.afterEvent.call(this,e.data)}n.miniTip(h[10002])}else{if(e.code==20032){n.alert(e.msg||h[10010])}else if(e.code==15001){n.showCheckCode("info",function(e){o["checkcode"]=e;v(o,u)})}else if(e.code==15002){n.showCheckCode("error",function(e){o["checkcode"]=e;v(o,u)})}else{n.miniTip(e.msg||h[10010],{status:"error"})}}}var r=t.val().trim();if(!r){n.miniTip(h[10016]);return}var i=n.popLay.find(":checkbox");var o={url:s.img,content:t.val(),type:s.type,album_id:s.albumID,album_type:s.album_type,is_comment:i.length?i.get(0).checked:false,target_id:s.target_id,target_uid:s.target_uid};if(s.is_cover_type){o.is_cover_type=true}if(s.from){o.from=s.from}v(o,u)});c.init(t.get(0))});return false}});e.exports=p},Q:function(e,t,n,r){e.exports={10001:"保存成功",10002:"分享成功",10003:"封面设置成功",10004:"头像设置成功",10005:"复制链接成功",10006:"关注成功",10007:"确定",10008:"取消",10009:"创建",10010:"操作失败，请重试",10011:"请选择一个你的好友",10012:"数据已经被删除或无权访问",10013:"复制连接地址成功",10014:"头像设置成功",10015:"头像设置失败",10016:"分享内容不能为空",10017:"操作成功",10018:"取消成功",11001:"创建成功",11002:"确定删除该专辑吗？",11003:"删除专辑成功",11004:"新建专辑",11005:"编辑专辑",11006:"删除专辑失败",11007:"该专辑已满",11008:"封面设置成功",11009:"封面设置失败",12001:"确定删除该照片吗？",12002:"删除照片成功",12003:"移动照片成功",12004:"排序已更改，是否保存？",12005:"删除照片失败",12006:"移动照片成功",12007:"移动照片失败",12008:"排序保存成功",12009:"排序保存失败",12010:"确定将照片移动到此专辑？",12011:"照片还未完全载入",12012:"高宽小于100px的图片不能进行圈人操作",12013:"此照片为私密微博图片",12014:"旋转保存失败",12015:"照片不存在或无权查看",12016:"请先关闭圈人再旋转照片",12017:"此操作将同时删除该条微博以及它包含的所有图片，确定删除？",12018:"此照片为密友可见图片",12019:"确定要移除该照片吗？",12020:"移除照片成功",12021:"移除照片失败",13001:"赞图成功",13002:"取消赞成功",13003:"确定取消赞吗？",13004:"取消赞失败",13005:"赞失败",13006:"获取喜欢列表失败",14001:"收藏成功",14002:"取消收藏成功",14003:"确定取消收藏吗？",14004:"取消收藏",14005:"收藏专辑",14006:"收藏照片",14007:"收藏失败",14008:"取消收藏失败",15001:"评论成功",15002:"删除评论成功",15003:"休息一下，相同内容的微博发一条就够啦",16001:"圈人成功",16002:"删除圈人成功",16003:"圈人失败",17001:"存在重复的标签",17002:"请输入标签",18001:"您选择的文件格式有错误",18002:"上传失败",18003:"请选择图片",18004:"未上传图片",18005:"上传照片不可大于20M"}},r:function(e,t,n,r){var i=n("B");var s=n("b");var o=n("C");var u=n("e");var a=n("d");var f=n("R");var l=n("Q");var c=n("D");var h=n("s");var p=u.baseURL;var d=$GLOBAL_INFO.account_settings.like_tip;var v=new c;var m;var g=function(e,t){var n=this;this.model=h;this.parent=e;this._lock=false;this.minilink=undefined;this.is_feed=0;this.likeStyle=this.like=function(e,t){if(!a.isLogin()){location.reload();return false}var r=m=f(i(this).attr("action-data"));var s=h.DetailDB.get("AlbumDB");r["album_id"]=s["album_id"];r["album_type"]=s["type"];!r.property&&(r.property=1);var o=this;n.setLike(o,r,0,undefined,function(i,s,o,u){n.is_feed=u;var a=r["is_private"]=="true"?true:false;if(r["property"]==1&&!a){if(d){if(t)t(i,s,o);n.likeTip(e)}else{m.is_feed=u;n.like_feed(m,function(){if(t)t(i,s,o)})}}else{if(t)t(i,s,o)}});return false};this.unlike=function(e,t){if(!a.isLogin()){location.reload();return false}var r=f(i(this).attr("action-data"));var s=h.DetailDB.get("AlbumDB");r["album_id"]=s["album_id"];r["album_type"]=s["type"];var o=this;n.setLike(o,r,1,undefined,t);return false};this.setLike=function(e,r,s,u,f){if(!a.isLogin()){location.reload();return}if(this._lock)return;this._lock=true;var c=l["13005"],m="error",g="likes/like";if(s){c=l["13004"];g="likes/dislike"}if(u!=undefined)r.is_sync=u?1:0;var y={target_id:r.target_id,like_uid:r.like_uid,type:r.type};var b=h.DetailDB.get("AlbumDB");y["album_id"]=b["album_id"];y["album_type"]=b["type"];var w={status:m,autoClose:1500};if(r.from&&r.from==="profile_wb"){y.from=r.from;w.isFollow=true;w.target=e}var E=/\?event=lotteryday/.test(window.location.href);if(!s&&E){g+="?event=lotteryday"}r.ref&&(y.ref=r.ref);var S=$GLOBAL_INFO.tmpObj||{},x=S.tagInfo||{},T=x.tag_id||0;T&&(y.tag_id=T);var N=this;o({type:"post",dataType:"json",url:p+g,data:y,success:function(o){if(o){if(o.result){var u=o.data,a=u.like_total;c=s?l["13002"]:l["13001"];m="success";w.status=m;if(N.minilink&&!s){w["link"]={href:p+$GLOBAL_INFO.account_uid+"/likes/photos?prel=p6_6",text:"我赞过的"};w.autoClose=false;w.mask=true}setTimeout(function(){if(n.biglike){n.setLikeView.successTip(e,a,!s)}else if(t){n.setLikeView.hoverLike(e,a,!s)}else if(n.popularityLike){n.setLikeView.successTip2(e,a,!s)}else if(n.recommandLike){n.setLikeView.successTip3(e,a,!s)}else if(n.minilink){if(!s){i("#icon_like").addClass("M_icon6_on").attr("title","取消赞")}else{i("#icon_like").removeClass("M_icon6_on").attr("title","赞")}}else{n.setLikeView.success(e,a,!s)}},0);(!d||s||r.property!=1||r.is_private)&&v.miniTip(o.msg||c,w);if(f&&i.isFunction(f)){if(u.result){f(e,a,!s,u.result.is_feed)}else{f(e,a,!s)}}i(n).trigger("change",[r.target_id,!s])}else{if(f&&i.isFunction(f)){f(e)}v.miniTip(o.msg||c,w)}}n._lock=false}})};this.setLikeView={hoverLike:function(e,t,n){var r=t||0;var s=i(e);var o=n?"unlike":"like";s.attr("action-type",o);if(n){s.html('<i class="icon_praised"></i><span>('+r+")</span>")}else{s.html('<i class="icon_praise"></i><span>('+r+")</span>")}var u=s.closest("div.m_pin_box").find('a[data-addCount="1"]');u.attr("action-type",o);u.html('<span class="M_ico '+(n?"M_icon6_on":"M_icon6")+'"></span>'+r)},success:function(e,t,n){var r=t||0;var s=n?"unlike":"like";i(e).attr("action-type",s);i(e).html('<span class="M_ico '+(n?"M_icon6_on":"M_icon6")+'"></span>'+r);var o=i(e).closest("div.m_pin_box").find('a[data-addCount="0"]');if(o.length){o.attr("action-type",s);if(n){o.html('<i class="icon_praised"></i><span>('+r+")</span>")}else{o.html('<i class="icon_praise"></i><span>('+r+")</span>")}}},successTip:function(e,t,n){var r=i(e).find("span.bg>span"),s=i(e).find("em");if(n){r.attr("class","M_ico M_icon7_on")}else{r.attr("class","M_ico M_icon7")}s.text(t)},successTip2:function(e,t,n){var r=i(e).find("span"),s=i(e).find("em");if(n){r.attr("class","M_ico M_icon7_on");i(e).attr("action-type","unlike")}else{r.attr("class","M_ico M_icon7_ly");i(e).attr("action-type","like")}s.text(t)},successTip3:function(e,t,n){var r=i(e).find("em");if(n){r.attr("class","M_ico M_icon46_on")}else{r.attr("class","M_ico M_icon46")}}};this.retweet=function(e,t){o({url:p+"likes/like_retweet",type:"post",dataType:"json",data:e,success:function(e){if(e&&e.result&&e.code===20017){v.miniTip(e.msg||"",{status:"error",autoClose:1500})}if(t&&i.isFunction(t)){t()}}})};this.like_feed=function(e,t){o({url:p+"likes/like_feed",type:"post",dataType:"json",data:e,success:function(e){if(e&&e.result&&e.code===20017){v.miniTip(e.msg||"",{status:"error",autoClose:1500})}if(t&&i.isFunction(t)){t()}}})};this.likeTip=function(e,t,r){function o(e){if(!i(e.target).closest(".L_synchr_wb").length)v.close();i("body").die("click",o)}if(r)m=r;var s='<div class="L_synchr_wb">                            <a class="close" action-type="cancel" href="#">×</a>                            <p class="prompt">是否将我赞过的同步到微博？</p>                            <div class="confirm">                                <a class="M_btn_e" action-type="ok" href="#"><span>是</span></a><a class="M_btn_e" action-type="cancel" href="#"><span>否</span></a>                            </div>                            <label class="rembr M_txta"><input action-type="remember-me" type="checkbox" class="M_checkbox">记住我的选择，不再提示</label>                            <p node-type="like-tip" style="display:none" class="M_txtb tips">您的选择可在相册“设置”中重置</p>                        </div>';v.customTip(s,{ok:function(e){i("body").die("click",o);n.setLikeTip(e,true,t,n.is_feed)},cancel:function(e){i("body").die("click",o);n.setLikeTip(e,false,t,n.is_feed)},close:function(e){i("body").die("click",o)},mask:false,title:false,target:e.currentTarget||e,zIndex:3e4,isFollow:true});v.popLay.delegate("[action-type=remember-me]","click",function(e){var t=v.popLay.find("p[node-type=like-tip]");var n=this;window.setTimeout(function(){if(n.checked){t.show()}else{t.hide()}},10)});i("body").die("click",o).live("click",o)};this.setLikeTip=function(e,t,r){if(!a.isLogin()){location.reload();return}e.preventDefault();var s=v.popLay;var u=s.find(":checkbox").get(0).checked;var f={is_upload:t?1:0,like_tip:u?0:1};if(u){o({url:p+"settings/set_like",type:"post",dataType:"json",data:f,success:function(t){if(t&&t.result){if(r&&typeof r=="function"){r.call(this,e,null,true)}d=$GLOBAL_INFO.account_settings.like_tip=!u}}})}else{if(r&&typeof r=="function"){r.call(this,e,null,true)}}var l={};l.is_sync=t?1:0;l.is_feed=n.is_feed;i.extend(l,m);this.like_feed(l,function(){if(r&&i.isFunction(r)){r(e,null,true)}})};this.init=function(){this.parent.delegate("[action-type=like]","click",this.like);this.parent.delegate("[action-type=unlike]","click",this.unlike)}};e.exports=g},R:function(e,t,n,r){var i=function(e,t){var n=e;var r=n.split("&");var i={};for(var s=0;s<r.length;s++){var o=r[s].split("=");var u=o[0],a=o[1];i[u]=a;if(u==t){return i[u]}}return i};e.exports=i},s:function(e,t,n,r){var i=n("b");var s=n("B");var o=n("e");var u=n("C");var a=n("S");var f=n("t");var l=n("Q");var c=n("D");i.Backbone=Backbone;var h=o.baseURL;var p=new c;var d=f.me;var v=i.Backbone.Model.extend({urlRoot:o.baseURL,initCachePhoto:function(e){this.unset("DBlist");this.set("DBlist",e)},initLikeCachePhoto:function(e){var t={};this.set("likeDB",t);this.unset("DBlikelist");this.set("DBlikelist",e)},setLike:function(e,t){var n=this.get("likeDB");t["photo_id"]=t["target_id"];n[e]=t},getLike:function(e){var t=this.get("likeDB");return t[e]},unsetLike:function(e){var t=this.get("likeDB");if(t&&t[e])t[e]=undefined},findIndex:function(e,t){for(var n=0;n<t.length;n++){if(t[n]==e){return n}}return-1},findCacheIndex:function(e){var t=this.get("DBlist");if(!t)return-1;return this.findIndex(e,t)},findLikeCacheIndex:function(e){var t=this.get("DBlikelist");if(!t)return-1;return this.findIndex(e,t)},getAllAlbums:function(e,t){var n=this;a.get(o.baseURL+"albums/get_all?&uid="+e+"&count=100&page=1",function(e,r){n.successhandle(e,r,t)})},setLikes:function(e){if(e){for(var t=0;t<e.length;t++){this.setLike(e[t]["target_id"],e[t])}}},addLikeCaches:function(e,t,n){var r=this,i=this.get("DBlikelist");this.setLikes(n);var s=this.LikeLeftborder(e-5,10);var o=this.LikeRightborder(e+5,10);if(s)this.getLikePrev(i[e-5],t,function(e,t){r.setLikes(t.data.photos_list)});if(o)this.getLikeNext(i[e+5],t,function(e,t){r.setLikes(t.data.photos_list)})},LikeLeftborder:function(e,t){var n=this.get("DBlikelist");for(var r=0;r<t;r++){if(!n[e-r])continue;if(!this.getLike(n[e-r]))return true}return false},LikeRightborder:function(e,t){var n=this.get("DBlikelist");for(var r=0;r<t;r++){if(!n[e+r])continue;if(!this.getLike(n[e+r]))return true}return false},addCaches:function(e,t,n){var r=this,i=[];for(var s=0;s<e.length;s++){var o=r.get(e[s]);if(!o)i.push(e[s])}if(i.length){var u=i.join(",");r.getMutiple(u,t,n,function(e){r.setids(u,e)})}},setids:function(e,t){var n=e.split(",");for(var r=0;r<n.length;r++){var i=t[n[r]];if(i){this.set(n[r],i)}}},orderToArray:function(e,t){var n=[];e.forEach(function(e,r){if(!t[e]){t[e]={};t[e]["photo_id"]=e;t[e]["addflag"]=true}n[r]=t[e]});return n},isRoundHasCache:function(e,t){var n=this.get("DBlikelist"),r=this.findLikeCacheIndex(e),i=[],s={},o;if(r>=0){var u=Math.ceil(t/2),a=Math.ceil(u/2);if(r>a&&r<n.length-a){for(o=0;o<u;o++){if(r-o>0&&r+o<n.length){if(!this.getLike(n[r])||!this.getLike(n[r-o])||!this.getLike(n[r+o]))return false;else{s[this.getLike(n[r])["target_id"]]=this.getLike(n[r]);s[this.getLike(n[r-o])["target_id"]]=this.getLike(n[r-o]);s[this.getLike(n[r+o])["target_id"]]=this.getLike(n[r+o])}}else{if(!this.getLike(n[o-1])||!this.getLike(n[r-o-1]))return false;if(r+o<n.length){s[this.getLike(n[o-1])["target_id"]]=this.getLike(n[o-1])}else{s[this.getLike(n[r-o-1])["target_id"]]=this.getLike(n[r])}}}}else if(r<=a){for(o=0;o<=u;o++){if(n[o]&&!this.getLike(n[o]))return false;else if(n[o]){s[this.getLike(n[o])["target_id"]]=this.getLike(n[o])}}}else if(r>=n.length-a){for(o=n.length-u;o<n.length;o++){if(n[o]&&!this.getLike(n[o]))return false;else if(n[o]){s[this.getLike(n[o])["target_id"]]=this.getLike(n[o])}}}n.forEach(function(e){if(s[e])i.push(s[e])});if(i.length<u)return false;return i}return[]},getByLikeId:function(e,t,n,r){var i=this.isRoundHasCache(e,n);if(!i)this.getLikeMutiple(e,t,n,r);else{r(null,{result:true,data:{photos_list:i}})}},getByIds:function(e,t,n,r){var i=this,o=e.concat(),u={},a=[];for(var f=0;f<e.length;f++){var l=i.get(e[f]);if(l)u[e[f]]=l;else a.push(e[f])}if(!a.length){u=i.orderToArray(o,u);r(u)}else{var c=a.join(",");this.getMutiple(c,t,n,function(e){s.extend(u,e);i.setids(c,e);u=i.orderToArray(o,u);r(u)})}},getMutiple:function(e,t,n,r){a.get(this.urlRoot+"photos/get_multiple",function(e,t){if(t.result)r(t.data)},{uid:t,ids:e,type:n},"get")},getLikePrev:function(e,t,n){u(this.urlRoot+"likes/get_photos?more_info=1&format=1&photo_id="+e+"&count=20&uid="+t,n,null,"get")},getLikeNext:function(e,t,n){u(this.urlRoot+"likes/get_photos?more_info=1&format=3&photo_id="+e+"&count=20&uid="+t,n,null,"get")},getLikeMutiple:function(e,t,n,r){u(this.urlRoot+"likes/get_photos?more_info=1&format=2&photo_id="+e+"&count="+n+"&uid="+t,r,null,"get")},getLikeDetail:function(e,t,n){u(this.urlRoot+"likes/get_photos?more_info=1&format=2&photo_id="+e+"&count=1&uid="+t,n,null,"get")},successhandle:function(e,t,n,r){var s=this.get("$info");if(e){p.alert(l[10010])}else{if(t.result){i.isSelf=t.data.hasOwnProperty("uid")?t.data["uid"]==s["account_uid"]?true:false:d;i.isSelf=t.data.hasOwnProperty("like_uid")?t.data["like_uid"]==s["account_uid"]?true:false:d;var u=t.data.hasOwnProperty("flag");if(u&&t.data.flag!=1||t.data["visible_type"]==1&&!i.isSelf||t.data.visible_type==4&&t.data.flag>1||t.data.visible_type==3&&t.data.flag>1){var a="";if(t.data.visible_type==1){a=l[12013]}else if(t.data.visible_type==4){a=l[12018]}else if(t.data.visible_type==3){a="此照片为分组照片"}else if(t.data.flag=="0"){a="照片已经被删除"}else if(t.data.flag>1){a="照片无权查看"}window.location.href=o.baseURL+s["owner_uid"]+"/error/index/code/12999/message/"+encodeURIComponent(a);return}n(t.data)}else if(r){p.alert(t.msg)}else{window.location.href=o.baseURL+s["owner_uid"]+"/error/index/code/"+t["code"]+"/message/"+t.msg||"未知错误"}}},successhandleLike:function(e,t,n,r){var s=this.get("$info");if(e){p.alert(l[10010])}else{if(t.result){var u=t.data.photos_list[0];if(u){i.isSelf=u.hasOwnProperty("uid")?u["uid"]==s["account_uid"]?true:false:i.isSelf;i.isSelf=u.hasOwnProperty("like_uid")?u["like_uid"]==s["account_uid"]?true:false:i.isSelf;var a=u.hasOwnProperty("flag");if(a&&u.flag!=1||u.visible_type==1&&!i.isSelf||u.visible_type==4&&u.flag>1||u.visible_type==3&&u.flag>1){var f="";if(u.visible_type==1){f=l[12013]}else if(u.visible_type==4){f=l[12018]}else if(u.visible_type==3){f="此照片为分组照片"}else if(u.flag=="0"){f="照片已经被删除"}else if(u.flag>1){f="照片无权查看"}window.location.href=o.baseURL+s["owner_uid"]+"/error/index/code/12999/message/"+encodeURIComponent(f);return}n(t.data)}else{window.location.href=o.baseURL+s["owner_uid"]+"/error/index/code/12999/message/照片不存在或无权查看"}}else if(r){p.alert(t.msg)}else{window.location.href=o.baseURL+s["owner_uid"]+"/error/index/code/"+t.code+"/message/"+t.msg||"未知错误"}}},getAlbumDetail:function(e,t,n,r,i){a.get(this.urlRoot+"albums/get_line?uid="+e+"&album_id="+t+"&type="+n+"&user_info="+r,function(e,t){if(i)i(e,t)},null,"get")},getAlbumIds:function(e,t,n,r){a.get(this.urlRoot+"photos/get_photo_ids?&uid="+e+"&type="+n+"&album_id="+t,function(e,t){if(r)r(e,t)},null,"get")},updateCover:function(e,t,n,r){u(this.urlRoot+"albums/update_cover",r,{photo_id:e,album_id:t,type:n})},updateAvatar:function(e,t,n){u(this.urlRoot+"photos/update_avatar",n,{photo_id:e,type:t})},addRelatedPersons:function(e,t,n,r,i,s,o,a,f,l,c,h){u(this.urlRoot+"photos/add_related_persons",h,{photo_id:e,owner_uid:t,adder_uid:n,type:r,flag:i,height:s,width:o,top:a,left:f,related_uid:l,zindex:c})},photoTrash:function(e,t,n,r){u(this.urlRoot+"photos/trash",r,{photo_id:e,type:t,album_type:n})},updateAlbum:function(e,t,n,r,i){u(this.urlRoot+"photos/update_album",i,{photo_id:e,album_id:t,type:n,do_delete:r})},favorite:function(e,t,n,r,i,s){u(this.urlRoot+"favorites/favorite",s,{target_id:e,fav_uid:t,type:n,album_id:r,album_type:i})},disfavorite:function(e,t,n,r,i){u(this.urlRoot+"favorites/disfavorite",i,{target_id:e,type:t,album_id:n,album_type:r})},isBilateral:function(e,t){u(this.urlRoot+"users/is_bilateral?uid="+e,t,null,"get")},getLikers:function(e,t,n,r,i,s){var o=this;u(this.urlRoot+"likes/get_likers?target_id="+e+"&uid="+t+"&type="+n+"&count="+r+"&page="+i,function(e,t){o.successhandle(e,data,s)},null,"get")},getPhotoDetail:function(e,t,n,r,i,s){var o={photo_id:e,uid:t,type:n,album_id:r,album_type:i};if(i==45){o.prel="p1_face"}u(this.urlRoot+"photos/get_detail",s,o,"get")},getLikersPhotos:function(e,t,n,r){var i=this;u(this.urlRoot+"likes/get_photos?photo_id="+e+"&count="+t+"&uid="+n,function(e,t){i.successhandle(e,t,r)},null,"get")},getAllPhotos:function(e,t,n,r,i,s){var o=this;u(this.urlRoot+"photos/get_all?uid="+t+"&album_id="+e+"&type="+n+"&count="+r+"&page="+i,function(e,t){o.successhandle(e,t,s)},null,"get")},addTags:function(e,t,n,r,i,s){u(this.urlRoot+"photos/add_tags",s,{photo_id:e,tags:t,type:n,album_id:r,album_type:i})},deleteRelatedPerson:function(e,t,n,r,i){var s=this;u(this.urlRoot+"photos/delete_related_person?uid="+t+"&id="+e+"&type="+n+"&album_id"+r,function(e,t){s.successhandle(e,t,i,true)})},deleteTags:function(e,t,n,r,i,s){u(this.urlRoot+"photos/delete_tags",s,{photo_id:e,tags:t,type:n,album_id:r,album_type:i})},rotate:function(e,t,n){u(this.urlRoot+"photos/rotate",n,{photo_id:e,angle:t})},clickDB:{},addClick:function(e,t,n,r,i){var s=this.clickDB[e]?1:0;this.clickDB[e]=true;u(this.urlRoot+"photos/set_click?cache="+s+"&type="+n+"&uid="+t+"&photo_id="+e+(r?"&album_type="+r+(r==45?"&prel=p1_face":""):""),function(e,t){if(i)i(e,t)},{cache:s,type:n,uid:t,photo_id:e})},getrecommendAlbum:function(e,t){var n=this;a.get(this.urlRoot+"welcome/get_other_recommend_photo?count="+e,function(e,r){n.successhandle(e,r,t)})},getTagSuggest:function(e,t){a.get(this.urlRoot+"tags/suggest_tags",t,{count:e},"get")},getRecommendTagAndPhotos:function(e,t){var n=this;var r="";r=e?"?tag_id="+e:r;a.get(this.urlRoot+"welcome/get_recommend_tags_photos"+r,function(e,n){if(t&&typeof t==="function")t.call(this,n)})},getPhotosByTagId:function(e,t){var n=this;a.get(this.urlRoot+"tags/get_recommend_tags_photos?tag_id="+e,function(e,n){if(t&&typeof t==="function")t.call(this,n)})},getUserByUid:function(e,t){var n=this;u(this.urlRoot+"users/get_user?uid="+e,function(e,n){if(t&&typeof t==="function")t.call(this,n)})}});e.exports={DetailDB:new v({$info:$GLOBAL_INFO,$detail:$GLOBAL_DETAIL})}},S:function(e,t,n,r){var i=n("B");var s=n("C");var o={};o.CacheDB={};o.get=function(e,t,n,r){var u=n?i.param(n):"";if(o.CacheDB[e+u]){if(t&&typeof t=="function")t(false,o.CacheDB[e+u])}else{s(e,function(n,r){o.CacheDB[e+u]=r;t(n,r)},n,r)}};o.destroy=function(e,t){if(e){var n=t?i.param(t):"";o.CacheDB[e+n]=undefined}else{o.CacheDB={}}};e.exports=o},t:function(e,t,n,r){var i=function(){if($GLOBAL_INFO){var e=$GLOBAL_INFO;return e["account_uid"]===e["owner_uid"]}return false}();e.exports={me:i}},T:function(e,t,n,r){function f(e,t){var n=e;var r=n.split("&");var i={};for(var s=0;s<r.length;s++){var o=r[s].split("=");var u=o[0],a=o[1];i[u]=a;if(u==t){return i.s1}}return i}var i=n("B");var s=n("e");var o=n("C");n("i");var u=s.baseURL;var a=function(e,t,n,r,s){var a=this;var f=null;this.helper=null;this.editLayer=e;this.photoList=t||e;this.maxTags=n||10;this.maxByteLength=r||20;this.maxShowLength=s||13;this.getCommonTags=function(e,t){var n=this;if(this.commonTags){if(t&&typeof t=="function"){t.call(this,this.commonTags)}return}o({url:u+"tags/suggest_tags",type:"get",dataType:"json",data:{count:e},success:function(e){if(e&&e.result){n.commonTags=e.data;if(t&&typeof t=="function"){t.call(n,n.commonTags)}}}})};this.createCommonTags=function(e,t){var n,r=[];for(var i=0,s=e.length;i<s;i++){n=e[i];r.push('<a title="'+n+'" href="#" action-type="'+(t?"batch_add":"single_add")+'">'+n+"</a>")}return r.join("")};this.onBatchInputKeyup=function(e){var t=this.value,n=this.name;if(/(;|,|；|，|\s+|　+)$/.test(t)){t=t.substring(0,t.length-1);a.addTagsAll(t,n);this.value=""}e.preventDefault()};this.addTagsAll=function(e,t,n){var r,s;var o=a.editLayer.find("input[type=hidden][name="+t+"]");a.createTag(e,t,o,true);if(!a.hiddenInputs)a.hiddenInputs=a.photoList.find("input[type=hidden]");for(var u=0,f=a.hiddenInputs.length;u<f;u++){s=a.hiddenInputs[u];r=s.name;(function(t,n){window.setTimeout(function(){a.editLayer.find("input[type=text][name="+t+"]").val("");a.createTag(e,t,i(n),true)},1)})(r,s)}};this.onBatchInputFocus=function(e){this.value="";i(this).removeClass("M_txte")};this.onBatchInputBlur=function(e){var t=this.value,n=this.name,r=a.editLayer.find("input[type=hidden][name="+n+"]");if(i.trim(t)==""){if(r.val()==""){i(this).addClass("M_txte");this.value=this.title}else{this.value=""}return}a.addTagsAll(t,n);this.value=""};this.onKeyup=function(e){var t=this.value;var n=this.name;if(/(;|,|；|，|\s+|　+)$/.test(t)){t=t.substring(0,t.length-1);var r=a.editLayer.find("input[type=hidden][name="+n+"]");a.createTag(t,n,r,true);this.value="";this.focus()}e.preventDefault()};this.onFocus=function(e){this.value="";i(this).removeClass("M_txte");e.preventDefault()};this.hideHelpLayer=function(e){f=window.setTimeout(function(){if(a.helpLayer)a.helpLayer.hide()},150)};this.showHelpLayer=function(e){function r(){window.clearTimeout(f);window.setTimeout(function(){if(f){window.clearTimeout(f);f=null}},20);if(a.helpLayer)a.helpLayer.show()}var t=a.photoList.find("li[photoid="+e+"]");var n=t.find("div.tagarea");if(!n||!n.length){if(!a.helpLayer){a.helpLayer=i('<div class="tagarea"></div>');a.helpLayer.delegate("span[action-type=close_help]","click",a.hideHelpLayer);i(document.body).click(function(e){var t=e.target;if(a.helpLayer.get(0)==t||i.contains(a.helpLayer.get(0),t)){if(i(t).attr("action-type")!="close_help"){r()}}else{if(i(t).attr("node-type")!="single_tag_input"&&i(t).attr("action-type")!="remove_tag"){a.hideHelpLayer(e)}}})}t.find("[node-type=common_tag]").prepend(a.helpLayer);a.getCommonTags(10,function(e){a.helpLayer.html('<p class="t"><span class="M_ico M_icon29" action-type="close_help" title="关闭"></span>热门标签：</p>'+'<div class="m_tag_a">'+a.createCommonTags(e,false)+"</div>")})}r()};this.onBlur=function(e,t){var n=e.target;var r=n.value;var s=n.name;var o=a.editLayer.find("input[type=hidden][name="+s+"]");a.createTag(r,s,o,true);if(!o.val()||t){n.value=n.title;i(n).addClass("M_txte")}else{n.value=""}};this.createTag=function(e,t,n,r){if(e.trim()!==""){e=e.decodeHTML();var s=e.split(/\s+|,|;|；|，|　+/),o,u,f,l,c;for(var h=0,p=s.length;h<p;h++){o=s[h].trim();u=o.cutString(a.maxByteLength);c=o.cutString(a.maxByteLength,"",true);f=a.createTagHtml(o,t);if(u=="")continue;if(a.checkAndWriteData(n,c)){var d=a.editLayer.find("div[node-type=photo_tags_"+t+"]");(function(e){window.setTimeout(function(){d.append(e)},100)})(i(f))}}}};this.createTagHtml=function(e,t,n){var r=e.cutString(a.maxByteLength);var i=r.cutString(a.maxShowLength,"...");var s='<span class="M_ico M_icon29" pid="'+t+'" tag="'+r+'" action-type="remove_tag" title="删除"></span>';if(n)s="";return'<a href="javascript:void(0)" title="'+r+'" data="'+r+'">'+i+s+"</a>"};this.checkAndWriteData=function(e,t){var n=e.val();var r=n==""?[]:n.split(/[,|\s]/);var i=r.length;if(i>=a.maxTags)return false;for(var s=0;s<i;s++){if(r[s]==t)return false}r.push(t);e.val(r.join(" "));return true};this.removeData=function(e,t,n){var r=e.val();var s=e.attr("name");var o=a.editLayer.find("input[type=text][name="+s+"]");var u=r.split(" ");for(var f=0,l=u.length;f<l;f++){if(u[f]==t){u.splice(f,1);break}}e.val(i.trim(u.join(" ")));if(!o.val()&&n=="batch"){o.blur()}};this.removeTag=function(e){var t=i(this).attr("tag");var n=i(this).attr("pid");var r=a.editLayer.find("input[type=hidden][name="+n+"]");a.removeData(r,t);i(this).parent("a").remove();if(n=="batch"){if(!a.hiddenInputs)a.hiddenInputs=a.photoList.find("input[type=hidden]");for(var s=0,o=a.hiddenInputs.length;s<o;s++){a.removeData(i(a.hiddenInputs[s]),t,n)}a.photoList.find('a[data="'+t+'"]').remove()}e.preventDefault()}};e.exports=a},u:function(e,t,n,r){var i=n("b");var s=n("e");var o=n("U");var u=n("m");var a=n("G");var f=n("M");var l=n("O");var c=n("l");var h=n("K");var p=n("B");var d=n("D");var v=n("d");var m=new d;var g=h.prototype;var y=function(e){h.call(this,e);this.createDOM(["like_count_wrap","back_all","like_list","count_control","like_count_control"]);this.CacheDB={mix:{},comment:{},like:{}}};p.extend(true,y.prototype,g,{constructor:y,getCheckCode:function(e,t){function a(){m.popLay.find("[node-type=prompt_icon]").attr("class","mk_ico "+i["error"]);m.popLay.find("[node-type=prompt_msg]").text(o["error"])}function f(){var e=p("input[node-type=paint]").val();var r=p.trim(e).length;if(r<4||r>6){a();return}t["checkcode"]=e;n.postDatas(t,function(e){if(e.hasOwnProperty("reply_uid")){if(n.PAG.pageIndex==1){n.insertNewItem(e)}else{n.returnFirstPage(e)}n.updateCount();n.delMiniComment()}else{if(n.PAG.pageIndex==1){n.insertNewItem(e)}else{n.returnFirstPage(e)}n.updateCount()}m.close()})}var n=this;var r=function(){return s.baseURL+"sina/paint?v="+(new Date).valueOf()};var i={error:"mk_fail",info:"mk_remind"};var o={error:"你输入的验证码有误，请重新输入",info:"请输入验证码"};var u='<div class="L_prompt">                            <div class="prompt M_txtc">                                <span node-type="prompt_icon" class="mk_ico '+i[e]+'"></span>                                <em class="cont" node-type="prompt_msg">'+o[e]+'</em>                            </div>                            <div class="verify">                                <input class="M_inpt" type="text" maxlength="6" node-type="paint">                                <span class="img">                                    <img src="'+r()+'" height="29" node-type="checkcode">                                </span>                                <a href="#" class="change" title="换一换" action-type="changecode">换一换</a>                            </div>                            <div class="submit_centr">                                <a class="M_btn_e" href="#" action-type="submit"><span>确定</span></a>                                <a class="M_btn_e" href="#" action-type="cancel"><span>取消</span></a>                            </div>                        </div>';m.customTip(u);m.popLay.delegate("a[action-type=changecode]","click",function(){m.popLay.find("img[node-type=checkcode]").attr("src",r());return false});m.popLay.delegate("a[action-type=submit]","click",function(){f();return false});m.popLay.delegate("input[node-type=paint]","keyup",function(e){if(e.which==13||e.which==10)f()})},destroyMixCache:function(e,t){delete this.CacheDB[e][t]},destroyMixAllCache:function(){this.CacheDB={mix:{},comment:{},like:{}};o.ajaxMangerDestory()},getCommentTotal:function(e){var t=0;e.forEach(function(e){if(e["sortType"]==1)t++});return t},getDatas:function(e,t,n,r,i,s){var o=this;t["like_uid"]=t["comment_uid"];t["page"]=e;var u=o.CacheDB["mix"][p.param(t)];if(u){o.like_total=u.like_total;o.total=u.total;o.mode=1;if(o.PAG)o.PAG.pageSize=10;if(o.config.hidePraise)u.like_total=0;u.data=[];n(u);if(!s&&!o.config.hidePraise&&u.like_total){o.updateLike(1,true,function(){var e=p("a["+o._dom["like_count_control"]+"]");e.removeClass("M_linkc");e.siblings().addClass("M_linkc")})}else if(u.total){o.updateCOM(1,true,function(){var e=p("a["+o._dom["count_control"]+"]");e.removeClass("M_linkc");e.siblings().addClass("M_linkc")})}}else{g.getDatas.call(this,e,t,function(e){o.like_total=e.like_total;o.total=e.total;o.mode=1;if(o.PAG)o.PAG.pageSize=10;o.CacheDB["mix"][p.param(t)]=e;if(o.config.hidePraise)e.like_total=0;e.data=[];n(e);if(!s&&!o.config.hidePraise&&e.like_total){o.updateLike(1,true,function(){var e=p("a["+o._dom["like_count_control"]+"]");e.removeClass("M_linkc");e.siblings().addClass("M_linkc")})}else if(e.total){o.updateCOM(1,true,function(){var e=p("a["+o._dom["count_control"]+"]");e.removeClass("M_linkc");e.siblings().addClass("M_linkc")})}else{}},r,"likes/get_info")}},postDatas:function(e,t){var n=this;n.destroyMixAllCache();g.postDatas.call(this,e,function(r){if(r.needCheckCode){if(r.code==15001){n.getCheckCode("info",e)}else if(r.code==15002){n.getCheckCode("error",e)}return}if(t)t(r)})},getCommentDatas:function(e,t,n,r){var i=this;t["page"]=e;var s=i.CacheDB["comment"][p.param(t)];if(s){i.like_total=s.like_total;i.total=s.total;i.mode=2;if(i.PAG)i.PAG.pageSize=10;n(s)}else{g.getDatas.call(this,e,t,function(e){i.like_total=e.like_total;i.total=e.total;i.mode=2;if(i.PAG)i.PAG.pageSize=10;i.CacheDB["comment"][p.param(t)]=e;n(e)},r)}},getLikeDatas:function(e,t,n,r){var i=this;t["like_uid"]=t["comment_uid"];t["page"]=e;var s=i.CacheDB["like"][p.param(t)];if(s){i.like_total=s.like_total;i.total=s.total;i.mode=3;if(i.PAG)i.PAG.pageSize=10;n(s)}else{g.getDatas.call(this,e,t,function(e){i.like_total=e.like_total;i.total=e.total;i.mode=3;if(i.PAG)i.PAG.pageSize=10;i.CacheDB["like"][p.param(t)]=e;n(e)},r,"likes/get_liker")}},createCounts:function(){var e=this,t='<a class="cmnt M_linkc" '+e._dom["count_control"]+">评论 (<span "+e._dom["count_wrap"]+">{total}</span>)</a>",n=e.config.hidePraise?"":'<a class="like M_linkc" '+e._dom["like_count_control"]+">赞 (<span "+e._dom["like_count_wrap"]+">{like_total}</span>)</a>",r='<a href="#" '+e._dom["back_all"]+' class="backall" style="display:none"></a>';return'<p class="cmnt_count M_txtb">'+r+n+(n?'<span class="M_vline"></span>':"")+t+"</p>"},createCommentTxt:function(){var e=this;return'<textarea class="M_txtarea'+(v.isLogin()?"":" M_tareadis")+'" '+(v.isLogin()?"":" disabled ")+e._dom["comment_txt"]+' id="_'+(new Date).valueOf()+'" style="overflow:hidden;">'+(v.isLogin()?"":"登录以后就能畅所欲言了哦！")+"</textarea>"},createCommentBar:function(){var e=this;var t='<label class="t"><input '+e._dom["comment_intransit"]+' type="checkbox" class="M_checkbox">同时分享到微博</label>';var n=v.isLogin()?'<div class="forward">                    <span '+e._dom["comment_face"]+' class="M_ico M_icon30"></span>'+t+"                    </div>":"";return'<div class="submit M_txtb">'+n+'<a class="M_btn_c" '+e._dom["comment_reply_btn"]+' href="#">评论</a></div>'},createCommentBox:function(e,t,n,r){var i=this,s=r.is_allowed?"":'style="padding-bottom:0px"';return'<div class="m_commentBox" '+s+'><div class="cmnt_area" node-type="face_parent">'+t+n+"</div></div>"},createCommentList:function(e){var t=this;return'<div class="m_commentList">'+f(t.createCounts(),t.config.initdata)+"<div "+t._dom["comment_allreply_wrap"]+">"+e+"</div></div>"},createLikeItem:function(){var e=this;return'<dl class="reply_items clearfix" is_liker="true" node-data-name="{screen_name}" node-data-user-id="{uid}" node-data-target="{target_id}" node-data-uid="{comment_uid}" uid="{id}"  node-data-id="{comment_id}">                    <dt class="m_thumb m_thumb_b">                      <a title="{screen_name}" href="{user_href}" action-type="get_card" action-data="{screen_name}"><img src="{profile_image_url}"></a>                    </dt>                    <dd class="reply_cont">                        <div class="contBox" node-type="reply_mini">                            <p class="M_txtb">                              <span class="reply_nm">                                <a href="{user_href}" action-type="get_card" action-data="{screen_name}">{screen_name}</a>{v}:                               </span>                              <span class="cont" '+e._dom["comment_content"]+'><span class="M_ico M_icon6_on"></span> 赞了这{like_type}</span>                              {txt_more}                            </p>                            <p class="time_reply M_txtb"><span class="time">&nbsp;</span></p>                            <div '+e._dom["like_list"]+">{lis}</div>                        </div>                    </dd>             </dl>"},createItemTemp:function(e){if(e.sortType==2){if(e.user){delete e.user.created_at;p.extend(e,e.user)}return this.createLikeItem()}else{e["v"]=u(e["verified"]||"");return g.createItemTemp.call(this,e)}},updateCount:function(){p("span["+this._dom["count_wrap"]+"]").html(this.total);p("span["+this._dom["like_count_wrap"]+"]").html(this.like_total)},initAction:function(){var e=this,t=e.config;g.initAction.call(e);p("a["+e._dom["count_control"]+"]").live("click",function(){var t=this;e.updateCOM(1,true,function(){p(t).removeClass("M_linkc");p(t).siblings().addClass("M_linkc")})});p("a["+e._dom["like_count_control"]+"]").live("click",function(){var t=this;e.updateLike(1,true,function(){p(t).removeClass("M_linkc");p(t).siblings().addClass("M_linkc")})});p("a["+e._dom["back_all"]+"]").live("click",function(){var t=this;e.update(1,true,function(){p(t).siblings().addClass("M_linkc")});return false})},insertNewItem:function(){var e=this;p("a["+e._dom["count_control"]+"]").trigger("click");p("textarea["+e._dom["comment_txt"]+"]").val("")},returnFirstPage:function(e,t){var n=this;g.returnFirstPage.call(n,e,t);p("textarea["+n._dom["comment_txt"]+"]").val("")},controlbar:function(e){var t=this,n=p("a["+t._dom["back_all"]+"]").closest(".m_commentList");if(e.total=="0"&&e.like_total=="0"){n.hide()}else{n.show()}},commonUpdate:function(e,t,n){var r=this;r.controlbar(e);r.updateCount();r.updateComment(e);switch(r.mode){case 1:var i=parseInt(e.total,10)+parseInt(e.like_total,10);r.PAG.initUI3();r.PAG.updateUI(i,t);break;case 2:r.PAG.initUI2();r.PAG.updateUI(e.total,t);break;case 3:r.PAG.initUI2();r.PAG.updateUI(e.like_total,t);break;default:break}r.destroyCache(e["target_id"]+e["uid"]);r.delMiniComment()},drawLiker:function(e,t){var n=this,r=t.data;for(var i in r){var o='<ul class="likeList clearfix">';for(var u=0;u<r[i]["photos"].length;u++){var a="";p.extend(r[i]["photos"][u],{square_pic:function(){var e=r[i]["photos"][u],t=l(e,"square");if(e["flag"]==1){return t}else{a="item_loader";return s.baseIMG+"common/loaderr40.png"}}()});o+=f("<li class="+a+'><a href="'+s.baseURL+'{uid}/likes/photo_detail/photo_id/{target_id}"><img width="40" height="40" src="{square_pic}"></a></li>',r[i]["photos"][u]);if(u==4){o+='<li class="more"><a href="'+s.baseURL+i+'/likes/photos">更多</a></li>'}}o+="</ul>";p(e[i]).find("["+n._dom["like_list"]+"]").html(o)}},updateCOM:function(e,t,n){var r=this,i=r.config;r.getCommentDatas(e,{target_id:i.target_id,comment_uid:i.comment_uid,type:i.type,album_id:i.album_id,album_type:i.album_type},function(t){r.commonUpdate(t,e);p("a["+r._dom["back_all"]+"]").show();if(n)n(t)},t)},updateLike:function(e,t,n){var r=this,i=r.config;r.getLikeDatas(e,{target_id:i.target_id,comment_uid:i.comment_uid,type:i.type},function(t){p.each(t.data,function(e,t){t["sortType"]=2});r.commonUpdate(t,e);p("a["+r._dom["back_all"]+"]").show();r.getLikersDetail();if(n)n(t)},t)},update:function(e,t,n){var r=this,i=r.config;p(i.wrap).hide();r.getDatas(e,{target_id:i.target_id,comment_uid:i.comment_uid,type:i.type},function(t){p(i.wrap).show();r.commonUpdate(t,e,true);p("a["+r._dom["back_all"]+"]").hide();r.getLikersDetail();if(n)n(t)},t)},initComment:function(){var e=this;g.initComment.call(this,function(t){e.getLikersDetail();p("a["+e._dom["back_all"]+"]").hide();e.controlbar(t);c.init(p("textarea["+e._dom["comment_txt"]+"]").get(0))})},delData:function(e,t){var n=this;n.destroyMixAllCache();g.delData.call(n,e,function(e){if(n.mode==1)n.update(1,true);if(n.mode==2)n.updateCOM(1,true)})},updateComment:function(e){var t=this,n=t.config,r,i="",o=function(e,n,r){if(!e.length){var o="",a=r==1?"个专辑":"张照片";switch(t.mode){case 2:o="这"+a+"还没有评论";break;case 3:o="这"+a+"还没有被赞过";break;default:break}i='<p class="no_feedback M_txte">'+o+"</p>"}else{p.each(e,function(e,r){var o=t.createItemTemp(r);r["uid"]=r["uid"];r["loginUid"]=n;r["user_href"]=s.baseURL+r["uid"]+"/albums/";r["comment_bar"]=t.createUserBar(r);r["v"]=u(r["verified"]);r["like_type"]=r["like_type"]?r["like_type"]==1||r["like_type"]==3?"个专辑":"张照片":undefined;r["ta"]=r["uid"]==$GLOBAL_INFO["account_uid"]?"我":r["gender"]=="m"?"他":"她";r["txt_more"]=function(){if(r["photos_total"]=="0")return"";if(r["like_type"]=="个专辑"){return'<a href="'+s.baseURL+r["uid"]+'/likes/photos" class="likes">'+r["ta"]+"还赞了 "+r["photos_total"]+" 张</a>"}else if(r["like_type"]=="张照片"&&r["photos_total"]>1){return'<a href="'+s.baseURL+r["uid"]+'/likes/photos" class="likes">'+r["ta"]+"还赞了 "+(parseInt(r["photos_total"],10)-1)+" 张</a>"}else{return""}}();r["lis"]=function(){var e=r["photos_total"]>5?5:r["photos_total"];if(e==1&&r["like_type"]==2)return"";var t='<ul class="likeList clearfix">';for(var n=0;n<e;n++){t+='<li class="M_loading" style="border:#eee solid 1px;"></li>'}t+="</ul>";return t}();i+=f(o,r)})}};if(e){r=e;o(r.data,r["loginUid"],t.config.initType);p("["+t._dom["comment_allreply_wrap"]+"]").html(i);t.updateCount();t.allowToggle(!!e["is_allowed"])}else{r=t.config.initdata;o(r.data,r["loginUid"],t.config.initType);t.config.allow_Comment=r.is_allowed?true:false;var l=t.createCommentList(i);p(t.config.wrap).append(l);t.PAG=new a({total:parseInt(r.total,10)+parseInt(r.like_total,10),pageSize:r.minx,maxShowNum:r.pageSize,pageIndex:r.current,node:p('<div class="m_pages m_pages_comment M_linke" style="padding:20px 10px 0 0;"></div>'),callback:function(e){switch(t.mode){case 1:t.PAG.pageSize=10;t.update(e.page,true);break;case 2:t.PAG.pageSize=10;t.updateCOM(e.page,true);break;case 3:t.PAG.pageSize=10;t.updateLike(e.page,true);break;default:break}}});t.PAG.initUI3();p(t.config.wrap).append(t.PAG.ui);t.PAG.gotoPage(r.current)}p(t).trigger("insertAfter",[t.total])},collectLikers:function(){var e=this,t={dls:{},value:[]};p("div["+e._dom["comment_allreply_wrap"]+"]>dl").each(function(e,n){if(p(this).attr("is_liker")){var r=p(this).attr("uid");t["dls"][r]=n;t["value"].push(r)}});t["value"]=t["value"];return t},getLikersDetail:function(){var e=this;var t=e.collectLikers();if(t["value"].length===0)return;var n=4,r=Math.ceil(t["value"].length/n),i=[],u=[];for(var a=0;a<r;a++){var f=t["value"].slice(a*n,a*n+n);i.push({url:s.baseURL+"likes/get_liked_photos?target_id="+e.config.target_id+"&users="+f.join(","),type:"get"});(function(n){u.push(function(r,i){var s={};for(var o=0;o<n.length;o++){s[n[o]]=t["dls"][n[o]]}e.drawLiker(s,i)})})(f)}o.ajaxManger(i,u,true)}});e.exports=y},U:function(e,t,n,r){var i=n("S");var s={};var o=function(e,t){i.get(e["url"],function(e,n){t(e,n)},e["data"]||{},e["type"]||"post");s[e["url"]]=e["data"]||{}};var u=function(e,t){var n,r=[];if(e.length&&t.length&&e.length==t.length){for(n=0;n<e.length;n++){o(e[n],t[n])}}else if(e.length&&typeof t=="function"){r.length=e.length;for(n=0;n<e.length;n++){(function(n){o(e[n],function(e,i){r[n]=i;for(var s=0;s<r.length;s++){if(r[s]==undefined)break;if(s==r.length){t.apply(null,r)}}})})(n)}}};e.exports={ajaxManger:u,ajaxMangerDestory:function(){for(var e in s){i.destroy(e,s[e])}}}},v:function(e,t,n,r){var i=n("b");var s=n("V");var o=n("e");var u=n("m");var a=n("O");var f=n("s");var l=n("n");var c=n("B");var h=n("E");var p=n("r");var d=n("w");var v=n("q");var m=n("W");i.Backbone=Backbone;i.Mu=Mustache;var g=l.DetailTool;var y=36;var b=function(e){for(var t in e){this[t]=e[t]}return this};var w='<div node-type="lastTip" class="L_alpha L_alpha_a">		<div style="height:500px;" class="content">			<div class="closearea" action-type="close_tips"><span class="M_ico M_icon24" title="关闭"></span></div>			<div class="m_album m_album_info clearfix">				<div class="bd">					<div class="m_cover m_cover_a">{{&top_main}}					</div>					<div class="txt">						<p class="tip M_txtc">{{&last_txt}}						</p>						<div class="act clearfix">{{&act_bar}}							<a action-type="GotoFirst" class="M_btn_f btn_seeagain M_linkc" href="#"><span class="M_ico M_icon48"></span>再看一遍</a>						</div>					</div>				</div>			</div>			<div class="m_album m_more_album">				<div class="hd">					<p class="t">						<a href="{{href}}">{{name}}</a><span class="M_txtb">还有更多相册专辑</span>					</p>					<div class="more">{{&more}}</div>				</div>				<div class="bd">					<ul class="lst M_linkb clearfix">{{#album_list}}						<li>							<div class="m_cover m_cover_d">								<div class="img_wrap">									{{{mask}}}									<a href="{{albumURL}}">									{{{flag}}}										<img width="120" height="120" src="{{cover_pic_ret}}">										</a>									</div>								</div>								<p class="name"><a href="{{albumURL}}" title="{{caption}}">{{title}}</a></p>							</li>    {{/album_list}}						</ul>					</div>				</div>				<div class="m_album m_recommand_img">prettify\n					<div class="hd">						<p class="t M_txtb">更多精彩照片</p>						<div class="more"><a href="{{recommend_more}}">进入相册广场&gt;&gt;</a></div>					</div>					<ul class="recmd_pht clearfix">{{#recommendPhoto}}						<li><a href="{{href}}"><img width="90" height="90" src="{{thumb_url}}"></a></li>{{/recommendPhoto}}</ul>					</div>				</div>			</div>';var E='		<p class="time M_txtb">			上传于<span class="date">{{created_at}}</span>来自{{&from}}			<span class="limit"><span class="M_ico {{limit_icon}}" title="{{limit_txt}}"></span>{{limit_txt}}</span>		</p>		<div class="m_handle">			<a class="M_btn_c_a M_arrw_d_c" href="#" action-type="top_edit">				<span class="M_arrw_dwSml"></span>				<span class="t">更多操作</span>			</a>			<div node-type="edit_muen" style="display: none;" class="m_btnlayer M_linke">				<ul class="menulist">					<li><a title="幻灯浏览" href="#" action-type="slide_open">幻灯浏览</a></li>					<li><a title="向左旋转" href="#" action-type="turn_left">向左旋转</a></li>					<li><a title="向右旋转" href="#" action-type="turn_right">向右旋转</a></li>				</ul>			</div>		</div>		<div class="mark_box">			{{#favorites}}<a href="#" class="M_linke M_fav_sm M_dotted_y" action-type="my_favorites"><span class="M_ico M_icon77"></span>收藏</a>{{/favorites}}			<span class="M_txtb M_look_sm" title="浏览">			<span class="M_ico M_icon10">			</span>{{clicks}}</span>			<a href="#" class="M_linke M_transmit_sm" title="分享" node-type="intransit" action-type="intransit"><span class="M_ico M_icon4"></span>{{retweets}}</a>			<a href="#" class="M_linke M_comment_sm" title="评论" action-type="comment"><span action-type="comment" class="M_ico M_icon5"></span>{{comments}}</a>			<a href="#" class="M_linke M_like_sm" title="赞" node-type="like_small" action-data="target_id={{photo_id}}&like_uid={{uid}}&type={{type}}&property={{property}}&is_private={{is_private}}" {{likeaction}}><span class="M_ico M_icon6{{islike}}"></span>{{likes}}</a>		</div>';var S={Desc:i.Backbone.View.extend({el:c("[node-type=photo_info]"),descEl:c("p[node-type=desc]"),infoEl:c("div[node-type=info]"),lookbig:c("a[node-type=get_big_img]"),descTemplate:c("#T_Desc").html(),infoTemplate:c("#T_Info").html(),model:f.DetailDB,set:b,events:{"click [action-type=comment]":"toComment","click [action-type=edit_desc]":"editDesc","click [action-type=like],[action-type=unlike]":"smallLike"},toComment:function(){var e=this;g.isLogin(function(){s("[action-type=comment]");c(e.commentEl).focus()});return false},editDesc:function(e){var t=this,n=this.model.get("$info");g.isLogin(function(){var r=t.model.get("PhotoDB"),i=t.model.get("AlbumDB");m.editPhoto({photoID:r["photo_id"],caption:r["caption_render"],tags:r["tags"],show_SetCover:!i["type"]=="18",isCover:!!r["is_cover"],afterEvent:function(i){c(e.target).closest("dl").find(".desc em").html(i["caption"]);g.addTagItem(i["tags"],i["uid"]!=n["account_uid"],true);g.emStyle();c.extend(r,i);t.model.unset(r["photo_id"]);t.model.unsetLike(r["photo_id"])}})});return false},smallLike:function(e){var t=this,n=this.Photo,r=c("[node-type=like_small]"),i=r.attr("action-type"),s=t.model.get("PhotoDB");if(!n.likeflag)return false;n.likeflag=false;g.isLogin(function(){n.Mylike[i].call(r,r,function(e,r,i){var o=c("[action-type=biglike]"),u=o.find("em"),a=o.find(".bg>span"),f=n.allList?n.allList["photo_list"]||n.allList:undefined,l=i?"M_icon7_on":"M_icon7";s["is_liked"]=i;n.likeflag=true;a.attr("class","M_ico "+l);u.text(r);var h=c('[node-type="like_bar"]'),p=h.find(">a"),d=h.find("i"),v=h.find("span"),m=r;if(s["is_liked"]){d.attr("class","icon_praised");v.text("("+m+")");p.text("已赞")}else{d.attr("class","icon_praise");v.text("("+m+")");p.text("赞+1")}f&&n.upslide(f,s);if(n.detail_comment){n.detail_comment.destroyMixAllCache();n.updateComment(n.detail_comment.mode)}t.model.unset(s["photo_id"]);t.model.unsetLike(s["photo_id"])})});return false},getDescData:function(){var e=this.model,t=e.get("PhotoDB"),n=e.get("$info"),r=e.get("AlbumDB");c.extend(t,t["count"]);c.extend(t,{property:r["property"],album_type:r["type"],edit_bar:function(){if(t["uid"]==n["account_uid"]){return t["type"]!=15&&r["type"]!=45?'<span node-type="editdes" class="edit_tip"><a href="#" action-type="edit_desc">编辑描述</a></span>':""}return""},islike:t["is_liked"]?"_on":"",is_private:t["visible_type"]==6||t["visible_type"]==4||t["visible_type"]==1?true:false,likeaction:t["is_liked"]?"action-type=unlike":"action-type=like",href:o.baseURL+t["uid"]+(t["type"]==15?"/wbphotos/large/photo_id/":"/photos/large/photo_id/")+t["photo_id"]});return t},getLimits:function(e){var t=e||{},n=this.model.get("PhotoDB"),r=this.model.get("AlbumDB"),i=this.model.get("$info"),s=this.options.icons_limits(r["property"],r["type"]);var o=r["property"];t["limit_txt"]=s[0];t["limit_icon"]=s[1];if("1"===o){t["limit_icon"]="";t["limit_txt"]=""}t["favorites"]=n["uid"]!=i["account_uid"];return t},changeLimitClass:function(){var e="_un",t="_un",n="",r=this.model.get("PhotoDB"),i=this.model.get("AlbumDB");if(i["property"]==1&&r["visible_type"]!=1&&r["visible_type"]!=4&&r["visible_type"]!=6){e="_sm";t="";n="intransit"}c("[node-type=intransit]").attr("class","M_txtb M_transmit"+e).find("span").attr({"class":"M_ico M_icon4"+t,"action-type":n})},T_OPERATE:'<p class="time M_txtb">                    {{#feed_id}}<a href="http://weibo.com/{{uid}}/{{feed_id}}">{{/feed_id}}上传于<span class="date">{{created_at}}</span>{{#feed_id}}</a>{{/feed_id}}来自{{&from}}                    <span class="limit"><span class="M_ico {{limit_icon}}" title="{{limit_txt}}"></span></span>                    </p>                    <div class="m_handle">						<a href="#" class="M_btn_c_a M_arrw_d_c" action-type="other_edit"><span class="M_arrw_dwSml"></span><span class="t">更多操作</span></a>						<div class="m_btnlayer M_linke" node-type="edit_menu">							<ul class="menulist">								<li><a title="向左旋转" href="#" action-type="turn_left">向左旋转</a></li>            					<li><a title="向右旋转" href="#" action-type="turn_right">向右旋转</a></li>							</ul>						</div>					</div>                     <div class="mark_box">                     <a href="{{bigurl}}" class="M_linke M_showbig_sm" node-type="get_big_img" target="_blank" title="查看大图"><span class="M_ico M_icon91"></span>查看大图</a>                     {{#favorites}}<a href="#" class="M_linke M_fav_sm M_dotted_y" action-type="my_favorites"><span class="M_ico M_icon77"></span>收藏</a>{{/favorites}}                     <span class="M_txtb M_look_sm" title="浏览"><span class="M_ico M_icon10"></span>{{clicks}}</span>                     <a href="#" class="M_linke M_transmit_sm" title="分享" node-type="intransit" action-type="intransit"><span class="M_ico M_icon4"></span>{{retweets}}</a>                     <a href="#" class="M_linke M_comment_sm" title="评论" action-type="comment"><span action-type="comment" class="M_ico M_icon5"></span>{{comments}}</a>                     <a href="#" class="M_linke M_like_sm" title="赞" node-type="like_small" action-data="target_id={{photo_id}}&like_uid={{uid}}&type={{type}}&property={{property}}&is_private={{is_private}}" {{likeaction}}><span class="M_ico M_icon6{{islike}}"></span>{{likes}}</a>                     </div>',T_INFO:'<p class="time M_txtb">                    {{#feed_id}}<a href="http://weibo.com/{{uid}}/{{feed_id}}">{{/feed_id}}上传于<span class="date">{{created_at}}</span>{{#feed_id}}</a>{{/feed_id}}来自{{&from}}                    <span class="limit"><span class="M_ico {{limit_icon}}" title="{{limit_txt}}"></span></span>                    </p>                     <div class="mark_box">                     <a href="{{bigurl}}" class="M_linke M_showbig_sm" node-type="get_big_img" target="_blank" title="查看大图"><span class="M_ico M_icon91"></span>查看大图</a>                     {{#favorites}}<a href="#" class="M_linke M_fav_sm M_dotted_y" action-type="my_favorites"><span class="M_ico M_icon77"></span>收藏</a>{{/favorites}}                     <span class="M_txtb M_look_sm" title="浏览"><span class="M_ico M_icon10"></span>{{clicks}}</span>                     <a href="#" class="M_linke M_transmit_sm" title="分享" node-type="intransit" action-type="intransit"><span class="M_ico M_icon4"></span>{{retweets}}</a>                     <a href="#" class="M_linke M_comment_sm" title="评论" action-type="comment"><span action-type="comment" class="M_ico M_icon5"></span>{{comments}}</a>                     <a href="#" class="M_linke M_like_sm" title="赞" node-type="like_small" action-data="target_id={{photo_id}}&like_uid={{uid}}&type={{type}}&property={{property}}&is_private={{is_private}}" {{likeaction}}><span class="M_ico M_icon6{{islike}}"></span>{{likes}}</a>                     </div>',render:function(){var e=this.getDescData();var t=this.descTemplate;if((e["type"]==15||e["album_type"]==45)&&e["feed_id"]){t=t+'<a href="http://weibo.com/{{uid}}/{{feed_id}}">( 查看微博 )</a>'}e["bigurl"]=o.baseURL+e["uid"]+(e["type"]==15?"/wbphotos/large/photo_id/":"/photos/large/photo_id/")+e["photo_id"]+"/album_id/"+e["album_id"];c(this.descEl).html(i.Mu.render(t,e));e=this.getLimits(e);var n=this.model.get("$info");var r=e["uid"]==n["account_uid"];var t=this.T_INFO;if(!r){t=this.T_OPERATE}c(this.infoEl).html(i.Mu.render(t,e));this.changeLimitClass();return this}}),Exif:i.Backbone.View.extend({el:c("#exif"),elwrap:c("div[node-type=exif]"),model:f.DetailDB,moreEl:c("a[action-type=more_exif]"),msg:["更多EXIF信息","收起"],template:c("#T_Exif").html(),set:b,events:{"click [action-type=more_exif]":"Exiftoggle","click [action-type=more_exif_disabled]":"Exifdisabled"},createExifObject:function(e){var t=[],n=false,r={Model:"相机型号",Make:"厂家",DateTimeOriginal:"拍摄日期",FocalLength:"焦距",FNumber:"光圈",ExposureTime:"曝光时间",ISOSpeedRatings:"感光度",ExposureProgram:"曝光程序",MeteringMode:"测光模式"},i=e||{},s=["Model","DateTimeOriginal","Make","FocalLength","FNumber","ExposureTime","ISOSpeedRatings","ExposureProgram","MeteringMode"];s.forEach(function(e){var s=r[e],o;if(i[e])n=true;o=i[e]||"未知";t.push({key:s,value:o})});return n?{exif:t}:n},Exifdisabled:function(){return false},Exiftoggle:function(e){var t=this;var n=c(t.elwrap),r=n.attr("class")==="p1",i=r?"p2":"p1",s=r?{height:"auto"}:{height:y,overflow:"hidden"},o=r?1:0;n.attr("class",i);n.css(s);c(e.target).text(t.msg[o]);return false},render:function(){var e=this.model.get("PhotoDB")["exif"],t=this.createExifObject(e);if(t){c(this.elwrap).attr("class","p1").html(i.Mu.render(this.template,t)).css({height:y,overflow:"hidden"});c(this.moreEl).show().text(this.msg[0]);c(this.el).show()}else{c(this.el).hide()}}}),lastTip:i.Backbone.View.extend({el:c("body"),elWrap:"div[node-type=lastTip]",template:w,set:b,model:f.DetailDB,events:{"click div[action-type=close_tips]":"closeTip","click a[node-type=forward_album]":"forwardAlbum","click a[node-type=like_album]":"likeAlbum","click a[action-type=GotoFirst]":"GotoFirst"},closeTip:function(){c(this.elWrap).remove();this.Photo.lastMask.hide();return false},forwardAlbum:function(){var e=this.model.get("AlbumDB"),t=this.model.get("$info"),n=e["cover_pic"]===""?o.baseIMG+"/common/status_0.png":e["cover_pic"];c("div[action-type=close_tips]").trigger("click");v.forwardDialog({caption:e["caption"],who:t["owner_data"]["name"],uid:t["owner_uid"],target_id:e["album_id"],target_uid:e["uid"],url:n,type:e["type"]==3?3:1,albumId:e["album_id"],img:n});return false},likeAlbum:function(e){var t=this.model.get("AlbumDB"),n=c("[node-type=like_album]");if(t["is_liked"]){this.albumLike.unlike.call(n,n,function(){t["is_liked"]=false})}else{this.albumLike.like.call(n,n,function(){t["is_liked"]=true})}return false},GotoFirst:function(){var e=this.Photo;c("div[action-type=close_tips]").trigger("click");if(this.isLikePage){e.updatePage(this.likesIds[0])}else{e.updatePage(this.commonIds[0])}return false},createLastTipObject:function(e,t){var n={},r=[],s=0,u=false,a=this.model.get("$info"),f=this.model.get("AlbumDB"),l=this.model.get("PhotoDB"),h=this.isLikePage;e.album_list=e.album_list.filter(function(e){if(e["album_id"]==f["album_id"]){return false}else if(e["type"]!=1){r.push(e);return false}s++;if(s>4){u=true}return true});e.album_list=e.album_list.slice(0,4);e.album_list=Array.prototype.concat.call([],e.album_list,r.slice(0,4-e.album_list.length));e.album_list.forEach(function(e){e["cover_pic_ret"]=function(){if(e["cover_pic"]===""){if(e.count&&!e.count.photos){return o.baseIMG+"common/status_0.png"}if(e["property"]==5)return o.baseIMG+"common/status_3.png";if(e["property"]==3)return o.baseIMG+"common/status_ilustri.png";if(e["property"]==18)return o.baseIMG+"common/default_head.png";if(e["property"]==11)return o.baseIMG+"common/status_4.png";return o.baseIMG+"common/status_0.png"}return e["cover_pic"]};if(!i.isSelf&&!e["isPay"]&&(e["type"]==43||e["type"]==44)){e["mask"]='<div class="pic_mask">							<div class="mask_bg"></div>							<a href="'+e["albumURL"]+'" class="act_btn">'+(e["type"]==43?"开会员":"购 买")+"</a>						</div>"}if(e["type"]==43||e["type"]==44){e["flag"]='<span class="'+(e["type"]==43?"photo_vippic":"photo_paypic")+'"></span>'}e["title"]=e["caption"].cutString(18,"...",0);e["albumURL"]=o.baseURL+a["owner_uid"]+(e["type"]==3?"/talbum/index":"/albums/detail/album_id/"+e["album_id"])});t.recommendPhoto.forEach(function(e){e["href"]=function(){var e=this.type==2?"/photos/detail":"talbum/detail";return o.baseURL+this.uid+e+"/photo_id/"+this.photo_id}});c.extend(n,e);c.extend(n,t);c.extend(n,{top_pic:function(){if(h){return a["owner_data"]["avatar_large"]}return f["cover_pic"]},top_pic_href:function(){if(h){return o.baseURL+a["owner_uid"]+"/albums"}return this.album_url},act_bar:"",album_name:f["caption"],album_url:o.baseURL+a["owner_uid"]+(f["type"]==3?"/talbum/index":"/albums/detail/album_id/"+f["album_id"]),href:o.baseURL+a["owner_uid"]+"/albums",name:a["owner_data"]["screen_name"],recommend_more:o.baseURL+"welcome/hot",top_main:function(){if(h){return'<div class="m_thumb m_thumb_b"><a href="'+this.top_pic_href()+'"><img src="'+this.top_pic()+'" width="90" height="90"></a></div>'}return'<div class="img_wrap"><a href="'+this.top_pic_href()+'"><img width="90" height="90" src="'+this.top_pic()+'"></a></div>'},last_txt:function(){if(h){return this.name+'<a class="album_name" href="'+o.baseURL+a["owner_uid"]+'/likes/photos">赞过的照片</a>没有下一页了哦！'}return'专辑<a class="album_name" href="'+this.album_url+'">'+this.album_name+"</a>没有下一页了哦！"},more:function(){if(e.album_list.length<4)return"";return'<a href="'+o.baseURL+a["owner_uid"]+"/albums"+'">更多</a>'}});return n},render:function(){var e=this.createLastTipObject(this.album,this.recommend),t=this.Photo,n=(c(window).height()-500)/2;c(this.el).append(i.Mu.render(this.template,e));c(this.elWrap).css({top:n<0?0:n,left:(c(document).width()-690)/2,"z-index":9999});if(!t.lastMask)t.lastMask=new h(40);t.lastMask.show()},initialize:function(){this.albumLike=new p(c(".F_cols_main"));this.albumLike.recommandLike=true}}),userBox:i.Backbone.View.extend({el:c("div[node-type=user_box]"),model:f.DetailDB,set:b,template:c("#T_userBox").html(),userData:null,getUserData:function(e){var t=this;var n=this.model.get("$detail")["is_likes_page"];if(n){var r=this.model.get("AlbumDB")["uid"];this.model.getUserByUid(r,function(n){if(n&&n.result){if(e&&typeof e=="function"){e.call(t,n.data)}}})}else{if(!t.userData){t.userData=t.model.get("$info")["owner_data"];if(e&&typeof e=="function"){e.call(t,t.userData)}}}},batchData:function(e){var t=this,n=this.model.get("$info"),r;if(e["following"]===true&&e["follow_me"]===true){r=3}else if(e["following"]===true){r=1}else{r=0}c.extend(e,{myAlbumUrl:o.baseURL+e["id"]+"/albums/",sex:function(){var t=e["gender"],r=e["id"]==n["account_uid"],s="";i.isSelf=r;s=t=="m"?"M_ico M_icon34":"M_ico M_icon35";var o='<span class="'+s+'"></span>';return o},cutname:function(){var t=e["screen_name"],n=10;if(e["verified"]===0)n=12;return t.cutString(n,"...")},ver:u(e["verified"]),attention:function(){var i=e["id"]==n["account_uid"];return i?"":t.follow.addFollow(r,e["id"])}});return e},render:function(){this.getUserData(function(e){var t=this.batchData(e),n={photosURL:o.baseURL+e["id"]+"/photos/",likesURL:o.baseURL+e["id"]+"/likes/photos",albumURL:o.baseURL+e["id"]+"/albums",likes:e.count.likes,photos:e.count.photos,albums:e.count.albums},r=c.extend(n,t);c(this.el).html(i.Mu.render(this.template,r))})},initialize:function(){this.follow=new d({targetNode:c(this.el),initCssClass:"M_btn_d",place:"plaza_info"})}}),editMenu:i.Backbone.View.extend({el:c("div[node-type=operat]"),model:f.DetailDB,template:c("#T_editMenu").html(),ownerMap:{addtag:true,move:true,deletephoto:true,setcover:true,setavatar:true,prettify:true,copy:false},otherMap:{favorites:true},everyoneMap:{zoning:true},getMenuList:function(){var e={},t=this.model.get("PhotoDB"),n=this.model.get("AlbumDB"),r=this.model.get("$info"),i=this.model.get("$detail"),s=t["uid"]==r["account_uid"];e["owner"]=s;if(n["property"]==1&&t["visible_type"]!=1&&t["visible_type"]!=4&&t["visible_type"]!=6)c.extend(e,this.everyoneMap);this.ownerMap.prettify=!(n["property"]==11||n["type"]==45);this.ownerMap.setavatar=!(n["property"]==11);if(s)c.extend(e,this.ownerMap);else c.extend(e,this.otherMap);if(n["type"]==18||n["type"]==45){e["move"]=false;e["setcover"]=false}if(n["type"]==32||n["type"]==42||n["type"]==3)e["setcover"]=false;e["isLikePage"]=!i["is_likes_page"];if(t["type"]==15){e["move"]=false;e["copy"]=true}return e},render:function(){var e=this.getMenuList();c("[node-type=tag]").remove();if(e.owner){c(this.el).show().html(i.Mu.render(this.template,e))}else{c(this.el).hide().html()}if(this.model.get("AlbumDB")["type"]==45){c("[action-type=del_photo]>.t",this.el).text("移除");c("[action-type=del_photo]>.t",this.el).attr("title","移除照片")}if(e.hasOwnProperty("zoning")){var t=c("#T_zoning_before").html();c("span[node-type=zoning_right]").remove();c("[node-type=zoning_before]").append(t)}else{c("span[node-type=zoning_right]").remove()}if(e.hasOwnProperty("addtag")){var n='<a href="#" class="M_linka M_addTag" action-type="add_tag" node-type="tag"><span class="M_ico M_icon28"></span>新增标签</a>';c("[node-type=tag_menu]").append(n)}}}),RightBar:i.Backbone.View.extend({el:c("div[node-type=right_bar]"),model:f.DetailDB,template:c("#T_rightBar").html(),getBarList:function(){var e={transmit:true},t=this.model.get("PhotoDB"),n=this.model.get("AlbumDB");if(n["property"]!=1||t["visible_type"]==1||t["visible_type"]==4||t["visible_type"]==6)e["transmit"]=false;return e},render:function(){var e=this.getBarList();c(this.el).html(i.Mu.render(this.template,e))}}),RecommendTag:i.Backbone.View.extend({node:"[node-type=recommend_tag]",model:f.DetailDB,template:c("#T_RecommendTag").html(),delegateEvent:function(){c(this.node).delegate("[action-type=recommend_tag]","click",this.addTagItem)},unDelegateEvent:function(){c(this.node).undelegate("[action-type=recommend_tag]","click",this.addTagItem)},addTagItem:function(e){var t=c(this).text(),n=c("input[node-type=single_tag_input]");n.val(t);n.blur();return false},destroy:function(){c(this.node).html("");this.unDelegateEvent()},render:function(){var e=this;this.model.getTagSuggest(10,function(t,n){c(e.node).html(i.Mu.render(e.template,n));e.delegateEvent()})}}),Persons:i.Backbone.View.extend({el:c("[node-type=zoning_list]"),model:f.DetailDB,template:c("#T_Persons").html(),range:11,events:{"click [node-type=more_User]":"userToggle"},userToggle:function(e){var t=c(e.target),n=t.text();if(n=="查看更多"){c(this.el).find("li").show();t.text("收起")}else{c(this.el).find("li:gt("+this.range+")").hide();t.text("查看更多")}return false},getPersons:function(){var e=this.model,t=c("#photo_zoning"),n=e.get("AlbumDB"),r=e.get("PhotoDB"),s=e.get("$info"),u=r["persons"],a={},f=[];if(u.length===0){if(!(n["property"]==1&&r["visible_type"]!=6&&r["visible_type"]!=1&&r["visible_type"]!=4&&r["visible_type"]!=3)){t.hide()}else{t.show()}return{persons:false}}t.show();c.each(u,function(e,t){if(t["adder_uid"]==s["account_uid"]||i.isSelf)t["isSelf"]=true;t["related_url"]=o.baseURL+t["related_uid"]+"/albums";f.push(t)});a={persons:{data:f}};if(f.length>this.range)a.more=true;return a},render:function(){var e=this.getPersons();c(this.el).html(i.Mu.render(this.template,e));c(this.el).find("li:gt("+this.range+")").hide()}}),RecommandPic:i.Backbone.View.extend({el:c("div[node-type=recomm_pic]"),currentTag:"",currentTagId:"",model:f.DetailDB,template:c("#T_Recommand_pic").html(),events:{"mouseenter [node-type=recomm_tag_list]":"onmouseenter"},onmouseenter:function(e){var t=c(e.currentTarget);var n=t.attr("tagId");var r=t.attr("tag");if(n&&this.currentTagId!=n){this.switchTag(t);this.currentTagId=n;this.currentTag=r;this.switchPhoto()}return false},switchPhoto:function(){var e=this.currentTagId,t=this,n=c(this.el).find("[node-type=recomm_photo_list]"),r=n.find("ul[tagId="+e+"]");if(r&&r.length){r.show();r.siblings().hide();n.removeClass("M_loading")}else{n.children().hide();n.addClass("M_loading");this.model.getRecommendTagAndPhotos(e,function(i){if(i&&i.result){r=n.find("ul[tagId="+e+"]");if(t.currentTagId==e&&!r.length){r=c(t.createPhotoList(i.data.tagPhotos[e],e));n.append(r);n.removeClass("M_loading")}}})}},switchTag:function(e){e.siblings().attr("class","");e.attr("class","cur")},createTagList:function(e,t){var n=t.tags||[],r='<ul class="m_tabs m_tabs_a clearfix">',i,s,u;for(var a=0,f=n.length;a<f;a++){i=n[a]["name"];s="";u=o.baseURL+"tags/best/tag/"+i+"?prel=p1_2";if(n[a]["tag_id"]==e){this.currentTagId=e;this.currentTag=i;s="cur"}r+='<li node-type="recomm_tag_list" class="'+s+'" tag="'+i+'" tagId="'+n[a]["tag_id"]+'"><a href="'+u+'" target="_blank">'+i+"</a></li>"}r+="</ul>";r+='<a class="more" target="_blank" title="" href="'+o.baseURL+'welcome/hot?prel=p1_2">更多</a>';return r},createPhotoList:function(e,t){var n='<ul class="clearfix" tag="'+t+'">';var r=encodeURIComponent(this.currentTag);c.each(e,function(e,t){url=o.baseURL+t["uid"]+"/photos/detail/photo_id/"+t["photo_id"]+"?prel=p1_2&tag="+r;n+='<li><a target="_blank" href="'+url+'"><img alt="" src="'+a(t,"square")+'"></a>'});n+="</ul>";return n},render:function(){var e=this;var t="";var n;this.model.getRecommendTagAndPhotos(null,function(r){if(r&&r.result){var i=r.data;n=i.tagPhotos;for(t in i.tagPhotos){n=i.tagPhotos[t];break}c(e.el).html('<div class="recomm_hd clearfix">'+e.createTagList(t,i)+'</div><div class="recomm_bd"><div class="m_thumbnail"><div class="piclist" node-type="recomm_photo_list">'+e.createPhotoList(n,e.currentTagId)+"</div></div></div>")}})}})};e.exports={DetailView:S}},V:function(e,t,n,r){var i=n("B");var s=function(e){var t=40;var n=i(e).offset();var r=n.top-t>0?n.top-t:0;window.scrollTo(n.left,r)};e.exports=s},w:function(e,t,n,r){var i=n("B");var s=n("C");var o=n("e");var u=n("D");var a=n("Q");var f=n("n").DetailTool;var l=o.baseURL;var c=new u;var h=function(e,t){var n=e||{};this.htmlNode=n.targetNode||"";this.initCssClass=n.initCssClass||"";this.place=n.place||"";this.nologin=t;this.addEvent()};h.prototype={constructor:h,_remote:function(e,t){s(i.extend({dataType:"json",type:"post",success:function(e){if(e&&e.result){if(t&&typeof t==="function"){t.call(self,e.data)}}else{c.miniTip(a[10010],{status:"error",autoClose:1500})}}},e))},Follow:function(e,t){var n=this;n._remote({url:l+"users/follow",data:{uid:e}},t)},unFollow:function(e,t){var n=this;n._remote({url:l+"users/follow_destroy",data:{uid:e}},t)},addFollow:function(e,t){function h(e,t){return e.replace(/{@(\w+)}/g,function(e,n){return t[n]===0?0:t[n]||""})}var n=this;var r=n.htmlNode.find("[node-type=follow_status]"),i=n.initCssClass,s=0,o="",u="",a="",f=e||0,t=t,l={user_info:"relation M_linka",plaza_info:"M_btn_d_done"};switch(e||s){case 0:u="加关注";i=i;a='action-type="doFollow"';break;case 1:u="已关注";i=l[n.place];a='mutual-type="mutual"';break;case 3:u="互相关注";i=l[n.place];a='mutual-type="mutual"';break;case 4:u="";i="";break;default:break}var c='<a class="{@cls}" action-islogin="islogin" data-id="{@uid}" follow="{@follow}" {@hover} href="#">{@text}</a>';return h(c,{cls:i,uid:t,follow:f,text:u,hover:a})},checkIframe:function(){window.top.location.replace(window.location);location.href="http://photo.weibo.com/";document.documentElement.style.display="none"},checkEvent:function(){var e=this,t={};t.doFollow=function(t){t.preventDefault();i(this).parent().attr("node-type","isfollow_styles");var n=i(this).attr("data-id"),r=i(this),s=i(this).closest("[node-type=isfollow_styles]"),o={text_all:function(e,t){e.text(t==3?"互相关注":"已关注");e.attr({"action-type":"doUnFollow","mutual-type":"mutual"})},plaza_info:function(e,t){i(this).removeClass("M_btn_d").addClass("M_btn_d_done");o["text_all"](e,t)},user_info:function(e,t){o["text_all"](e,t)},head_info:function(e,t){if(t==3){s.html('<a class="M_btn_d_done" href="javascript:void(0)"><span class="M_ico M_icon32"></span>互相关注</a><a action-type="doUnFollow" data-id="'+n+'" href="#">取消</a>')}else{s.html('<a class="M_btn_d_done" href="javascript:void(0)">已关注</a><a action-type="doUnFollow" data-id="'+n+'" href="#">取消</a>')}}};f.isLogin(function(){e.Follow(n,function(t){var n=t.isFollow,i;r.attr("follow",n);o[e.place](r,n);c.miniTip(a[10006],{status:"success",autoClose:1500})})});return false};t.doUnFollow=function(t){t.preventDefault();i(this).parent().attr("node-type","isfollow_styles");var n=i(this).attr("data-id"),r=e.initCssClass||"M_btn_d fllow",s=i(this).closest("[node-type=isfollow_styles]"),o=s.attr("follow")||0;e.unFollow(n,function(e){s.html('<a action-islogin="islogin" data-id="'+n+'" action-type="doFollow" follow="'+o+'" href="#" class="'+r+'">加关注</a>');c.miniTip(a[10018],{status:"success",autoClose:1500})})};if(!e.nologin){e.htmlNode.delegate("a[action-type=doFollow],a[action-type=doUnFollow]","click",function(n){if(window.top!=window){e.checkIframe();return false}var r=i(this).attr("action-type");t[r].call(this,n)})}},hoverHandler:function(){var e=this,t={_mvFollow:function(){if(e.place==="plaza_info")i(this).removeClass("M_btn_d_done").addClass("M_btn_d");i(this).attr("action-type","doUnFollow");i(this).text("取消关注")},_mvOutFollow:function(){var t=i(this).attr("follow");if(e.place==="plaza_info")i(this).removeClass("M_btn_d").addClass("M_btn_d_done");i(this).removeAttr("action-type");i(this).text(t==3?"互相关注":"已关注")}};e.htmlNode.on("mouseenter","a[mutual-type=mutual]",t["_mvFollow"]);e.htmlNode.on("mouseleave","a[mutual-type=mutual]",t["_mvOutFollow"])},addEvent:function(){var e=this;if(e.htmlNode&&e.place){e.checkEvent();e.hoverHandler()}else if(e.htmlNode){e.hoverHandler()}}};e.exports=h},W:function(e,t,n,r){function h(e,t){if(!u.isLogin()){location.reload();return}s({url:a.baseURL+"photos/update",dataType:"json",type:"post",data:e,success:function(e){if(t&&typeof t==="function"){t.call(this,e)}}})}var i=n("B");var s=n("C");var o=n("D");var u=n("d");var a=n("e");var f=n("Q");var l=n("T");n("p");n("i");var c=new o;i.extend(c,{editPhoto:function(e){var t=this;var n={title:"编辑照片",caption:"",tags:"",isCover:false,photoID:"",show_SetCover:false,afterEvent:null};if(e)i.extend(n,e);var r=n.photoID;var s='<div class="L_editphoto">                            <dl class="m_Layform clearfix">                                <dt>照片描述：</dt>                                <dd class="contBox"><textarea class="M_txtarea" name="caption">'+n.caption+'</textarea></dd>                                <dd class="tipBox"><span class="M_txte" node-type="caption_w"></span></dd>                            </dl>                            <dl class="m_Layform clearfix">                                <dt>照片标签：</dt>                                <dd class="contBox">                                    <div class="inputtxt">                                        <div action-type="tag_box" class="inputbd clearfix">                                                <div class="taglst m_tag_a M_linkc" node-type="photo_tags_'+r+'">                                                </div>                                                <input title="标签间以空格隔开" type="text" name="'+r+'" node-type="single_tag_input" value="标签间以空格隔开" class="M_txte">                                                <input type="hidden" name="'+r+'" value="">                                        </div>                                        <div class="tagarea">                                            <div class="m_tag_a M_linkc" node-type="common_tags">                                            </div>                                        </div>                                        <div class="setcover M_txtb">                                            <label>                                            '+(n.show_SetCover?'<input type="checkbox" name="cover" '+(n.isCover?"checked":"")+' class="M_checkbox">设为专辑封面</label>':"")+'                                            </div>                                    </div>                                </dd>                            </dl>                            <div class="submit_centr">                                <a class="M_btn_e" action-type="submit" href="#"><span>保存</span></a><a class="M_btn_e" action-type="cancel" href="#"><span>取消</span></a>                            </div>                    </div>';t.basicDialog(s,n);var o=new l(t.popLay);var u=t.popLay.find("input:hidden[name="+r+"]");var a=t.popLay.find("textarea");var c=t.popLay.find("input[node-type=single_tag_input]");o.createTag(n.tags,r,u);c.textAuto3(20,/(;|,|；|，|\s)$/);c.bind({keyup:o.onKeyup,blur:function(e){o.onBlur(e,true)},focus:o.onFocus});t.popLay.delegate("[action-type=tag_box]","click",function(e){c.get(0).focus()});t.popLay.delegate("[action-type=remove_tag]","click",o.removeTag);t.popLay.delegate("[action-type=single_add]","click",function(e){var t=this.title;o.createTag(t,r,u);e.preventDefault()});t.popLay.delegate("[action-type=submit]","click",function(e){e.preventDefault();if(c.val()!=c.get(0).title){o.createTag(c.val(),r,u)}c.val("");var i={photo_id:r,caption:a.val().trim(),cover:n.show_SetCover?t.popLay.find(":checkbox").get(0).checked:n.isCover,tags:u.val()};h(i,function(e){t.close();if(e&&e.result){if(n.afterEvent&&typeof n.afterEvent=="function"){n.afterEvent.call(this,e.data)}t.miniTip(f[10001])}else{t.miniTip(e.msg||f[10010],{status:"error"})}})});a.textAuto2(280,function(e){i("span[node-type=caption_w]").html(e+"/140")});a.focusEnd()}});e.exports=c},x:function(e,t,n,r){var i=n("B");var s=function(e,t){this.keycode=e;this.buffer=t||100};var o=null;var u={A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,s0:96,s1:97,s2:98,s3:99,s4:100,s5:101,s6:102,s7:103,s8:104,s9:105,"*":106,"+":107,Enter:108,"-":109,".":110,"/":111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,BackSpace:8,Esc:27,Right:39,Left:37,Down:40,Up:38,"-_":189,".>":190,Spacebar:32,Tab:9,Clear:12,"Page Up":33,"Page Down":34,Enter:13,Insert:45,";:":186,Delete:46,"`~":192,"/?":191,"Num Lock":144,Control:17,Home:36,End:35,Shift:16,"[{":219,"}]":221,"|":220,"=+":187,",<":188,'’"':222,"Cape Lock":20,Alt:18};s.prototype={constructor:s,init:function(){var e=this;if(typeof e.keycode=="string")e.keycode=[e.keycode];i(document).bind("keydown",function(t){var n=t.target;if(n.tagName.toLowerCase()=="body"){var r=t.which;for(var s=0;s<e.keycode.length;s++){var a=e.keycode[s];if(u.hasOwnProperty(a)){var f=u[a];if(r!==f){break}else{if(s===e.keycode.length-1){if(o)clearTimeout(o);o=setTimeout(function(){i(e).trigger("keyfire")},e.buffer)}}}else{break}}}})}};e.exports=s},X:function(e,t,n,r){var i=n("b");var s=n("B");var o=n("s");i.Backbone=Backbone;var u=i.Backbone.Collection.extend({model:o.DetailDB,preloadPhoto:function(e,t){var n=this.model,r=n.get("PhotoDB"),i=n.get("AlbumDB"),s=n.get("$detail")["album_photo_ids"],o=[];for(var u=1;u<=t;u++){var a=s[e-u],f=s[e+u];if(a&&!n.get(a)){o.push(a)}if(f&&!n.get(f)){o.push(f)}}if(o.length){n.getMutiple(o.join(","),r["uid"],i["type"],function(e){for(var t in e){n.set(t,e[t])}})}},getPhotoDetail:function(e,t){var n=this,r=this.model,i=r.get("$info"),s=r.get("$detail"),o=r.get("PhotoDB"),u=$GLOBAL_DETAIL["album_info"],a=s["is_likes_page"],f=a?r.getLike(e):r.get(e),l=i["owner_uid"],c=s["type"];if(f){r.set("PhotoDB",f);r.successhandle(null,{result:true,data:f},t);if(!a){var h=r.findCacheIndex(e)}else{l=f["uid"]}r.addClick(e,l,f["type"],u&&u.type)}else{r.getPhotoDetail(e,l,c,u["album_id"],u["type"],function(n,i){r.set(e,i.data);r.set("PhotoDB",i.data);r.successhandle(n,i,t)})}},getAlbumDetail:function(e,t,n){var r=this.model,i=r.get("$info"),s=r.get("$detail"),o=i["owner_uid"],u=s["is_likes_page"],a=r.get("PhotoDB"),f=s["special"]=="0"?false:s["special"];if(f&&f=="smart_camera")t="32";if(u){o=a["like_uid"];r.getAlbumDetail(o,e,t,1,function(e,t){r.set("AlbumDB",t.data);r.successhandle(e,t,n)})}else{r.set("AlbumDB",$GLOBAL_DETAIL["album_info"]);r.successhandle(null,{result:true,data:$GLOBAL_DETAIL["album_info"]},n)}}});e.exports=new u},y:function(e,t,n,r){var i=n("B");var s=n("c");var o=n("w");var u=n("t");var a=n("e");var f=n("m");var l=function(e,t){var n=t||{},r=u.me,s;var l=n["uid"];var c=n["is_follow"];var h="";var p=new o({targetNode:i("div[node-type=user_box]"),initCssClass:"relation M_linka",place:"user_info"});if(!r)h=p.addFollow(c,l);var d=n["screen_name"]||$GLOBAL_INFO["owner_data"]["name"],v=a.baseURL+(n["uid"]||$GLOBAL_INFO["owner_uid"])+"/albums/",m=n["profile_image_url"]||$GLOBAL_INFO["owner_data"]["profile_image_url"],g=n.hasOwnProperty("verified")?n["verified"]:$GLOBAL_INFO["owner_data"]["verified"],y=f(g),b=function(){var e=n["gender"]||$GLOBAL_INFO["owner_data"]["gender"];if(n["uid"])s=n["uid"]==$GLOBAL_INFO["account_uid"];else s=r;return s?"我":e=="m"?"他":"她"}(),w=function(e){if(e===0){return d.cutString(12,"...")}else{return d.cutString(10,"...")}}(g),E='<div class="m_thumb m_thumb_b">						<a title="'+d+'" href="'+v+'"><img src="'+m+'"></a>					</div>				<div class="user_info">					<div class="user_name M_txtc" title="'+d+'">					<a title="'+d+'" class="M_linkd name" href="'+v+'">'+w+"</a>					  "+y+'<span node-type="follow_status" follow="'+c+'">'+h+'</span>				  </div>				  <div class="to_column">					  <a href="'+v+'">进入'+b+"的相册&raquo;</a>				  </div>				</div>";i(e).html(E)};e.exports=l},Y:function(e,t,n,r){var i=n("B");var s=n("b");var o=n("O");var u=n("e");var a=n("s");var f=n("D");var l=new f;var c=n("n").DetailTool;var h=a.DetailDB;var p=function(){this.lock=false;this.preload=true;this.islikepage=null;this.imgCache={};this._self=null;this.total=null;this.album_type=null;this._list=null;this._menu=null;this.uid=null;this.album_id=null;this.type=null;this._text=null;this.start=null;this.end=null;this.selectedIndex=0;this.currentId=null;this.showCount=9;this.middle=4;this.nextid=false;this.previd=false};p.prototype={init:function(e,t){var n;if(e&&typeof e=="object"){for(var r in e){this[r]=e[r]}}var s=this;this._self=i('<div class="m_thumbnail">'+'<div class="piclist"><ul></ul></div>'+'<div class="M_pages">'+'<a class="l M_ico M_icon17" title="上一页" _index="prev" href="#"></a><span class="count M_txtb"></span><a class="r M_ico M_icon18" title="下一页" _index="next" href="#"></a>'+"</div>"+"</div>");this._list=this._self.find("ul");this._menu=this._self.find("div.M_pages");this._text=this._menu.find("span.count");t.append(this._self);this.update();this._list.click(function(e){if(n)clearTimeout(n);n=setTimeout(function(){s.selected(e)},100);e.preventDefault()});this._menu.bind("click",function(e){var t=i(e.target);switch(t.attr("_index")){case"prev":c.isLogin(function(){s.previous(e)});break;case"next":c.isLogin(function(){s.next(e)});break;default:break}e.preventDefault()})},selected:function(e){var t=i(e.target).closest("li"),n=this;if(t.hasClass("empty"))return;if(n.isLikePage){window.location.href=t.attr("data-url");return}if(t.attr("data-id")){n.currentId=t.attr("data-id");n.album_id=t.attr("album_id");n.type=t.attr("type");n.uid=t.attr("uid");n.update()}},previous:function(e){var t=this._list.find("li:first").attr("data-id");if(t)this.update(t,"prev")},next:function(e){var t=this._list.find("li:last").attr("data-id");if(t)this.update(t,"next")},updateMutiple:function(e,t,n,r,i){var s=this,u,a=t.data.photos_list.concat(),f,c=[];for(u=0;u<a.length;u++){try{if(a[u]["photo_id"]==(e||s.currentId)){f=u}a[u]["square_pic"]=o(a[u],"square")}catch(h){a.splice(u,1)}}if(n=="next"){c=a.slice(f+1,a.length);c.length=s.showCount;if(!c[0]){s._list.find("li").show();s.lock=false;l.miniTip("已经没有下一页了噢",{autoClose:1e3});return}}else if(n=="prev"){c=a;c=c.slice(0,f);c.reverse();c.length=s.showCount;c.reverse();if(!c[s.showCount-1]){s._list.find("li").show();s.lock=false;l.miniTip("已经没有上一页了噢",{autoClose:1e3});return}}else{var p=a.slice(0,f),d=a[f],v=a.slice(f+1);if(p.length<4||v.length<4){if(p.length<4){c=p.concat([d],v);c.length=s.showCount}else{c=p.slice(-s.showCount+v.length+1).concat([d],v);c.length=s.showCount}}else{c.length=s.showCount;c[s.middle]=a[f];for(u=1;u<=s.middle;u++){c[s.middle+u]=a[f+u]?a[f+u]:undefined;c[s.middle-u]=a[f-u]?a[f-u]:undefined}}}s.html(c,n);s.CacheImg(c,n);s.updateOver(n,r)},updateLike:function(e,t,n,r,i){var s=this;if(t.result){var a,f=t.data.photos_list.concat(),c,p=[];for(a=0;a<f.length;a++){if(f[a]["target_id"]==(e||s.currentId)){c=a}f[a]["photo_id"]=f[a]["target_id"];f[a]["square_pic"]=o(f[a],"square")}if(n=="next"){p=f.slice(c+1,f.length);p.length=s.showCount;if(!p[0]){s._list.find("li").show();s.lock=false;l.miniTip("已经没有下一页了噢",{autoClose:1e3});return}}else if(n=="prev"){p=f;p=p.slice(0,c);p.reverse();p.length=s.showCount;p.reverse();if(!p[s.showCount-1]){s._list.find("li").show();s.lock=false;l.miniTip("已经没有上一页了哦",{autoClose:1e3});return}}else{var d=f.slice(0,c),v=f[c],m=f.slice(c+1);if(d.length<4||m.length<4){if(d.length<4){p=d.concat([v],m);p.length=s.showCount}else{p=d.slice(-s.showCount+m.length+1).concat([v],m);p.length=s.showCount}}else{p.length=s.showCount;p[s.middle]=f[c];for(a=1;a<=s.middle;a++){p[s.middle+a]=f[c+a]?f[c+a]:undefined;p[s.middle-a]=f[c-a]?f[c-a]:undefined}}}s.html(p,n);s.CacheImg(p,n);s.updateOver(n,r)}else{var g=h.get("DBlikelist");s.lock=false;if(g.length===1){window.location.href=u.baseURL+$GLOBAL_INFO["owner_uid"]+"/likes/photos";return}for(a=0;a<g.length;a++){if(g[a]===s.currentId){g.splice(a,1);if(g[a+1]){s.update(g[a+1],false,false,false)}else if(g[a-1]){s.update(g[a-1],false,false,false)}else{s.update(g[a],false,false,false)}break}}}},CacheImg:function(e,t){var n=this;if(!t){var r=[],i,s;for(var u=0;u<e.length;u++){if(e[u])r.push(e[u]);if(e[u]&&e[u]["photo_id"]==n.currentId){n.nextid=e[u+1]?e[u+1].hasOwnProperty("flag")&&e[u+1]["flag"]==1?e[u+1]["photo_id"]:e[u+1].hasOwnProperty("flag")&&e[u+1]["flag"]!=1?undefined:e[u+1]["photo_id"]:undefined;n.previd=e[u-1]?e[u-1].hasOwnProperty("flag")&&e[u-1]["flag"]==1?e[u-1]["photo_id"]:e[u-1].hasOwnProperty("flag")&&e[u-1]["flag"]!=1?undefined:e[u-1]["photo_id"]:undefined;if(n.initType=="like"&&!e[u+1]){n.nextid=n.nextid==undefined?false:n.nextid}else if(e[u+1]){if(n.initType=="like")n.nextflag=[e[u+1]["flag"],e[u+1]];else n.nextflag={flag:e[u+1]["flag"],photo_id:e[u+1]["photo_id"]}}if(n.initType=="like"&&!e[u-1]){n.previd=n.previd==undefined?false:n.previd}else if(e[u-1]){if(n.initType=="like")n.prevflag=[e[u-1]["flag"],e[u-1]];else n.prevflag={flag:e[u-1]["flag"],photo_id:e[u-1]["photo_id"]}}if(n.nextid){i=o(e[u+1],"mw690");if(i){n.loadPic(i)}}if(n.previd){i=o(e[u-1],"mw690");if(i){n.loadPic(i)}}}}n.firstid=r[0]["photo_id"];n.lastid=r[r.length-1]["photo_id"]}},loadPic:function(e){var t=this;if(t.imgCache[e])return;if(!e)return;var n=new Image;n.onload=function(){n.onload=null;n=null;t.imgCache[e]=true};n.src=e},updateOver:function(e,t){var n=this;if(!t&&n.callback&&typeof n.callback==="function"&&!e&&n.isInit){n.callback.apply(n,[n.currentId])}n.isInit=true;n.lock=false},getOnePic:function(e,t,n,r){var i=this,s;if(i.initType=="like")r["count"]=3;else r["count"]=1;if(e=="left")s=i.firstid;else s=i.lastid;r["photo_id"]=s;var o=i._list.find("li.cur").next("li"),u=i._list.find("li.cur").prev("li"),a=o.next("li").hasClass("empty"),f=u.prev("li").hasClass("empty");if(e=="right"){i.nextid=a?o.attr("data-id")===""?undefined:o.attr("data-id"):undefined;i.previd=f?u.attr("data-id")===""?undefined:u.attr("data-id"):undefined;i.getborder(r,e)}else if(e=="left"){i.nextid=a?o.attr("data-id"):undefined;i.previd=f?u.attr("data-id"):undefined;i.getborder(r,e)}else{i.getborder(r,e)}},getborder:function(e,t){var n=this,r;if(n.initType=="like"){r=h.findLikeCacheIndex(e["photo_id"]);if(r>=0){var i=h.get("DBlikelist");h.getByLikeId(i[r],n.uid,3,function(i,s){n.restLikeBox(e["photo_id"],s,t);h.addLikeCaches(r,n.uid,s.data.photos_list)})}}else{r=h.findCacheIndex(e["photo_id"]);if(r>=0){var s,o,u=h.get("DBlist");if(r<=3){o=r-1<0?0:r-1;s=u.slice(o,r+2)}else if(r>=u.length-3){o=u.length-3<0?0:u.length-3;s=u.slice(o,u.length)}else{o=r-1<0?0:r-1;s=u.slice(o,r+2)}h.getByIds(s,n.uid,$GLOBAL_DETAIL["album_info"]["type"],function(i){i=n.fixids(i);n.restMutipleBox(e["photo_id"],{data:{photos_list:i}},t);o=r-20<0?0:r-20;h.addCaches(u.slice(r-20,r+20),n.uid,n.album_type)})}}},findIndex:function(e,t){for(var n=0;n<e.length;n++){if(e[n]==t)return n}return-1},sortBox:function(e,t,n){var r=this,s=[];r._list.find("li").each(function(e){var t=i(this).attr("data-id"),n=i(this).attr("class");if(t===""&&n=="empty")t=undefined;s.push(t)});var a=r.findIndex(s,r.currentId);if(n=="left"&&e&&a==3||n=="right"&&t&&a==5){r.previd=s[a-1];r.nextid=s[a+1];var f;if(n=="left"&&e){f=u.baseURL+e["uid"]+(e["type"]==15?"talbum/detail/photo_id/":"/photos/detail/photo_id/")+e["photo_id"];e["caption_render"]=e["caption_render"]?e["caption_render"]:"";r._list.find("li:last").remove();if(e.hasOwnProperty("flag")&&e["flag"]==1||!e.hasOwnProperty("flag")){r._list.find("li:first").before('<li big-pic="'+o(e,"mw690")+'" type="'+e["type"]+'" uid="'+e["uid"]+'" album_id="'+e["album_id"]+'" data-id="'+e["photo_id"]+'" data-url="'+f+'"><a href="#"><img src="'+o(e,"square")+'" title="'+e["caption_render"]+'"></a></li>')}else{r._list.find("li:first").before('<li class="empty missing" like_uid="'+e["like_uid"]+'" data-id="'+e["photo_id"]+'" flag="'+e["flag"]+'" profile_image_url="'+e["profile_image_url"]+'" name="'+e["name"]+'"><span class="empty_con"><em></em></span></li>')}}else if(n=="right"&&t){f=u.baseURL+t["uid"]+(t["type"]==15?"talbum/detail/photo_id/":"/photos/detail/photo_id/")+t["photo_id"];t["caption_render"]=t["caption_render"]?t["caption_render"]:"";r._list.find("li:first").remove();if(t.hasOwnProperty("flag")&&t["flag"]==1||!t.hasOwnProperty("flag")){r._list.find("li:last").after('<li big-pic="'+o(t,"mw690")+'" type="'+t["type"]+'" uid="'+t["uid"]+'" album_id="'+t["album_id"]+'" data-id="'+t["photo_id"]+'" data-url="'+f+'"><a href="#"><img src="'+o(t,"square")+'" title="'+t["caption_render"]+'"></a></li>')}else{r._list.find("li:last").after('<li class="empty missing" like_uid="'+t["like_uid"]+'" data-id="'+t["photo_id"]+'" flag="'+t["flag"]+'" profile_image_url="'+t["profile_image_url"]+'" name="'+t["name"]+'"><span class="empty_con"><em></em></span></li>')}}r._list.find("li").removeClass("cur");r._list.find("li[data-id="+r.currentId+"]").addClass("cur")}else{r.sortBoxunload(n)}r.firstid=r._list.find("li").not('li.empty[data-id=""]').first().attr("data-id");r.lastid=r._list.find("li").not('li.empty[data-id=""]').last().attr("data-id");var l=r._list.find("li.cur").prev("li"),c=r._list.find("li.cur").next("li");if(l.length&&l.attr("big-pic")!==""){r.loadPic(l.attr("big-pic"))}if(r.initType=="like"){r.prevflag=[l.attr("flag"),{like_uid:l.attr("like_uid"),target_id:l.attr("data-id"),name:l.attr("name"),uid:l.attr("like_uid"),profile_image_url:l.attr("profile_image_url"),flag:l.attr("flag")}]}else{r.prevflag={flag:l.attr("flag"),photo_id:l.attr("data-id")}}if(c.length&&c.attr("big-pic")!==""){r.loadPic(c.attr("big-pic"))}if(r.initType=="like"){r.nextflag=[c.attr("flag"),{like_uid:c.attr("like_uid"),target_id:c.attr("data-id"),name:c.attr("name"),uid:c.attr("like_uid"),profile_image_url:c.attr("profile_image_url"),flag:c.attr("flag")}]}else{r.nextflag={flag:c.attr("flag"),photo_id:c.attr("data-id")}}if(!l.length&&r.initType=="like"){r.previd=r.previd==undefined?false:r.previd}else{if(l.hasClass("empty")&&l.attr("data-id")!=="")r.previd=undefined}if(!c.length&&r.initType=="like"){r.nextid=r.nextid==undefined?false:r.nextid}else{if(c.hasClass("empty")&&c.attr("data-id")!=="")r.nextid=undefined}r.lock=false},sortBoxunload:function(e){var t=this;if(e=="left"){t._list.find("li.cur").removeClass("cur").prev("li").addClass("cur")}else{t._list.find("li.cur").removeClass("cur").next("li").addClass("cur")}var n=t._list.find("li.cur").next("li"),r=t._list.find("li.cur").prev("li");t.nextid=n.hasClass("empty")?n.attr("data-id")===""?false:undefined:n.attr("data-id");t.previd=r.hasClass("empty")?r.attr("data-id")===""?false:undefined:r.attr("data-id")},restMutipleBox:function(e,t,n){var r=this,i=t.data.photos_list.concat(),s,o;if(i[1]&&i[1]["photo_id"]==e){s=i[0];o=i[2]}else{if(i[0]&&i[0]["photo_id"]==e){s=undefined;o=i[1]}else if(i[2]&&i[2]["photo_id"]==e){s=i[1];o=undefined}}if(s)s["photo_id"]=s["photo_id"];if(o)o["photo_id"]=o["photo_id"];r.sortBox(s,o,n)},restLikeBox:function(e,t,n){var r=this,i=t.data.photos_list.concat(),s,o;if(i[1]&&i[1]["target_id"]==e){s=i[0];o=i[2]}else{if(i[0]&&i[0]["target_id"]==e){s=undefined;o=i[1]}else if(i[2]&&i[2]["target_id"]==e){s=i[1];o=undefined}}if(s)s["photo_id"]=s["target_id"];if(o)o["photo_id"]=o["target_id"];r.sortBox(s,o,n)},restBox:function(e,t){var n=this,r=e.data.concat(),i=r[0][0],s=r[2][0];n.sortBox(i,s,t)},getAllPic:function(e,t,n,r){var i=this,s;if(i.initType=="like"){s=h.findLikeCacheIndex(e||i.currentId);if(s>=0){var o=h.get("DBlikelist");h.getByLikeId(o[s],i.uid,40,function(e,r){i.updateLike(o[s],r,t,n);h.addLikeCaches(s,i.uid,r.data.photos_list)})}}else{s=h.findCacheIndex(e||i.currentId);if(s>=0){var u,a,f=h.get("DBlist");if(s<=9){a=f.slice(0,s+10)}else if(s>=f.length-9){u=s-9<0?0:s-9;a=f.slice(u,f.length)}else{u=s-9<0?0:s-9;a=f.slice(u,s+10)}h.getByIds(a,i.uid,i.album_type,function(r){r=i.fixids(r);i.updateMutiple(e,{data:{total:f.length,photos_list:r}},t,n);u=s-20<0?0:s-20})}else{i.lock=false}}},fixids:function(e){for(var t=0;t<e.length;t++){if(e[t].addflag)e[t]["flag"]=10}return e},update:function(e,t,n,r){var i=this;if(i.lock)return;if(t===false)i.currentId=e;var s={photo_id:e||i.currentId,count:i.showCount+1,uid:i.uid};if(i.initType!="like"){s["album_id"]=i.album_id;s["type"]=i.type}if(t&&i.initType=="like"){s["count"]=i.showCount*2+1}i._list.addClass("M_loading");i.lock=true;if(r){i.getOnePic(r,t,n,s)}else{i._list.find("li").hide();i.getAllPic(e,t,n,s)}},html:function(e,t,n){var r=this,s="",a=this.album_type==45?' suda-uatrack="key=tblog_page_image&value=face_right_picture" ':"",f,l;i.each(e,function(e,t){var n=!!t?u.baseURL+t["uid"]+(t["type"]==15?"/talbum/detail/photo_id/":"/photos/detail/photo_id/")+t["photo_id"]+"/album_id/"+t["album_id"]:undefined;if(!t||t["flag"]&&t["flag"]!=1||t["flag"]===0){if(t)s+="<li "+a+' class="empty missing" like_uid="'+t["like_uid"]+'" data-id="'+(t&&t["photo_id"]||"")+'" flag="'+t["flag"]+'" name="'+t["name"]+'" profile_image_url="'+t["profile_image_url"]+'"><span class="empty_con"><em></em></span></li>';else s+='<li class="empty" data-id=""><span class="empty_con"><em></em></span></li>'}else if(t["photo_id"]==r.currentId){t["caption_render"]=t["caption_render"]?t["caption_render"]:t["caption"];s+="<li"+a+' class="cur" big-pic="'+o(t,"mw690")+'" type="'+t["type"]+'" uid="'+t["uid"]+'" album_id="'+t["album_id"]+'" data-id="'+t["photo_id"]+'" data-url="'+n+'"><a href="#"><img src="'+o(t,"square")+'" title="'+t["caption_render"]+'"/></a></li>'}else{t["caption_render"]=t["caption_render"]?t["caption_render"]:t["caption"];s+="<li"+a+' big-pic="'+o(t,"mw690")+'" type="'+t["type"]+'" uid="'+t["uid"]+'" album_id="'+t["album_id"]+'" data-id="'+t["photo_id"]+'" data-url="'+n+'"><a href="#"><img src="'+o(t,"square")+'" title="'+t["caption_render"]+'"/></a></li>'}});r._list.html(s);f=this._list.find("li:first").attr("data-id");l=this._list.find("li:last").attr("data-id");if(f){this._menu.find("[_index=prev]").attr("class","l M_ico M_icon17")}else{this._menu.find("[_index=prev]").attr("class","l M_ico M_icon17_dis")}if(l){this._menu.find("[_index=next]").attr("class","l M_ico M_icon18")}else{this._menu.find("[_index=next]").attr("class","l M_ico M_icon18_dis")}}};e.exports=p},z:function(e,t,n,r){var i=n("B");i.fn.rotate=function(e,t,n){var r=i(this).get(0),s,o;if(!n){r.angle=((r.angle||0)+e)%360}else{r.angle=e}if(r.angle>=0){s=Math.PI*r.angle/180}else{s=Math.PI*(360+r.angle)/180}var u=Math.cos(s);var a=Math.sin(s);var f=function(){var e=document.createElement("canvas");try{e.getContext("2d")}catch(t){return false}return true}();if(!f){o=document.createElement("img");o.src=r.src;if(Math.abs(r.angle)==90||Math.abs(r.angle)==270){if(t.height>690){o.style.height=690;o.style.width=690/t.height*t.width}else{o.style.height=t.height;o.style.width=t.width}}else{o.style.width=t.width;o.style.height=t.height}o.style.filter="progid:DXImageTransform.Microsoft.Matrix(M11="+u+",M12="+ -a+",M21="+a+",M22="+u+",SizingMethod='auto expand')"}else{o=document.createElement("canvas");if(!r.oImage){o.oImage=new Image;o.oImage.src=r.src}else{o.oImage=r.oImage}if(Math.abs(r.angle)==90||Math.abs(r.angle)==270){if(t.height>690){o.style.width=o.width=o.oImage.height=690;o.style.height=o.height=o.oImage.width=690/t.height*t.width}else{o.style.width=o.width=o.oImage.height=t.height;o.style.height=o.height=o.oImage.width=t.width}}else{o.style.width=o.width=o.oImage.width=t.width;o.style.height=o.height=o.oImage.height=t.height}var l=o.getContext("2d");l.save();if(s<=Math.PI/2){l.translate(a*o.oImage.height,0)}else if(s<=Math.PI){l.translate(o.width,-u*o.oImage.height)}else if(s<=1.5*Math.PI){l.translate(-u*o.oImage.width,o.height)}else{l.translate(0,-a*o.oImage.width)}l.rotate(s);l.drawImage(o.oImage,0,0,o.oImage.width,o.oImage.height);l.restore()}o.id=r.id;o.angle=r.angle;var c=r.parentNode;r.parentNode.replaceChild(o,r);if(i.browser.msie&&i.browser.version=="8.0"){c.style.height=o.offsetHeight+"px";c.style.width=o.offsetWidth+"px"}var h=i(r).attr("is_load");i(o).attr("is_load",h).css("display","block");return this}},Z:function(e,t,n,r){var i=n("B");var s=n("C");var o=n("b");var u=n("k");var a=n("e");var f=n("d");n("aa");n("i");(function(e){e.fn.zoning=function(t){var n='<img src="'+a.baseIMG+'common/loading.gif">';var r='<div class="iptname"><input style="width:230px;" class="M_inpt" value="" type="text" node-type="autoComplete_input" /></div><div class="frndlists"><p class="chkfrd M_txtb">或选择一个你的好友：</p><ul node-type="autoComplete"><li>'+n+'</li></ul></div><div class="confirm_send"><div class="confirm"><a class="M_btn_e" href="#" action-type="zoning_save"><span>确定</span></a><a class="M_btn_e" href="#" action-type="zoning_cancel"><span>取消</span></a></div><div class="sendwb M_txtb"><input type="checkbox" id="s_wb" class="M_checkbox"><label for="s_wb">同时发一条微博告诉好友</label></div></div>';r+='<input id="quanren_value" type="hidden">';var i='<div id="form-content" class="L_layer"><div class="bg">		  <table border="0" cellspacing="0" cellpadding="0">			<tbody>				<tr>				<td>					<div class="content" >					<div class="title">输入好友名字：</div>						<a href="#" class="close" action-type="zoning_cancel" title="关闭"></a>						<div class="L_quanren">'+r+"</div>					</div>				</td>				</tr>			</tbody>		</table>    </div></div>";var o=e.extend({instance:true,x1:0,y1:0,x2:100,y2:100,zIndex:999,persistent:true,formContent:i},t||{});e("input[type=radio][class=M_radio],a[action-type=retweets]").die();e("input[type=radio][class=M_radio]").live("click",function(){e("input[node-type=autoComplete_input]").val(e(this).parent().text())});return this.each(function(){e(this).imgAreaSelect(o);if(!o.remove){e(this).data("autoComplete",function(){u.prototype.onBlurHandler=function(){};u.prototype.selectItem=function(e){var t=this.options,n=t.beforeItemSelected,r=t.afterItemSelected,i=true;typeof n==="function"&&(i=n.call(this,e));if(i===false){return}this.selectedIndex=-1;typeof r==="function"&&r()};u.prototype.inputCheck=function(){var e=this.inputEle.value;this.createList(e)};u.prototype.createList=function(e){var t=this.options,n=t.createListFun;if(n&&typeof n=="function"){n.call(this,e,function(e){this.container.innerHTML=e;this.attachEvents();this.selectedIndex=-1})}};var t=new u({inputEle:e("input[node-type=autoComplete_input]")[0],itemTagName:"li",highlightClassName:"cur",normalClassName:"M_radio",position:false,initCallback:function(e){e.createList("")},createListFun:function(t,n){var r=this;if(!f.isLogin()){window.location.reload()}s({url:a.baseURL+"sina/aj_searchat",type:"get",dataType:"json",data:{key:t},success:function(t){var i="";if(t.result&&t.data.data){e.each(t.data.data,function(e,t){i+='<li><label><input class="M_radio" type="radio" value="'+t["uid"]+'" name="quanren_uid">'+t["nickname"]+"</label></li>"})}if(i==="")i="";if(n&&typeof n=="function"){n.apply(r,[i])}}})},container:e("ul[node-type=autoComplete]")[0]});return t}());e(this).data("autoComplete").showContainer()}})};e.fn.zoningInitDiv=function(t,n){function v(){clearTimeout(d);e(".L_qr_person").css({border:"0px"});e(".L_qr_person").find(".inner").css("visibility","hidden");e(this).css({border:"1px solid #250203"});e(this).find(".inner").css("visibility","visible")}function m(){var t=this;d=setTimeout(function(){e(".L_qr_person").css({border:"0px"});e(".L_qr_person").find(".inner").css("visibility","hidden");e(t).css({border:"0px"});e(t).find(".inner").css("visibility","hidden")},100)}var r=t,i=e(this).width(),s=e(this).height(),o="",u="",f=r?r.length:0,l=f,c=[];if(f){while(f--){var h=r[f]["version"],p;if(n==15){if(h=="0"&&i>440){p=i/440;r[f].width=r[f].width*p;r[f].height=r[f].height*p;r[f].top=r[f].top*p;r[f].left=r[f].left*p}}else{if(h=="0"&&i>600){p=i/600;r[f].width=r[f].width*p;r[f].height=r[f].height*p;r[f].top=r[f].top*p;r[f].left=r[f].left*p}}r[f]["version"]=1;o+='<div data-uid="'+r[f].related_uid+'" id="person'+r[f].id+'" title="'+r[f].related_name+'"  style="background:url('+a.baseIMG+"common/btn.png"+") no-repeat -99999px -99999px;border:0px;top:"+r[f].top+"px;left:"+r[f].left+"px;position:absolute;z-index:"+r[f].zindex+';cursor:default;" class="L_qr_person">'+'<div style="width:'+r[f].width+"px;height:"+r[f].height+'px;visibility:hidden;" class="inner">'+'<div class="personName">'+'<span class="name M_linkb">'+'<a action-type="zoning_click" href="'+a.baseURL+r[f].related_uid+'/photos" target="_blank" title="'+r[f].related_name+'">'+r[f].related_name.cutString(10,"...").toString()+"</a>"+"</span>"+"</div>"+"</div></div>"}e(this).parent().css({zIndex:0,margin:"auto"}).append(e(o))}e(".personName").each(function(){var t=e(this);t.css({left:function(){var e=t.parent().width(),n=t.width();return(e-n)/2}()})});var d;e(".L_qr_person").live("mouseover",v).live("mouseout",m);return this}})(i)},aa:function(e,t,n,r){var i=n("B");(function(e){function s(){return e("<div/>")}var t=Math.abs,n=Math.max,r=Math.min,i=Math.round;e.imgAreaSelect=function(o,u){function Y(e){return e+y.left-S.left}function Z(e){return e+y.top-S.top}function et(e){return e-y.left+S.left}function tt(e){return e-y.top+S.top}function nt(e){return e.pageX-S.left}function rt(e){return e.pageY-S.top}function it(e){var t=e||k,n=e||L;return{x1:i(R.x1*t),y1:i(R.y1*n),x2:i(R.x2*t),y2:i(R.y2*n),width:i(R.x2*t)-i(R.x1*t),height:i(R.y2*n)-i(R.y1*n)}}function st(e,t,n,r,s){var o=s||k,u=s||L;R={x1:i(e/o||0),y1:i(t/u||0),x2:i(n/o||0),y2:i(r/u||0)};R.width=R.x2-R.x1;R.height=R.y2-R.y1}function ot(){if(!a.width())return;y={left:i(a.offset().left),top:i(a.offset().top)};b=a.innerWidth();w=a.innerHeight();y.top+=a.outerHeight()-w>>1;y.left+=a.outerWidth()-b>>1;M=u.minWidth||0;_=u.minHeight||0;D=r(u.maxWidth||1<<24,b);P=r(u.maxHeight||1<<24,w);if(e().jquery=="1.3.2"&&T=="fixed"&&!U["getBoundingClientRect"]){y.top+=n(document.body.scrollTop,U.scrollTop);y.left+=n(document.body.scrollLeft,U.scrollLeft)}S=e.inArray(E.css("position"),["absolute","relative"])+1?{left:i(E.offset().left)-E.scrollLeft(),top:i(E.offset().top)-E.scrollTop()}:T=="fixed"?{left:e(document).scrollLeft(),top:e(document).scrollTop()}:{left:0,top:0};m=Y(0);g=Z(0);if(R.x2>b||R.y2>w)dt()}function ut(t){if(!B)return;l.css({left:Y(R.x1),top:Z(R.y1)}).add(c).width(J=R.width).height(K=R.height);c.add(h).add(d).css({left:0,top:0});h.width(n(J-h.outerWidth()+h.innerWidth(),0)).height(n(K-h.outerHeight()+h.innerHeight(),0));e("#form-content").css({left:R.width+Y(R.x1),top:Z(R.y1)});e("#quanren_value").val("width="+R.width+"&height="+R.height+"&left="+R.x1+"&top="+R.y1+"&zindex="+parseInt(2600/(R.width+R.height),10));e(p[0]).css({left:m,top:g,width:R.x1,height:w});e(p[1]).css({left:m+R.x1,top:g,width:J,height:R.y1});e(p[2]).css({left:m+R.x2,top:g,width:b-R.x2,height:w});e(p[3]).css({left:m+R.x1,top:g+R.y2,width:J,height:w-R.y2});J-=d.outerWidth();K-=d.outerHeight();switch(d.length){case 8:e(d[4]).css({left:J>>1});e(d[5]).css({left:J,top:K>>1});e(d[6]).css({left:J>>1,top:K});e(d[7]).css({top:K>>1});break;case 4:d.slice(1,3).css({left:J});d.slice(2,4).css({top:K});break;default:break}if(t!==false){if(e.imgAreaSelect.keyPress!=xt)e(document).unbind(e.imgAreaSelect.keyPress,e.imgAreaSelect.onKeyPress);if(u.keys)e(document)[e.imgAreaSelect.keyPress](e.imgAreaSelect.onKeyPress=xt)}if(e.browser.msie&&h.outerWidth()-h.innerWidth()==2){h.css("margin",0);setTimeout(function(){h.css("margin","auto")},0)}}function at(e){ot();ut(e);j=Y(R.x1);F=Z(R.y1);I=Y(R.x2);q=Z(R.y2)}function ft(e,t){u.fadeSpeed?e.fadeOut(u.fadeSpeed,t):e.hide()}function lt(e){var t=et(nt(e))-R.x1,n=tt(rt(e))-R.y1;if(!Q){ot();Q=true;l.one("mouseout",function(){Q=false})}O="";if(u.resizable){if(n<=u.resizeMargin)O="n";else if(n>=R.height-u.resizeMargin)O="s";if(t<=u.resizeMargin)O+="w";else if(t>=R.width-u.resizeMargin)O+="e"}l.css("cursor",O?O+"-resize":u.movable?"move":"");if(v)v.toggle()}function ct(t){e("body").css("cursor","");if(u.autoHide||R.width*R.height===0)ft(l.add(p),function(){e(this).hide()});e(document).unbind("mousemove",vt);l.mousemove(lt);u.onSelectEnd(o,it())}function ht(t){if(t.which!=1)return false;ot();if(O){e("body").css("cursor",O+"-resize");j=Y(R[/w/.test(O)?"x2":"x1"]);F=Z(R[/n/.test(O)?"y2":"y1"]);e(document).mousemove(vt).one("mouseup",ct);l.unbind("mousemove",lt)}else if(u.movable){N=m+R.x1-nt(t);C=g+R.y1-rt(t);l.unbind("mousemove",lt);e(document).mousemove(gt).one("mouseup",function(){u.onSelectEnd(o,it());e(document).unbind("mousemove",gt);l.mousemove(lt);e("#moveDis").remove()})}else a.mousedown(t);return false}function pt(e){if(H){if(e){I=n(m,r(m+b,j+t(q-F)*H*(I>j||-1)));q=i(n(g,r(g+w,F+t(I-j)/H*(q>F||-1))));I=i(I)}else{q=n(g,r(g+w,F+t(I-j)/H*(q>F||-1)));I=i(n(m,r(m+b,j+t(q-F)*H*(I>j||-1))));q=i(q)}}}function dt(){j=r(j,m+b);F=r(F,g+w);e("#moveDis").remove();if(t(I-j)<M){I=j-M*(I<j||-1);if(I<m)j=m+M;else if(I>m+b)j=m+b-M}if(t(q-F)<_){q=F-_*(q<F||-1);if(q<g)F=g+_;else if(q>g+w)F=g+w-_}I=n(m,r(I,m+b));q=n(g,r(q,g+w));pt(t(I-j)<t(q-F)*H);if(t(I-j)>D){I=j-D*(I<j||-1);pt()}if(t(q-F)>P){q=F-P*(q<F||-1);pt(true)}R={x1:et(r(j,I)),x2:et(n(j,I)),y1:tt(r(F,q)),y2:tt(n(F,q)),width:t(I-j),height:t(q-F)};ut();u.onSelectChange(o,it())}function vt(e){I=O===""||/w|e/.test(O)||H?nt(e):Y(R.x2);q=O===""||/n|s/.test(O)||H?rt(e):Z(R.y2);dt();return false}function mt(t,n){I=(j=t)+R.width;q=(F=n)+R.height;e.extend(R,{x1:et(j),y1:tt(F),x2:et(I),y2:tt(q)});ut();u.onSelectChange(o,it())}function gt(e){j=n(m,r(N+nt(e),m+b-R.width));F=n(g,r(C+rt(e),g+w-R.height));mt(j,F);e.preventDefault();return false}function yt(){ot();I=j;q=F;dt();O="";if(p.is(":not(:visible)"))l.add(p).hide().fadeIn(u.fadeSpeed||0);B=true;e(document).unbind("mouseup",bt).mousemove(vt).one("mouseup",ct);l.unbind("mousemove",lt);u.onSelectStart(o,it())}function bt(){e(document).unbind("mousemove",yt);ft(l.add(p));st(et(j),tt(F),et(j),tt(F));u.onSelectChange(o,it());u.onSelectEnd(o,it())}function wt(t){if(t.which!=1||p.is(":animated"))return false;ot();N=j=nt(t);C=F=rt(t);e(document).one("mousemove",yt).one("mouseup",bt);return false}function Et(){at(false)}function St(){f=true;Nt(u=e.extend({classPrefix:"select",classOutPrefix:"outer",parent:".L_resize",movable:true,resizable:true,resizeMargin:10,zIndex:20,onInit:function(){},onSelectStart:function(){},onSelectChange:function(){},onSelectEnd:function(){}},u));l.add(p).css({visibility:""});if(u.show){B=true;ot();ut();l.add(p).hide().fadeIn(u.fadeSpeed||0)}setTimeout(function(){u.onInit(o,it())},0)}function Tt(e,t){for(option in t){if(u[option]!==undefined){e.css(t[option],u[option])}}}function Nt(t){if(t.parent){(E=e(t.parent)).append(l.add(p).add(G))}e.extend(u,t);ot();if(t.handles!==null){d.remove();d=e([]);n=t.handles?t.handles=="corners"?4:8:0;while(n>0){n--;d=d.add(s())}d.addClass(u.classPrefix+"-handle").css({position:"absolute",fontSize:0,zIndex:x+1||1});if(!parseInt(d.css("width"),10)>=0)d.width(5).height(5);if(u.borderWidth){d.css({borderWidth:u.borderWidth,borderStyle:"solid"})}Tt(d,{borderColor1:"border-color",borderColor2:"background-color",borderOpacity:"opacity"})}k=u.imageWidth/b||1;L=u.imageHeight/w||1;if(t.x1!==null){st(t.x1,t.y1,t.x2,t.y2);t.show=!t.hide}if(t.keys)u.keys=e.extend({shift:1,ctrl:"resize"},t.keys);p.addClass(u.classOutPrefix+"-area");c.addClass(u.classPrefix+"-selection");var n=0;while(n<4){n++;e(h[n-1]).addClass(u.classPrefix+" border"+n)}Tt(c,{selectionColor:"background-color",selectionOpacity:"opacity"});Tt(h,{borderOpacity:"opacity",borderWidth:"border-width"});Tt(p,{outerColor:"background-color",outerOpacity:"opacity"});if(u.borderColor1)e(h[0]).css({borderStyle:"solid",borderColor:u.borderColor1});if(u.borderColor2)e(h[1]).css({borderStyle:"dashed",borderColor:u.borderColor2});l.append(c.add(h).add(v).add(d));if(e.browser.msie){var r=p.css("filter").match(/opacity=([0-9]+)/),i=h.css("filter").match(/opacity=([0-9]+)/);if(r)p.css("opacity",r[1]/100);if(i)h.css("opacity",i[1]/100)}e("#moveDis").css("opacity","1");if(t.hide)ft(l.add(p));else if(t.show&&f){B=true;l.add(p).fadeIn(u.fadeSpeed||0);at()}H=(W=(u.aspectRatio||"").split(/:/))[0]/W[1];a.add(p).unbind("mousedown",wt);if(u.disable||u.enable===false){l.unbind("mousemove",lt).unbind("mousedown",ht);e(window).unbind("resize",Et)}else{if(u.enable||u.disable===false){if(u.resizable||u.movable)l.mousemove(lt).mousedown(ht);e(window).resize(Et)}if(!u.persistent)a.add(p).mousedown(wt)}u.enable=u.disable=undefined}var a=e(o),f,l=s(),c=s(),h=s().add(s()).add(s()).add(s()).add(e('<div id="moveDis" style="margin:1px;"><span style="width:64px;height:48;line-height:24px;font-size:12px;display:block;padding:25px 17px;background:#000;color:#fff;opacity:0.8;filter:alpha(opacity=80);overflow:hidden;">移动该框至要圈的区域</span></div>')),p=s().add(s()).add(s()).add(s()),d=e([]),v,m,g,y={left:0,top:0},b,w,E,S={left:0,top:0},x=0,T="absolute",N,C,k,L,A=10,O,M,_,D,P,H,B,j,F,I,q,R={x1:0,y1:0,x2:0,y2:0,width:0,height:0},U=document.documentElement,z,W,X,V,J,K,Q,G=null;if(u.formContent){G=u.formContent}var xt=function(e){var t=u.keys,i,s,o=e.keyCode;i=!isNaN(t.alt)&&(e.altKey||e.originalEvent.altKey)?t.alt:!isNaN(t.ctrl)&&e.ctrlKey?t.ctrl:!isNaN(t.shift)&&e.shiftKey?t.shift:!isNaN(t.arrows)?t.arrows:10;if(t.arrows=="resize"||t.shift=="resize"&&e.shiftKey||t.ctrl=="resize"&&e.ctrlKey||t.alt=="resize"&&(e.altKey||e.originalEvent.altKey)){switch(o){case 37:i=-i;break;case 39:s=n(j,I);j=r(j,I);I=n(s+i,j);pt();break;case 38:i=-i;break;case 40:s=n(F,q);F=r(F,q);q=n(s+i,F);pt(true);break;default:return false}dt()}else{j=r(j,I);F=r(F,q);switch(o){case 37:mt(n(j-i,m),F);break;case 38:mt(j,n(F-i,g));break;case 39:mt(j+r(i,b-et(I)),F);break;case 40:mt(j,F+r(i,w-tt(q)));break;default:return false}}return false};this.remove=function(){Nt({disable:true});if(u.parent!=="body"){e(u.parent).remove()}else{l.add(p).add(G).remove()}};this.getOptions=function(){return u};this.setOptions=Nt;this.getSelection=it;this.setSelection=st;this.update=at;z=a;while(z.length){x=n(x,!isNaN(z.css("z-index"))?z.css("z-index"):x);if(z.css("position")=="fixed")T="fixed";z=z.parent(":not(body)")}x=u.zIndex||x;if(e.browser.msie)a.attr("unselectable","on");e.imgAreaSelect.keyPress=e.browser.msie||e.browser.safari?"keydown":"keypress";if(e.browser.opera)v=s().css({width:"100%",height:"100%",position:"absolute",zIndex:x+2||2});l.add(p).css({visibility:"hidden",position:T,overflow:"hidden",zIndex:x||"0"});l.css({zIndex:x+2||2});c.add(h).css({position:"absolute",fontSize:0});o.complete||o.readyState=="complete"||!a.is("img")?St():a.one("load",St);if(e.browser.msie&&e.browser.version>=9)o.src=o.src};e.fn.imgAreaSelect=function(t){t=t||{};if(e(this).data){this.each(function(){if(e(this).data("imgAreaSelect")||t.remove){if(t.remove){try{e(this).data("imgAreaSelect").remove();e(this).removeData("imgAreaSelect")}catch(n){}if(e(this).data("autoComplete")){e(this).data("autoComplete").destory();e(this).removeData("autoComplete")}}else e(this).data("imgAreaSelect").setOptions(t)}else if(!t.remove){if(t.enable===undefined&&t.disable===undefined)t.enable=true;e(this).data("imgAreaSelect",new e.imgAreaSelect(this,t))}});if(t.instance)return e(this).data("imgAreaSelect")}return this}})(i)},aA:function(e,t,n,r){var i=n("B");n("i");var s=function(){this._self=null;this._selected=null;this._list=null;this._selectArrow=null;this._activeOption=null;this._input=null;this._bodyinput=null;this._selectedIndex=0;this._adapter=null;this._locked=false;this._lockedEvent=null;this.maxHeight=400;this.callback=null};s.prototype={init:function(e,t,n,r,i,s,o,u,a,f){if(!e||!t)return;this._adapter=t;this.fn=s;this.callback=a;this._selectedIndex=n||0;this._lockedEvent=o;this.maxHeight=u||this.maxHeight;this._available=true;this.defaultText=f||"";var l=this._self=$('<div class="m_smltSelect">'+'<div class="select"><span class="name M_txtb"></span><span class="chose_btn M_ico"></span></div>'+'<div class="items M_linkb" style="display:none"></div>'+"</div>");this._selected=l.find("span.name");this._list=l.find("div.items");this._list.css("zIndex",i||0);this._selectArrow=l.find("span.M_ico");this.create();e.append(l);var c=t[this._selectedIndex]?t[this._selectedIndex].id:"";if(this._selectedIndex==-1)c=this._selectedIndex;this._input=$('<input type="hidden" name="'+(r||"select")+'" value="'+c+'"/>');this._bodyinput=$('<input type="hidden" id="select_id" value="'+c+'"/>');$("#select_id").remove();e.append(this._input);$("body").append(this._bodyinput);var h=this;this._list.click(function(e){var t=e.target||e.srcElement;var n=t.getAttribute("_index");while(!n&&(t=t.parentNode)){n=t.getAttribute("_index")}h.onSelected(e,n);return false});this._selectArrow.click(function(e){e.preventDefault();if(!h._available)return;if(!h._locked){if(h._list.css("display")!="none"){h._list.hide()}else{if(h._list.children().length){if(h._list.height()>h.maxHeight)h._list.css("height",h.maxHeight);h._list.show()}}}else{if(h._lockedEvent&&typeof h._lockedEvent==="function"){h._lockedEvent.call(h,e)}}});$(document).click(function(e){var t=e.target;if(h._selectArrow[0]!==t&&!$.contains(h._self[0],t)){h._list.hide()}})},create:function(){var e=this._adapter;this._locked=true;if($.isArray(e)&&e.length){var t=null,n,r="",i="",s="",o=false,u=e.length;for(var a=0;a<u;a++){t=e[a];r=t.name;i="";if(this._selectedIndex==a){n=t;this._selected.html(r);if(typeof this.fn==="function"){this.fn.apply(this,[t])}}else{s+="<a ";if(t["disable"]){s+='class="M_linkf M_dis" '}else{this._locked=false}s+='href="#" _index="'+a+'">'+r+"</a>"}}this._list.html(s);function f(e){if(!e)return"";var t=$("<div>").html(e);return t.text()}if(n)this._selected.attr("title",f(n["title"]));this._list.find("a").each(function(){var t=$(this).attr("_index");if(t&&e[t])$(this).attr("title",f(e[t]["title"]))})}else{this._selected.text("")}if(this._selectedIndex==-1){this._selected.attr("title",f(this.defaultText)).html(this.defaultText)}},onSelected:function(e,t){var n=this;if(t==undefined){t=$(e.target).attr("_index")}t=parseInt(t,10);var r=this._adapter[t];if(!r||r.disable)return false;this._selectedIndex=t;this._input.val(r.id);this._bodyinput.val(r.id);this.create();this._list.hide();if(n.callback)n.callback(r.id);return false},appendData:function(e,t){this._adapter.push(e);if(t)this._selectedIndex=this._adapter.length-1;this.onSelected(null,this._selectedIndex);this._locked=false},setAvailable:function(e){this._available=e;if(e){this._self.removeClass("M_dis")}else{this._self.addClass("M_dis")}}};(function(e){e.prototype.select=function(t){e(this).each(function(){(new s).init(e(this),t.adapter,t.selectedIndex,t.inputName,t.zIndex,t.fn,t.lockedEvent,t.maxHeight,t.callback)});return this}})(i);e.exports=s}});