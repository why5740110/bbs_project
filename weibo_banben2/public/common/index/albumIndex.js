(function(f){var c={};var i=function(k){return c[k];};var r=function(k){if(!c[k]){var m={exports:{}};try{f[k].call(m.exports,m,m.exports,r,i)}catch(e){};c[k]=m.exports;}return c[k];};return r('a');})({a:function(e,t,n,r){var i=n("A");var s=n("b");var o=n("B");var u=n("c");var a=n("C");var f=n("d");var l=n("D");var c=n("e");var h=n("f");var p=n("l");var d=n("M");var v=n("n");var m=n("g");var g=n("o");var y=n("r");n("s");n("S")();var b=l.baseURL;var w=l.baseIMG;var E={1:["所有人",""],2:["仅自己","M_icon39"],3:["相互关注","M_icon39"],4:["相互关注","M_icon39"],5:["回答问题","M_icon39"],6:["私密微博配图","M_icon39"],7:["密友","M_icon39"]};var S=function(e,t){var n,r={1:["所有人可见",""],2:["仅自己可见","M_icon39"],3:["相互关注可见","M_icon39"],4:["相互关注可见","M_icon39"],5:["回答问题可见","M_icon39"],6:["私密微博配图","M_icon39"],7:["密友可见","M_icon39"],11:{43:["会员可见","M_icon39"],44:["付费可见","M_icon39"]}};var n=r[e];if(n){if(n instanceof Array){return n}if(n[t]){return n[t]}}return r[1]};var x=$CONFIG.account_uid==$CONFIG.owner_uid;var T=$CONFIG.owner_uid;var N={pagination:null,page:1,pSize:20,count:null,albumList:null,albumPage:null,albumInfo:null,albumData:{},init:function(){this.albumList=i.sizzle("div[node-type=album_list]")[0];this.albumPage=i.sizzle("div[node-type=album_page]")[0];this.albumInfo=i.sizzle("div[node-type=album_info]")[0];this.getAllAlbum(T,this.showAlbum);this.initAction();this.isAnswerQuestion()},initAction:function(){var e=i.delegatedEvent(this.albumList);e.add("album_del","click",this.delAlbum);e.add("album_edit","click",this.editAlbum);e.add("answer","click",this.answer);var t=i.delegatedEvent(N.albumInfo);t.add("album_add","click",N.addAlbum)},answer:function(e){var t=N;var n=v(e.el,{expr:"li"})[0];var r=i.queryToJson(n.getAttribute("action-data"));var s=t.albumData[r.aid];i.preventDefault();if(s.property&&s.property==5){y({albumId:r.aid,question:s.question,uid:s.uid})}i.preventDefault()},isAnswerQuestion:function(){if($GLOBAL_DETAIL&&$GLOBAL_DETAIL.answer_question.album_id){var e=$GLOBAL_DETAIL.answer_question;y({albumId:e.album_id,question:e.question,uid:T,return_url:e.return_url})}},editAlbum:function(e){i.preventDefault();var t=e.data.album_id;var n=N.albumData[t];var r={};if(n){r.name=n.caption;r.description=n.description;r.answer=n.answer;r.question=n.question;r.property=n.property;r.price=n.price;r.prices=n.prices;r.auth=n.property;r.album_id=n.album_id;r.type=n.type}r.afterEvent=function(t){var n=v(e.el,{expr:"li"})[0];i.insertHTML(n,N.createAlbum(t),"BeforeBegin");i.removeNode(n)};g(r,true)},addAlbum:function(e){g({title:d["11004"],afterEvent:function(e){location.href=b+T+"/albums/detail/album_id/"+e.album_id}},false);i.preventDefault()},getAllAlbum:function(e,t){var n=this,r;s({url:b+"albums/get_all",args:{uid:e,page:this.page,count:this.pSize},onComplete:function(e){if(e&&e.data){n.count=e.data.total;n.createAlbumInfo(n.count);if(!n.pagination){n.pagination=new o({total:n.count,pageIndex:n.page,pageSize:n.pSize,node:n.albumPage,callback:n.loadAlbums,scope:n});n.pagination.initUI()}if(t&&typeof t==="function"){t.call(n,e.data.album_list);n.pagination.updateUI(n.count)}}}})},createAlbum:function(e){var t=[],n,r,i,s,o,u,a,f,l,c,h,p,d="",v;if(e){n=e;h=n.album_id;albumType=n.type;u=n.count;s=S(e.property,e.type);r=!!e.isPay;a=s[1];c=parseInt(n.type,10);f=parseInt(n.status,10);v=n.caption||"";this.setAlbumData(h,n);p=n.cover_pic;if(!p){if(parseInt(n.property,10)==5){d=n.answer;if(typeof d=="boolean"&&!d){l='action-type="answer"';p=w+"common/status_3.png"}else{if(!p)p=w+"common/status_0.png"}}else if(c==3){p=w+"common/status_ilustri.png"}else if(c==18){p=w+"common/default_head.png"}else{p=w+"common/status_0.png"}}if(c==3){i=b+T+"/talbum/index"}else{i=b+T+"/albums/detail/album_id/"+h+(albumType==45?"?prel=p5_face":"")}t.push('<li action-data="aid='+h+"&property="+n.property+'">');t.push('<div class="m_fav_album">');t.push('<div class="m_cover m_cover_c">');t.push('<div class="img_wrap">');if(!x&&!r&&(c==43||c==44)){t.push('<div class="pic_mask">');t.push('<div class="mask_bg"></div>');t.push('<a href="'+i+'" class="act_btn">'+(c==43?"开会员":"购 买")+"</a>");t.push("</div>")}t.push('<a title="'+v+'" href="'+i+'" '+l+">");if(c==43||c==44){t.push('<span class="'+(c==43?"photo_vippic":"photo_paypic")+'"></span>')}t.push('<img width="150" height="150" class="img" src="'+p+'">'+(parseInt(n.property,10)==1||parseInt(n.property,10)==11||x?'<span class="count">'+u.photos+" 张</span>":""));t.push("</a></div>");t.push("</div>");t.push('<div class="detail">');t.push('<p class="title">');t.push('<a class="M_linkb" href="'+i+'" '+l+'><strong title="'+v+'">'+v.cutString(22,"...")+"</strong></a>");t.push("</p>");t.push('<p class="status M_txtb">');t.push('<span title="'+s[0]+'" class="M_ico '+a+'"></span>');t.push('<span class="M_txtb time">更新于'+n.updated_at+"</span>");t.push("</p>");t.push('<p class="edit M_txtd">');if(x&&c!=3&&c!=18&&c!=45){t.push('<a href="#" action-type="album_edit" action-data="album_id='+h+'">编辑</a>');if(c!=31){t.push('<span class="M_vline"></span>');t.push('<a href="#" action-type="album_del" action-data="album_id='+h+'">删除</a>')}}t.push("</p>");t.push("</div>");t.push("</li>")}return t.join("")},showAlbum:function(e){var t=[];if(e){t.push('<ul class="albumlists clearfix">');for(var n=0,r=e.length;n<r;n++){t.push(this.createAlbum(e[n]))}t.push("</ul>")}this.albumList.innerHTML=t.join("")},loadAlbums:function(e){if(!f.isLogin()){location.reload();return}this.page=e.page;u({page:this.page});this.getAllAlbum(T,this.showAlbum);a(this.albumList)},setAlbumData:function(e,t){if(e){this.albumData[e]=t}},createAlbumInfo:function(e){var t="";if(e>0)t+='<div class="tit M_txta">专辑列表<span class="M_txtb">(共'+e+"个)</span></div>";if(x){t+='<div class="album_count M_txta"><span class="creat"><a class="M_btn_c" href="#" action-type="album_add">创建专辑</a></span><span class="sequence"><a class="M_btn_c" href="'+b+T+"/albums/album_sort"+'">专辑排序</a></span></div>'}this.albumInfo.innerHTML=t},delAlbum:function(e){function u(e){var n,r;if(e){n=e.parentNode;i.removeNode(e);r=n.children;t.createAlbumInfo(t.count);if(r.length==0){if(t.pagination.pageCount==t.page&&t.page>1){t.pagination.pageIndex=--t.page}t.loadPhotos({page:t.page})}}}var t=N;var n=v(e.el,{expr:"li"})[0];var r=d["11006"],o="error";i.preventDefault(e.evt);p(d["11002"],{ok:function(){if(!f.isLogin()){location.reload();return}s({method:"post",url:b+"albums/trash",args:e.data,onComplete:function(e){if(e&&e.data){r=d["11003"];o="success";u(n)}m(e.msg||r,{status:o,autoClose:1500})}})}})}};N.init();c(i.E("nav_normal"));h(i.E("user_info"))},A:function(e,t,n,r){e.exports=window.STK.getPKG("theia")},b:function(e,t,n,r){var i=n("A");var s=i.funcEmpty;e.exports=function(e){var t={};var n=[];var r=null;var o=false;var u=i.parseParam({url:"",method:"get",responseType:"json",args:{},timeout:30*1e3,onTraning:i.funcEmpty,isEncode:true},e);u.onComplete=function(t){o=false;if(typeof e.onComplete==="function"){e.onComplete(t,u.args)}};u.onFail=function(t){o=false;if(typeof e.onFail==="function"){try{s(u);e.onFail(t,u.args)}catch(n){}}};u.onTimeout=function(t){o=false;try{s(u);if(typeof e.onTimeout==="function"){e.onTimeout(t)}}catch(n){}};if(o&&u.needLock)return;o=true;i.ajax(u)}},B:function(e,t,n,r){var i=n("A");var s=function(e){var t=this;var n=i.C("div");n.className="m_pages";this.total=e.total||0;this.pageSize=e.pageSize||2;this.pageCount=this.total%this.pageSize===0?~~(this.total/this.pageSize):~~(this.total/this.pageSize)+1;this.updateCount=function(){t.pageCount=t.total%t.pageSize===0?~~(t.total/t.pageSize):~~(t.total/t.pageSize)+1};this.pageIndex=e.pageIndex||1;this.maxShowNum=e.maxShowNum==undefined?10:e.maxShowNum;this.leftcallback=e.leftcallback||function(){};this.rightcallback=e.rightcallback||function(){};this.ui=e.node||n;this.callback=e.callback||function(){};this.scope=e.scope||this;this.uiMode=1;var r=i.delegatedEvent(this.ui);this.getDataRange=function(e){e=e||this.pageIndex;if(e>=1&&e<=this.pageCount){var t=this.pageSize*(e-1),n=t+this.pageSize-1;n=n>this.total-1?this.total-1:n;this.pageIndex=e;return{start:t,end:n,page:e}}};this.updateUI=function(e,t,n){this.total=e;this.pageIndex=t||this.pageIndex;this.pageSize=n||this.pageSize;this.pageCount=this.total%this.pageSize===0?~~(this.total/this.pageSize):~~(this.total/this.pageSize)+1;if(this.pageCount>1){if(this.uiMode==1){this.initUI(true)}else if(this.uiMode==2){this.initUI2()}else if(this.uiMode==3){this.initUI3()}}else{this.ui.innerHTML=""}};this.initUI=function(e){var t=[],n=this,s=parseInt(this.pageIndex,10);this.uiMode=1;if(this.pageCount>1){if(s!==1){t.push('<a href="#" action-type="pageTo" action-data="page=prev" class="M_btn_c pre">上一页</a>')}t.push('<div class="list" action-type="page_list">');t.push('<div class="its" style="display:none">');var o=parseInt(this.maxShowNum/2,10);var u=this.pageIndex+o<=this.maxShowNum?1:this.pageIndex-this.maxShowNum+o;u=u>0?u:1;var a=u+this.maxShowNum-1;a=a>this.pageCount?this.pageCount:a;for(var f=a;f>=u;f--){if(f!==s){t.push('<a href="#" action-type="pageTo" action-data="page='+f+'">第 '+f+" 页</a>")}else{t.push('<a href="#" class="current">第 '+f+" 页</a>")}}t.push("</div>");if(parseInt(this.maxShowNum,10)===0){t.push('<span class="t">第 '+s+" 页</span>")}else{t.push('<a class="M_linke" href="#"><span class="t">第 '+s+' 页</span><span class="M_ico M_icon31"></span></a>')}t.push("</div>");if(s!==this.pageCount){t.push('<a class="M_btn_c next" action-type="pageTo" action-data="page=next" href="#">下一页</a>')}t.push("</div>")}this.ui.innerHTML=t.join("");if(!e){var l,c=null,h=null;r.add("page_list","mouseover",function(e){if(n.maxShowNum>0){if(c)window.clearTimeout(c);if(h)window.clearTimeout(h);h=setTimeout(function(){l=i.sizzle(".its",e.el)[0];if(l)l.style.display="block"},500)}});r.add("page_list","mouseout",function(e){if(n.maxShowNum>0){l=i.sizzle(".its",e.el)[0];if(h)window.clearTimeout(h);c=window.setTimeout(function(){if(l)l.style.display="none"},500)}})}};this.initUI2=function(e){var t=[],n=this.pageIndex;this.uiMode=2;if(this.pageCount>1){if(n!==1){t.push('<a class="M_btn_c" href="#" action-type="pageTo" action-data="page=prev">上一页</a>')}var r=parseInt(this.maxShowNum/2,10);var i=this.pageIndex+r<=this.maxShowNum?1:this.pageIndex-this.maxShowNum+r;var s=i+this.maxShowNum-1;s=s>this.pageCount?this.pageCount:s;i=i>0?i:1;if(i>2){t.push('<a href="#" action-type="pageTo" action-data="page=1">1</a>');t.push('<span class="doccolor">...</span>')}for(var o=i;o<=s;o++){if(o!==n){t.push('<a href="#" action-type="pageTo" action-data="page='+o+'">'+o+"</a>")}else{t.push('<a href="#" class="current">'+o+"</a>")}}if(s<this.pageCount-1){t.push('<span class="doccolor">...</span>');t.push('<a href="#" action-type="pageTo" action-data="page'+this.pageCount+'">'+this.pageCount+"</a>")}if(n!==this.pageCount){t.push('<a class="M_btn_c" action-type="pageTo" action-data="page=next" href="#">下一页</a>')}}this.ui.innerHTML=t.join("")};this.initUI3=function(){var e=[],t=this.pageIndex;this.uiMode=3;if(this.pageCount>1){if(t!==1){e.push('<a class="M_btn_c" href="#" action-type="pageTo" action-data="page=prev">上一页</a>')}if(this.pageCount>1){e.push('<a href="#" class="current" action-type="pageTo" action-data="page='+t+'">'+t+"</a>")}if(t!==this.pageCount){e.push('<a class="M_btn_c" action-type="pageTo" action-data="page=next" href="#">下一页</a>')}}this.ui.innerHTML=e.join("")};this.gotoPage=function(e){var t=this;switch(e){case"prev":if(t.pageIndex-1>=1){t.pageIndex--}if(t.leftcallback&&typeof t.leftcallback==="function"){t.leftcallback.apply(t.scope,[t.pageIndex-1])}break;case"next":if(t.pageIndex+1<=t.pageCount){t.pageIndex++}if(t.rightcallback&&typeof t.rightcallback==="function"){t.rightcallback.apply(t.scope,[t.pageIndex-1])}break;default:e=parseInt(e,10)||parseInt(e.match(/\d{1,}/)[0],10);if(e===t.pageIndex){return}t.pageIndex=e;break}if(t.uiMode==1){t.initUI(true)}else if(t.uiMode==2){t.initUI2()}else if(t.uiMode==3){t.initUI3()}};this.init=function(){r.add("pageTo","click",function(e){var n=e.data["page"];window.setTimeout(function(){t.gotoPage(n);if(t.callback&&typeof t.callback==="function"){t.callback.apply(t.scope,[t.getDataRange()])}},0);i.preventDefault(e.evt)})};this.init();this.destroy=function(){r.destroy();i.removeNode(this.ui)}};e.exports=s},c:function(e,t,n,r){var i=function(e,t){var n=location.hash,r,i=[],s=[];var o=n.split("/");var u,a;o.shift();if(typeof e=="object"){if(t){for(u in e){s.push(u);s.push(e[u])}}else{for(u in e){r=true;for(a=0,len=o.length;a<len;a++){if(o[a]==u){o[a+1]=e[u];r=false;break}}if(r){i.push(u);i.push(e[u])}}s=o.concat(i)}}else if(typeof e=="string"){if(t){s.push(e)}else{r=true;for(a=0,len=o.length;a<len;a++){if(e==o[a]){r=false;break}}if(r)i.push(e);s=o.concat(i)}}location.hash="#!/"+s.join("/")};e.exports=i},C:function(e,t,n,r){var i=n("A");var s=function(e){var t=45;var n=i.position(e);var r=n.t-t>0?n.t-t:0;window.scrollTo(n.l,r)};e.exports=s},d:function(e,t,n,r){var i={isLogin:function(){var e=document.cookie+";";var t=["SUP","=([^;]*)?;"].join("");var n=["(\\?|&)","uid","=([^&]*)(&|$)"].join("");var r=e.match(new RegExp(t,"i"));r=r?r[1]||"":"";r=unescape(r);var i=r.match(new RegExp(n));i=i?i[2]||"":"";var s=$CONFIG.account_uid;if(i&&s==i)return true;return false}};e.exports=i},D:function(e,t,n,r){var i="http://js.app.wcdn.cn/ops/photo/";var s="http://img.t.sinajs.cn/t4/appstyle/photo/";var o="http://img.app.wcdn.cn/ops/photo/style/";var u=$CONFIG.script_version;var a=$CONFIG.style_version;e.exports={baseURL:$CONFIG.base_url,baseIMG:s+"images/",baseCSS:s+"css/",baseSWF:"http://js.t.sinajs.cn/t5/album/static/swf/v5/",baseJS:i+"/js/v5/",base:o,imgVersion:a,jsVersion:u,cssVersion:a}},e:function(e,t,n,r){function u(e){i.addClassName(o,"focus")}function a(e){i.removeClassName(o,"focus")}function f(e){var t=e;o=i.sizzle('[node-type="show_menu"]',t)[0];i.addEvent(o,"mouseover",u);i.addEvent(o,"mouseout",a);s.init(t);var n={};n.destroy=function(){};return n}var i=n("A");var s=n("E");var o;e.exports=f},E:function(e,t,n,r){var i=n("A");var s={inputEl:null,onsubmit:function(e){var t=i.trim(s.inputEl.value);if(t&&!i.hasClassName(s.inputEl,"M_txte"))location.href="/tags/search?tag="+encodeURIComponent(t);i.preventDefault(e)},onfocus:function(e){var t=e.target||e.srcElement;i.removeClassName(t,"M_txte");if(t.value==t.title)t.value=""},onblur:function(e){var t=e.target||e.srcElement;if(i.trim(t.value)===""){t.value=t.title;i.addClassName(t,"M_txte")}},init:function(e,t){var n=i.sizzle("form[name=searchForm]",e)[0];if(n){var r=this.inputEl=i.sizzle("input[node-type=search_input]",n)[0];var s=i.sizzle("a[node-type=search_btn]",n)[0];i.addEvent(r,"focus",this.onfocus);i.addEvent(r,"blur",this.onblur);i.addEvent(s,"click",this.onsubmit);n.onsubmit=this.onsubmit}}};e.exports=s},f:function(e,t,n,r){function u(e){s.add(e.data,function(t){var n=e.data["uid"];o.innerHTML='<a class="M_btn_d_done" href="javascript:void(0)">'+(t.isFollow==3?'<span class="M_ico M_icon32"></span>互相关注</a>':"已关注")+'<a href="#" action-type="doUnFollow" action-data="uid='+n+'">取消</a>'})}function a(e){var t=e.data["uid"];s.cancel(e.data,function(e){o.innerHTML='<a class="M_btn_d fllow" href="#" action-type="doFollow" action-data="uid='+t+'">加关注</a>'})}function f(e){if(!e)return;o=i.sizzle("span[node-type=follow_status]",e)[0];var t=i.delegatedEvent(e);t.add("doFollow","click",u);t.add("doUnFollow","click",a)}var i=n("A");var s=n("F");var o;e.exports=f},F:function(e,t,n,r){function a(){if(window.self!=window.top){window.top.location=window.self.location}return window.self==window.top}var i=n("b");var s=n("g");var o=n("D");var u=o.baseURL;var f={add:function(e,t,n){if(!n&&!a())return;i({url:u+"users/follow",args:e,method:"post",onComplete:function(e){if(e&&e.result){if(t&&typeof t==="function"){t.call(this,e.data)}}else{s(e.msg||"加关注失败")}},onFail:function(){s("操作失败")},onTimeout:function(){s("操作超时")}})},cancel:function(e,t,n){if(!n&&!a())return;i({url:u+"users/follow_destroy",args:e,method:"post",onComplete:function(e){if(e&&e.result){if(t&&typeof t==="function"){t.call(this,e.data)}else{s(e.msg||"取消关注失败")}}}})},failed:function(e){s(e)}};e.exports=f},g:function(e,t,n,r){var i=n("A");var s=n("G");var o=n("K");var u='<div class="L_min_prompt">'+'<div class="prompt M_txtc">'+'<span class="mk_ico" node-type="icon"></span><span class="cont" node-type="msg"></span>'+"</div>"+"</div>";var a={suced:"mk_suced",error:"mk_fail",remind:"mk_remind"};e.exports=function(e,t){var n,r,f,l={};var c={init:function(){c.pars();c.build();c.bind()},pars:function(){t=o({temp:"",mask:false,type:"suced",timer:2e3},t)},build:function(){r=s(t.temp||u,t);f=r.getDomList(true);if(f.icon){i.addClassName(f.icon,a[t["type"]||"suced"])}if(f.msg){f.msg.innerHTML=e}r.setMiddle().show()},bind:function(){var e=parseInt(t.timer,10);if(e){setTimeout(function(){r.hide()},e)}}};c.init();l.layer=r;return l}},G:function(e,t,n,r){var i=n("A");var s=n("h");var o=n("k");e.exports=function(e,t){var n={};var r,u,a,f,l,c;var h=10003;var p;var d;var v={box:'<div class="L_layer" node-type="outer" style="position:absolute;clear:both;display:none;">'+'<div node-type="inner" class="bg">'+'<table border="0" cellpadding="0" cellspacing="0">'+"<tbody><tr><td>"+'<div class="content" node-type="content"></div>'+"</td></tr></tbody>"+"</table>"+"</div>"+"</div>"};var m={ok:function(e){i.stopEvent(e.evt);if(i.getType(t.okCallback)=="function"&&t.okCallback(e)==false){return}n.hide()},cancel:function(e){i.stopEvent(e.evt);if(i.getType(t.cancelCallback)=="function"){t.cancelCallback(e)}n.hide()}};var g={init:function(){g.pars();g.build();g.bind()},pars:function(){t=i.parseParam({okCallback:i.funcEmpty,cancelCallback:i.funcEmpty,showCallback:i.funcEmpty,hideCallback:i.funcEmpty,draggable:true,mask:true},t||{})},build:function(){var n=i.builder(v.box).list;a=n.outer[0];r=s(a);f=n.inner[0];content=n.content[0];content.innerHTML=e||"";u=r.getDomList(true);l=u.title;if(t.mask){r.setMask()}c=i.objSup(r,["destroy"])},bind:function(){d=i.delegatedEvent(a);d.add("ok","click",m.ok);d.add("cancel","click",m.cancel);if(l&&t.draggable){o(l,{actObj:r,moveDom:a})}i.custEvent.add(r,"hide",function(){i.custEvent.remove(r,"hide",arguments.callee);n.destroy();o.destroy()})}};g.init();n=r;n.layer_size=r.getSize();n.setContent=function(e){if(typeof e=="string"){content.innerHTML=e}else{content.appendChild(e)}return n};n.setLayerXY=function(e){if(!e){i.log("ui.tip.setLayerXY need element as pNode")}var t=i.position(e);var s=t.l;var o=e.offsetWidth;var u=e.offsetHeight;var a=n.layer_size.w;var f=Math.min(Math.max(s+(o-a)/2,i.scrollPos().left),i.scrollPos().left+STK.winSize().width-a);var l=t.t+u;var c=[";"];c.push("height:",n.tipHeight,"px;");c.push("top:",l,"px;");c.push("left:",f,"px;");r.getBox().style.cssText+=c.join("")};n.addEvent=function(e,t,n){d.add(e,t,n)};n.destroy=function(){c.destroy();d.destroy();r=null};return n}},h:function(e,t,n,r){var i=n("A");var s=n("H");var o=n("i");var u=n("j");e.exports=function(e,t){var n,r,a;var f=false;var l;var c={init:function(){c.pars();c.build();c.bind()},pars:function(){},build:function(){n=u(e,t);r=n.getBox();a=i.builder(r).list},bind:function(){}};c.init();l=n;l.getDomList=function(e){if(e){a=s(i.builder(r).list)}return a};l.setMask=function(){i.custEvent.add(n,"show",function(){if(!f){o.showUnderNode(r)}f=true});i.custEvent.add(n,"hide",function(){o.back();f=false})};return l}},H:function(e,t,n,r){e.exports=function(e){for(var t in e){if(e[t]&&e[t].length==1){e[t]=e[t][0]}}return e}},i:function(e,t,n,r){function d(){o=i.C("div");var e='<div node-type="outer">';if(i.core.util.browser.IE6){e+='<div style="position:absolute;width:100%;height:100%;"></div>'}e+="</div>";o=i.builder(e).list["outer"][0];document.body.appendChild(o);f=true;a=s(o,"lt");var t=function(){var e=i.core.util.winSize();o.style.cssText=i.core.dom.cssText(o.style.cssText).push("width",e.width+"px").push("height",e.height+"px").getCss()};p.add(a,"beforeFix",t);t()}function v(e){var t;if(!(t=e.getAttribute(l))){e.setAttribute(l,t=i.getUniqueKey())}return">"+e.tagName.toLowerCase()+"["+l+'="'+t+'"]'}var i=n("A");var s=n("I");var o,u=[],a,f=false,l="STK-Mask-Key";var c=i.core.dom.setStyle,h=i.core.dom.getStyle,p=i.core.evt.custEvent;var m={getNode:function(){return o},show:function(e,t){if(f){e=i.core.obj.parseParam({opacity:.3,background:"#000000"},e);o.style.background=e.background;c(o,"opacity",e.opacity);o.style.display="";a.setAlign("lt");t&&t()}else{d();m.show(e,t)}return m},hide:function(){o.style.display="none";u=[];return m},showUnderNode:function(e,t){if(i.isNode(e)){m.show(t,function(){c(o,"zIndex",h(e,"zIndex"));var t=v(e);var n=i.core.arr.indexOf(u,t);if(n!=-1){u.splice(n,1)}u.push(t);i.core.dom.insertElement(e,o,"beforebegin")})}return m},back:function(){if(u.length<1){return m}var e,t;u.pop();if(u.length<1){m.hide()}else if((t=u[u.length-1])&&(e=i.sizzle(t,document.body)[0])){c(o,"zIndex",h(e,"zIndex"));i.core.dom.insertElement(e,o,"beforebegin")}else{m.back()}return m},resetSize:function(){var e=i.core.util.winSize();o.style.cssText=i.core.dom.cssText(o.style.cssText).push("width",e.width+"px").push("height",e.height+22+"px").getCss();return m},destroy:function(){p.remove(a);o.style.display="none"}};e.exports=m},I:function(e,t,n,r){function u(e){return i.core.dom.getStyle(e,"display")!="none"}function a(e){e=i.core.arr.isArray(e)?e:[0,0];for(var t=0;t<2;t++){if(typeof e[t]!="number")e[t]=0}return e}function f(e,t,n){if(!u(e))return;var r="fixed",o,a,f,l,c=e.offsetWidth,h=e.offsetHeight,p=i.core.util.winSize(),d=0,v=0,m=i.core.dom.cssText(e.style.cssText);if(!s){r="absolute";var g=i.core.util.scrollPos();d=o=g.top;v=a=g.left;switch(t){case"lt":o+=n[1];a+=n[0];break;case"lb":o+=p.height-h-n[1];a+=n[0];break;case"rt":o+=n[1];a+=p.width-c-n[0];break;case"rb":o+=p.height-h-n[1];a+=p.width-c-n[0];break;case"c":default:o+=(p.height-h)/2+n[1];a+=(p.width-c)/2+n[0];break}f=l=""}else{o=l=n[1];a=f=n[0];switch(t){case"lt":l=f="";break;case"lb":o=f="";break;case"rt":a=l="";break;case"rb":o=a="";break;case"c":default:o=(p.height-h)/2+n[1];a=(p.width-c)/2+n[0];l=f="";break}}if(t=="c"){if(o<d)o=d;if(a<v)a=v}m.push("position",r).push("top",o+"px").push("left",a+"px").push("right",f+"px").push("bottom",l+"px");e.style.cssText=m.getCss()}var i=n("A");var s=!(i.core.util.browser.IE6||document.compatMode!=="CSS1Compat"&&STK.IE),o=/^(c)|(lt)|(lb)|(rt)|(rb)$/;e.exports=function(e,t,n){var r,u,l=true,c;if(i.core.dom.isNode(e)&&o.test(t)){var h={getNode:function(){return e},isFixed:function(){return l},setFixed:function(t){(l=!!t)&&f(e,r,u);return this},setAlign:function(t,n){if(o.test(t)){r=t;u=a(n);l&&f(e,r,u)}return this},destroy:function(){if(!s){s&&i.core.evt.removeEvent(window,"scroll",p)}i.core.evt.removeEvent(window,"resize",p);i.core.evt.custEvent.undefine(c)}};c=i.core.evt.custEvent.define(h,"beforeFix");h.setAlign(t,n);function p(t){t=t||window.event;i.core.evt.custEvent.fire(c,"beforeFix",t.type);if(l&&(!s||r=="c")){f(e,r,u)}}if(!s){i.core.evt.addEvent(window,"scroll",p)}i.core.evt.addEvent(window,"resize",p);return h}}},j:function(e,t,n,r){var i=n("A");var s=n("J");var o=n("I");var u=n("k");var a='<div node-type="outer" class="L_layer" style="display:none;position:absolute;"></div>';var f=100100;e.exports=function(e,t){var n,r,l,c;var h=null;var p=function(e){var t={};if(e.style.display=="none"){e.style.visibility="hidden";e.style.display="";t.w=e.offsetWidth;t.h=e.offsetHeight;e.style.display="none";e.style.visibility="visible"}else{t.w=e.offsetWidth;t.h=e.offsetHeight}return t};var d=function(e,t){t=t||"topleft";var n={};if(e.style.display=="none"){e.style.visibility="hidden";e.style.display="";n=i.core.dom.position(e);e.style.display="none";e.style.visibility="visible"}else{n=i.core.dom.position(e)}var r=p(e);switch(t){case"topleft":break;case"topright":n["l"]=n["l"]+r["w"];break;case"bottomleft":n["t"]=n["t"]+r["h"];break;case"bottomright":n["l"]=n["l"]+r["w"];n["t"]=n["t"]+r["h"];break;default:break}return n};var v={show:function(){r.style.display="";document.body.appendChild(r);i.custEvent.fire(v,"show");return v},hide:function(){r.style.display="none";i.custEvent.fire(v,"hide");return v},getState:function(){if(r.style.display=="none"){return false}else{return true}},getID:function(){return n.id},getBox:function(){return r},html:function(e){if(typeof e==="string"){r.innerHTML=e}else{r.appendChild(e)}return v},setTop:function(){r.parentNode&&r.parentNode.appendChild(r);return v},setPosition:function(e){r.style.top=e["t"]+"px";r.style.left=e["l"]+"px";return v},getPosition:function(e){return d(r,e)},setLayoutPos:function(e,t){s(r,e,t);return v},setMiddle:function(){var e=i.winSize();var t=v.getSize(true);var s=i.scrollPos()["top"]+(e.height-t.h)/2;r.style.top=(s>0?s:0)+n.offset[1]+"px";r.style.left=(e.width-t.w)/2+n.offset[0]+"px";return v},setAlign:function(e){e=i.parseParam({type:"c",offset:[0,0]},e||{});c=o(r,e.type,e.offset);return v},getSize:function(e){if(e||!h){h=p(r)}return h},setIndex:function(e){r.style.zIndex=e},destroy:function(){r.style.display="none";i.removeNode(r);c&&c.destroy();r=null}};var m={init:function(){m.pars();m.build();m.bind()},pars:function(){n=i.parseParam({id:"layer_"+i.core.util.getUniqueKey(),node:null,template:"",appendTo:document.body,draggable:false,zIndex:null,offset:[0,0]},t||{});if(i.isNode(e)){n.node=e||n.node}else{switch((typeof e||"").toLowerCase()){case"string":n.id=e||n.id;n.node=i.E(n.id)||null;break;case"object":n=i.parseParam(n,e||{});break}}},build:function(){r=n.node;l=n.appendTo;if(!r){nodes=i.builder(n.template||a);r=nodes.list["outer"][0];l&&l.appendChild(r)}else{if(!i.contains(l,r)){l&&l.appendChild(r)}}v.setIndex(n.zIndex||f);r.id=n.id},bind:function(){i.custEvent.define(v,["show","hide"]);if(n.draggable){u(r,{actObj:r,moveDom:r})}}};m.init();return v}},J:function(e,t,n,r){var i=n("A");e.exports=function(e,t,n){if(!i.isNode(t)){throw"kit.dom.layerOutElement need element as first parameter"}if(t===document.body){return false}if(!t.parentNode){return false}if(t.style.display==="none"){return false}var r,s,o,u,a,f,l;r=i.parseParam({pos:"left-bottom",offsetX:0,offsetY:0},n);s=t;if(!s){return false}while(s!==document.body){s=s.parentNode;if(s.style.display==="none"){return false}f=i.getStyle(s,"position");l=s.getAttribute("layout-shell");if(f==="absolute"||f==="fixed"){break}if(l==="true"&&f==="relative"){break}}s.appendChild(e);o=i.position(t,{parent:s});u={w:t.offsetWidth,h:t.offsetHeight};a=r["pos"].split("-");if(a[0]==="left"){e.style.left=o.l+r.offsetX+"px"}else if(a[0]==="right"){e.style.left=o.l+u.w+r.offsetX+"px"}else if(a[0]==="center"){e.style.left=o.l+u.w/2+r.offsetX+"px"}if(a[1]==="top"){e.style.top=o.t+r.offsetY+"px"}else if(a[1]==="bottom"){e.style.top=o.t+u.h+r.offsetY+"px"}else if(a[1]==="middle"){e.style.top=o.t+u.h/2+r.offsetY+"px"}return true}},k:function(e,t,n,r){var i=n("A");e.exports=function(e,t){var n,r,s,o,u,a,f,l;var c=function(){h();p()};var h=function(){n=i.parseParam({moveDom:e,perchStyle:"border:solid #999999 2px;",dragtype:"perch",actObj:{},pagePadding:5},t);s=n.moveDom;r={};o={};u=i.drag(e,{actObj:n.actObj});if(n["dragtype"]==="perch"){a=i.C("div");f=false;l=false;s=a}e.style.cursor="move"};var p=function(){i.custEvent.add(n.actObj,"dragStart",d);i.custEvent.add(n.actObj,"dragEnd",v);i.custEvent.add(n.actObj,"draging",m)};var d=function(t,r){document.body.style.cursor="move";var s=i.core.util.pageSize()["page"];o=i.core.dom.position(n.moveDom);o.pageX=r.pageX;o.pageY=r.pageY;o.height=n.moveDom.offsetHeight;o.width=n.moveDom.offsetWidth;o.pageHeight=s["height"];o.pageWidth=s["width"];if(n["dragtype"]==="perch"){var u=[];u.push(n["perchStyle"]);u.push("position:absolute");u.push("z-index:"+(n.moveDom.style.zIndex+10));u.push("width:"+n.moveDom.offsetWidth+"px");u.push("height:"+n.moveDom.offsetHeight+"px");u.push("left:"+o["l"]+"px");u.push("top:"+o["t"]+"px");a.style.cssText=u.join(";");l=true;setTimeout(function(){if(l){document.body.appendChild(a);f=true}},100)}if(e.setCapture!==undefined){e.setCapture()}};var v=function(t,r){document.body.style.cursor="auto";if(e.setCapture!==undefined){e.releaseCapture()}if(n["dragtype"]==="perch"){l=false;n.moveDom.style.top=a.style.top;n.moveDom.style.left=a.style.left;if(f){document.body.removeChild(a);f=false}}};var m=function(e,t){var r=o.t+(t.pageY-o.pageY);var i=o.l+(t.pageX-o.pageX);var u=r+o["height"];var a=i+o["width"];var f=o["pageHeight"]-n["pagePadding"];var l=o["pageWidth"]-n["pagePadding"];if(u<f&&r>0){s.style.top=r+"px"}else{var c;if(u>=f){c=f-o["height"]}if(r<0||c<0){c=0}s.style.top=c+"px"}if(a<l&&i>0){s.style.left=i+"px"}else{if(i<0){s.style.left="0px"}if(a>=l){s.style.left=l-o["width"]+"px"}}};c();r.destroy=function(){document.body.style.cursor="auto";if(typeof s.setCapture==="function"){s.releaseCapture()}if(n["dragtype"]==="perch"){l=false;if(f){document.body.removeChild(a);f=false}}i.custEvent.remove(n.actObj,"dragStart",d);i.custEvent.remove(n.actObj,"dragEnd",v);i.custEvent.remove(n.actObj,"draging",m);if(u.destroy){u.destroy()}n=null;s=null;o=null;u=null;a=null;f=null;l=null};r.getActObj=function(){return n.actObj};return r}},K:function(e,t,n,r){var i=Object.prototype.hasOwnProperty;e.exports=function(e,t){var n=Array.apply([],arguments),r=1,s,o=typeof n[n.length-1]=="boolean"?n.pop():true;if(n.length===1){e=!this.window?this:{};r=0}while(t=n[r++]){for(s in t){if(i.call(t,s)&&(o||!(s in e))){e[s]=t[s]}}}return e}},l:function(e,t,n,r){var i=n("A");var s=n("L");var o=n("m");var u=n("K");var a;var f=i.getType;var l=$CONFIG.base_url;var c=""+'<div class="L_prompt">'+'<div class="prompt M_txtc">'+'<span class="mk_ico" node-type="icon"></span><span class="cont" node-type="msg"></span>'+"</div>"+'<div class="submit_centr"><a href="javascript:void(0)" class="M_btn_e" action-type="ok"><span>确定</span></a><a href="javascript:void(0)" class="M_btn_e" action-type="cancel"><span>取消</span></a></div>'+"</div>";var h={success:"mk_suced",error:"mk_fail",remind:"mk_remind"};e.exports=function(e,t,n){var r,l,p,d;var v,m;var g={};var y=o;var b={ok:function(e){if(f(t.ok)==="function"&&t.ok(e)===false){return}l.hide()},cancel:function(e){if(f(t.cancel)==="function"&&t.cancel(e)===false){return}l.hide()}};var w={init:function(){w.pars();w.build();w.bind()},pars:function(){t=u({title:"提示",okText:"确定",cancelText:"取消",ok:i.funcEmpty,cancel:i.funcEmpty},t);n=n?h[n]:h["remind"]},build:function(){l=s(null,t);l.setContent(t.temp||c);l.setTitle&&l.setTitle(t["title"]);r=l.getDomList(true);var o=r["icon"];o&&i.addClassName(o,n);r["msg"]&&(r["msg"].innerHTML=e);l.setMiddle().show()},bind:function(){a=i.delegatedEvent(l.getBox());a.add("ok","click",b.ok);a.add("cancel","click",b.cancel);i.custEvent.add(l,"hide",function(){a.destroy();i.custEvent.remove(l,"hide",arguments.callee);l.destroy()})}};w.init();g.dia=l;g.hide=l.hide;g.addEvent=function(e,t,n){a&&a.add(e,t,n)};return g}},L:function(e,t,n,r){var i=n("A");var s=n("k");var o=n("h");var u=n("K");var a=""+'<div class="L_layer" node-type="outer" style="display:none;position:absolute;">'+'<div class="bg">'+'<table border="0" cellspacing="0" cellpadding="0">'+"<tr><td>"+'<div class="content" node-type="layoutContent">'+'<div node-type="title" class="title" style="cursor: move;"><span node-type="title_content"></span></div>'+'<a node-type="close" action-type="close" title="关闭" href="javascript:void(0)" class="close"></a>'+'<div node-type="inner"></div>'+"</div>"+"</td></tr>"+"</table>"+"</div>"+"</div>";e.exports=function(e,t){var n,r,f,l,c,h,p,d,v;var m;var g;var y=function(){m.hide()};var b={close:function(e){i.stopEvent();m.hide()},show:function(){if(i.IE){document.body.focus()}else{document.documentElement.focus()}i.hotKey.add(document.documentElement,["esc"],y,{type:"keyup",disableInInput:true})}};var w={init:function(){w.pars();w.build();w.bind()},pars:function(){t=u({haveMask:true},t);t.template=a},build:function(){n=o(e,t);r=n.getBox();f=n.getDomList(true);l=f["title"];c=f["title_content"];v=f["layoutContent"];h=f["inner"];p=f["close"];t.haveMask&&n.setMask();d=i.objSup(n,["hide"])},bind:function(){var e=i.delegatedEvent(r);e.add("close","click",b.close);s(l,{actObj:n,moveDom:r});i.custEvent.add(n,"show",b.show);i.custEvent.add(n,"hide",function(){i.custEvent.remove(n,"hide",arguments.callee);i.custEvent.remove(n,"show",b.show);e.destroy();i.hotKey.remove(document.documentElement,["esc"],y,{type:"keyup"});s.destroy()})}};w.init();m=n;m.hide=function(e){if(typeof g==="function"&&!e){if(g()===false){return false}}d.hide();return m};m.setClassName=function(e){v.className=e;return m};m.setTitle=function(e){c.innerHTML=e;return m};m.setContent=function(e){h.innerHTML="";if(typeof e==="string"){h.innerHTML=e}else{h.appendChild(e)}return m};m.insertElement=function(e,t){t=t||"beforeend";i.core.dom.insertElement(h,e,t);return m};m.clearContent=function(){while(h.children.length){i.removeNode(h.children[0])}return m};m.setBeforeHideFn=function(e){g=e};m.clearBeforeHideFn=function(){g=null};m.getClose=function(){return p};m.getIndex=function(){var e=r.style.zIndex||0;return parseInt(e,10)};return m}},m:function(e,t,n,r){var i=n("A");window.$LANG||(window.$LANG={});e.exports=function(e){var t=[].splice.call(arguments,1,arguments.length);var n=[e,$LANG].concat(t);var r=i.core.util.language.apply(this,n);return r}},M:function(e,t,n,r){e.exports={10001:"保存成功",10002:"分享成功",10003:"封面设置成功",10004:"头像设置成功",10005:"复制链接成功",10006:"关注成功",10007:"确定",10008:"取消",10009:"创建",10010:"操作失败，请重试",10011:"请选择一个你的好友",10012:"数据已经被删除或无权访问",10013:"复制连接地址成功",10014:"头像设置成功",10015:"头像设置失败",10016:"分享内容不能为空",10017:"操作成功",10018:"取消成功",11001:"创建成功",11002:"确定删除该专辑吗？",11003:"删除专辑成功",11004:"新建专辑",11005:"编辑专辑",11006:"删除专辑失败",11007:"该专辑已满",11008:"封面设置成功",11009:"封面设置失败",11010:"新建会员专辑",11011:"新建收费专辑",12001:"确定删除该照片吗？",12002:"删除照片成功",12003:"移动照片成功",12004:"排序已更改，是否保存？",12005:"删除照片失败",12006:"移动照片成功",12007:"移动照片失败",12008:"排序保存成功",12009:"排序保存失败",12010:"确定将照片移动到此专辑？",12011:"照片还未完全载入",12012:"高宽小于100px的图片不能进行圈人操作",12013:"此照片为私密微博图片",12014:"旋转保存失败",12015:"照片不存在或无权查看",12016:"请先关闭圈人再旋转照片",12017:"此操作将同时删除该条微博以及它包含的所有图片，确定删除？",12018:"此照片为密友可见图片",12019:"确定要移除该照片吗？",12020:"移除照片成功",12021:"移除照片失败",13001:"赞图成功",13002:"取消赞成功",13003:"确定取消赞吗？",13004:"取消赞失败",13005:"赞失败",13006:"获取喜欢列表失败",14001:"收藏成功",14002:"取消收藏成功",14003:"确定取消收藏吗？",14004:"取消收藏",14005:"收藏专辑",14006:"收藏照片",14007:"收藏失败",14008:"取消收藏失败",15001:"评论成功",15002:"删除评论成功",15003:"休息一下，相同内容的微博发一条就够啦",16001:"圈人成功",16002:"删除圈人成功",16003:"圈人失败",17001:"存在重复的标签",17002:"请输入标签",18001:"您选择的文件格式有错误",18002:"上传失败",18003:"请选择图片",18004:"未上传图片",18005:"上传照片不可大于20M"}},n:function(e,t,n,r){var i=n("A");var s=n("N");e.exports=function(e,t){t=i.parseParam({expr:undefined,endpoint:document,maxLength:1},t);var n=t.expr;if(!e||!n){i.log("kit parents: node or opts.expr is undefined.");return}return s(e,t)}},N:function(e,t,n,r){var i=n("A");e.exports=function(e,t){t=i.parseParam({dir:"parentNode",expr:undefined,endpoint:document,maxLength:1},t);var n=t.dir,r=t.expr,s=t.endpoint,o=t.maxLength;if(!e||!r){i.log("kit dir: node or opts.expr is undefined.");return}var u=[],a=e[n];while(a){if(a.nodeType==1&&i.sizzle(r,null,null,[a]).length>0){u.push(a);if(u.length==o){break}}if(a==s){break}a=a[n]}return u}},o:function(e,t,n,r){function y(e,t,n){if(!u.isLogin()){location.reload();return}f({url:a+"albums/"+(t?"update":"create"),args:m(e),method:"post",onComplete:function(e){if(n&&i.getType(n)==="function"){n.call(this,e)}}})}var i=n("A");var s=n("L");var o=n("g");var u=n("d");var a=n("D").baseURL;var f=n("b");var l=n("O");var c=n("p");var h=n("P");var p=n("q");var d=n("M");var v=n("Q");var m=function(e){return i.htmlToJson(e)};var g=function(e,t){var n=true;var r=e.description;var s=e.error_tip;if(r.title==r.value){r.value=""}var o=e.caption;if(i.trim(o.value)===""){s.innerHTML='<span class="txt">专辑名称不能为空</span>';l(s);o.focus();return n=false}var u=i.sizzle("[name=property]:checked")[0].value;if(t.type==="44"){if(!i.sizzle("[name=price]:checked")[0]){s.innerHTML='<span class="txt">价格不能为空</span>';l(s);return n=false}}if(parseInt(u,10)==5){var a=e.question;if(i.trim(a.value)===""){s.innerHTML='<span class="txt">问题不能为空</span>';l(s);a.focus();return n=false}var f=e.answer;if(i.trim(f.value)===""){s.innerHTML='<span class="txt">答案不能为空</span>';l(s);f.focus();return n=false}}return n};e.exports=function(e,t){var n,r,u=null,a,f=null;var m;var b,w,E,S;var x=false;var T={init:function(){T.pars();T.build();T.bind()},pars:function(){e=i.parseParam({title:"编辑专辑",name:"",description:"讲讲你和照片的故事...（非必填）",auth:"1",price:"",prices:"",question:"",answer:"",album_id:"",isDefault:false,property:"1",type:"",afterEvent:i.funcEmpty},e||{});var n=t?"保存":"创建";e.disabled=t?"disabled":"";e.btn_text=n;e.auth==3&&(e.auth=4);e.type==31&&(e.isDefault=true);e.prices&&(e.prices=e.prices.split(","));e.counter={caption:p(e.name),desc:p(e.description),question:p(e.question),answer:p(e.answer)}},build:function(){r=s();r.setContent(v(e));r.setTitle(e.title);r.setMiddle().show();n=r.getBox();a=r.getDomList(true);u=a.ask_layer;var t=i.sizzle(":radio[name=property][value="+e.auth+"]",n)[0];var o=i.sizzle(":radio[name=price]",n)[0];var f=i.sizzle(":radio[name=price][value="+parseFloat(e.price,10)+"]",n)[0];if(t){t.checked=true}if(f){f.checked=true}else if(o){o.checked=true}if(e.auth==5){l(u)}w=h({nodeList:{textEl:a.caption,wordNum:a.caption_w},opts:{limitNum:15},fn:function(e){return e+"/15"}});b=h({nodeList:{textEl:a.description,wordNum:a.description_w},opts:{limitNum:140},fn:function(e){return e+"/140"}});E=h({nodeList:{textEl:a.question,wordNum:a.question_w},opts:{limitNum:20},fn:function(e){return e+"/20"}});S=h({nodeList:{textEl:a.answer,wordNum:a.answer_w},opts:{limitNum:20},fn:function(e){return e+"/20"}})},bind:function(){var s=function(e){var t=e.evt.target;if(t.value==5&&t.checked){l(u)}else{c(u)}};var f=function(e){var t=e.target||e.srcElement;if(t.value==t.title)t.value=""};var h=function(e){var t=e.target||e.srcElement;if(t.value==="")t.value=t.title};var p=function(n){i.preventDefault();var s=g(a,e);if(s&&!x){x=true;var u=n.el;i.addClassName(u,"M_btn_disb");y(a.album_form,t,function(n){x=false;i.removeClassName(u,"M_btn_disb");r.hide();if(n&&n.result){var s=e.afterEvent;if(s&&i.getType(s)==="function"){s.call(this,n.data)}o(t?d["10001"]:d["11001"])}else{o(n.msg||d["10010"],{type:"error"})}})}};m=i.delegatedEvent(n);m.add("change_permission","click",s);m.add("submit","click",p);i.addEvent(a.description,"focus",f);i.addEvent(a.description,"blur",h);i.custEvent.add(r,"hide",function(){i.custEvent.remove(r,"hide",arguments.callee);m.remove("change_permission","click");m.remove("submit","click");i.removeEvent(a.description,"focus",f);i.removeEvent(a.description,"blur",h);r.destroy();b.destroy();w.destroy();E.destroy();S.destroy()})}};T.init();f=r;return f}},O:function(e,t,n,r){e.exports=function(e){if(!e||e.nodeType!==1){throw"fn-->show need a element node as parameter"}e.style.display="block"}},p:function(e,t,n,r){e.exports=function(e){if(!e||e.nodeType!==1){throw"/bp/dom/hide() need a element node as parameter"}e.style.display="none"}},P:function(e,t,n,r){function u(e,t){var n=s(e);var r={overflow:false,sum:n,overnum:Math.abs(t-n)};if(n>t){r.overflow=true}return r}var i=n("A");var s=n("q");var o=n("m");e.exports=function(e){function v(e){var t=e.textEl;if(!t){throw"[editor plugin count]: plz check nodeList"}i.removeEvent(t,"focus",m);i.removeEvent(t,"blur",g)}function m(){if(p){return}p=true;d=false;l=setInterval(function(){b()},100)}function g(e){if(d){return}d=true;p=false;if(l){clearInterval(l)}}var t=e.nodeList;var n=e.opts;var r=e.fn||false;var s=e.before_cut||i.funcEmpty;var a=o;var f=n.limitNum;var l;v(t);var c=t.textEl;var h=t.wordNum;var p=false;var d=false;i.addEvent(c,"focus",m);i.addEvent(c,"blur",g);var y=i.trim;var b=function(){var e=c.value;var t=y(e);var n;t=t.replace(/\r\n/g,"\n");var o=u(t,f);if(o.overflow){if(s(o,t)!==false){c.value=i.leftB(t,f*2)}n=0}else{n=o.overnum}if(h&&1===h.nodeType){var a="";if(r&&"function"===i.getType(r)){a=r(n)}else{a="还可以输入<span>"+n+"</span>个字"}h.innerHTML=a}};return{destroy:function(){i.removeEvent(c,"focus",m);i.removeEvent(c,"blur",g);c=null}}}},q:function(e,t,n,r){var i=n("A");e.exports=function(e){return Math.ceil(i.bLength(e)/2)}},Q:function(e,t,n,r){e.exports=function(e,t,n){t=t||function(e){return e};var r="",i=t('<div class="L_editalbum">\n  <form name="albumForm" node-type="album_form">\n    <div class="m_ly_tip" node-type="error_tip" style="display:none"></div>\n    <div class="album_info">\n        <dl class="m_Layform clearfix">\n            <dt>专辑名称：</dt>\n            <dd class="contBox"><input type="text" value="'),s=t('" '),o=t("disabled"),u=t(' name="caption" class="M_inpt" node-type="caption"></dd>\n            <dd class="tipBox"><span class="M_txte" node-type="caption_w">'),a=t('/15</span></dd>\n        </dl>\n        <dl class="m_Layform clearfix">\n            <dt>专辑描述：</dt>\n            <dd class="contBox"><textarea name="description" '),f=t(' title="讲讲你和照片的故事...（非必填）" class="M_txtarea" node-type="description">'),l=t('</textarea></dd>\n            <dd class="tipBox"><span class="M_txte" node-type="description_w">'),c=t('/140</span></dd>\n        </dl>\n    </div>\n    <div class="authority" '),h=t('style="display:none"'),p=t('>\n      <dl class="set_authort clearfix">\n        <dt>设置权限：</dt>\n        <dd class="M_txtb">\n            '),d=t('            	<p class="vip_value">我的会员可见</p>\n            	<input type="hidden" name="type" value="'),v=t('">\n            	<input type="radio" value="11" class="M_radio" id="vip" checked style="display:none" name="property" action-type="change_permission">\n            '),m=t(' <p class="opt_choose">'),g=t('<label><input type="radio" name="price" '),y=t(' value="'),b=t('" class="M_radio">'),w=t("元</label>"),E=t('<input type="radio" name="property" checked value="11" style="display:none" class="M_radio">\n<input type="hidden" name="type" value="'),S=t('">\n </p>\n <p class="vip_value M_txtb">专辑创建后，价格不可再修改</p>'),x=t('<p>谁可以看到这个专辑？</p>\n<ul class="userlist">\n<li><input type="radio" value="1" class="M_radio" id="all" checked name="property" action-type="change_permission"><label for="all">所有人</label></li>\n<li><input type="radio" value="4" class="M_radio" id="each_o" name="property" action-type="change_permission"><label for="each_o">相互关注的人</label></li>\n<li><input type="radio" value="2" class="M_radio" id="self" name="property" action-type="change_permission"><label for="self">仅自己</label></li>\n<li><input type="radio" value="5" class="M_radio" id="ask" name="property" action-type="change_permission"><label for="ask">问题访问</label></li>\n</ul>\n            '),T=t('        <input type="hidden" name="album_id" value="'),N=t('">\n        </dd>\n      </dl>\n      <div class="ask_q" node-type="ask_layer" style="display:none">\n        <dl class="m_Layform clearfix">\n            <dt>问题：</dt>\n            <dd class="contBox"><input type="text" name="question" value="'),C=t('" class="M_inpt" node-type="question"></dd>\n            <dd class="tipBox"><span class="M_txte" node-type="question_w">'),k=t('/20</span></dd>\n        </dl>\n        <dl class="m_Layform clearfix">\n            <dt>答案：</dt>\n            <dd class="contBox"><input type="text" name="answer" value="'),L=t('" class="M_inpt" node-type="answer"></dd>\n            <dd class="tipBox"><span class="M_txte" node-type="answer_w">'),A=t('/20</span></dd>\n        </dl>\n      </div>\n    </div>\n    <div class="save_cal">\n        <a href="#" action-type="submit" class="M_btn_e"><span>'),O=t('</span></a><a href="#" action-type="close" class="M_btn_e"><span>取消</span></a>\n    </div>\n  </form>\n</div>');r+=i;r+=e.name;r+=s;if(e.type==="45"){r+=o}r+=u;r+=15-e.counter.caption;r+=a;if(e.type==="45"){r+=o}r+=f;r+=e.description;r+=l;r+=140-e.counter.desc;r+=c;if(!e.auth){r+=h}r+=p;if(e.property==="11"&&e.type==="43"){r+=d;r+=e.type;r+=v}else if(e.property==="11"&&e.type==="44"&&e.prices&&e.prices.length){r+=m;for(e.prices.i=0,e.prices.len=e.prices.length;e.prices.i<e.prices.len;e.prices.i++){e.item=e.prices[e.prices.i];r+=g;r+=e.disabled;r+=y;r+=e.item;r+=b;r+=e.item;r+=w}r+=E;r+=e.type;r+=S}else{r+=x}r+=T;r+=e.album_id;r+=N;r+=e.question;r+=C;r+=20-e.counter.question;r+=k;r+=e.answer;r+=L;r+=20-e.counter.answer;r+=A;r+=e.btn_text;r+=O;return r}},r:function(e,t,n,r){var i=n("A");var s=n("L");var o=n("b");var u=n("D");var a=n("R");var f=n("d");e.exports=function(e){var t,n,r,l=null;var c;var h={init:function(){h.pars();h.build();h.bind()},pars:function(){e=i.parseParam({title:"回答问题",albumId:"",uid:"",question:"",return_url:"",afterEvent:i.funcEmpty},e||{})},build:function(){n=s();n.setContent(a(e));n.setTitle(e.title);n.setMiddle().show();t=n.getBox();r=n.getDomList(true)},bind:function(){var r=function(){if(!f.isLogin()){location.reload();return}i.preventDefault();var n=i.sizzle("input[name=answer]",t)[0];var r=i.builder(t).list["tip"][0];var s={};if(i.trim(n.value)===""){r.innerHTML="请输入答案";return}s.uid=e.uid;s.album_id=e.albumId;s.answer=i.trim(n.value);o({url:u.baseURL+"albums/answer_question",method:"post",args:s,onComplete:function(t){if(t&&t.result){if(e.return_url){location.href=e.return_url}else{location.href=u.baseURL+e.uid+"/albums/detail/album_id/"+e.albumId}}else{r.innerHTML=t.msg||"回答问题错误"}}})};var s=i.sizzle("form",t)[0];s.onsubmit=r;c=i.delegatedEvent(t);c.add("submit","click",r);i.custEvent.add(n,"hide",function(){i.custEvent.remove(n,"hide",arguments.callee);c.destroy();n.destroy()})}};h.init();l=n;return l}},R:function(e,t,n,r){e.exports=function(e,t,n){t=t||function(e){return e};var r="",i=t('<form>  <div class="L_answer">    <p class="tip M_txta">访问此专辑需回答以下问题</p>    <div class="answer">      <dl class="m_Layform clearfix">        <dt>提问：</dt>        <dd class="contBox M_txtb">'),s=t('？</dd>      </dl>      <dl class="m_Layform clearfix">        <dt>回答：</dt>        <dd class="contBox"><input type="text" name="answer" class="M_inpt"></dd>        <dd class="tipBox"><span class="M_alert" node-type="tip"></span></dd>      </dl>    </div>    <div class="submit_cent">      <a class="M_btn_e" href="#" action-type="submit"><span>确定</span></a><a class="M_btn_e" href="#" action-type="close"><span>取消</span></a>    </div>  </div></form>');r+=i;r+=e.question;r+=s;return r}},s:function(e,t,n,r){String.prototype.trim=function(){var e=this.replace(/(^\s*)|(\s*$)/g,"");return e.replace(/(^　*)|(　*$)/g,"")};String.prototype.encodeHTML=function(){var e=document.createElement("div");e.appendChild(document.createTextNode(this));return e.innerHTML.replace(/\s/g,"&nbsp;").replace(/"/g,"&quot;")};String.prototype.getByteLength=function(){return this.replace(/[^\x00-\xff]/g,"rr").length};String.prototype.decodeHTML=function(){return this.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&nbsp;/g," ").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&amp;/g,"&")};String.prototype.cutString=function(e,t,n){var r=this,t=t||"";if(!!n===false){r=this.decodeHTML();if(r.getByteLength()<=e)return r.encodeHTML();var i=Math.floor(e/2);for(var s=i,o=r.getByteLength();s<=o;s++){if(r.substr(0,s).getByteLength()>e){return(r.substr(0,s-1)+t).encodeHTML()}}return(r+t).encodeHTML()}else{if(r.getByteLength()<=e)return r;var i=Math.floor(e/2);for(var s=i,o=r.getByteLength();s<=o;s++){if(r.substr(0,s).getByteLength()>e){return r.substr(0,s-1)+t}}return r+t}};Object.keys||(Object.keys=function(e){var t=[];for(var n in e){t.push(n)}return t});String.prototype.hasDoubleByte=function(e){return e?/^[^\x00-\xff]+$/.test(this):/[^\x00-\xff]/.test(this)};String.prototype.getByteLength=function(){return this.hasDoubleByte()?this.replace(/[^\x00-\xff]/g,"**").length:this.length};String.prototype.sliceByte=function(e,t){var n=this.slice(0,e);if(n.hasDoubleByte()){var r=n.getByteLength();while(r>e){r-=n.charAt(n.length-1).getByteLength();n=n.slice(0,-1)}if(r<e&&t)n+=this.charAt(n.length)}return n};String.prototype.cutHtml=function(e,t,n){var r=arguments.length,i="",s=0,o=[],u=0;var a=/([\s\S]*?)(<\/?([a-zA-Z0-9]+)[^>]*>|$)/gi;var f=100,l=0,c=false;while(s<e&&a.exec(this)){l++;if(l>=f)break;var h=RegExp.$1,p=RegExp.$2,d=RegExp.$3,v=r>2?h.getByteLength():h.length;s+=v;if(p){if(p.indexOf("</")!==0){if(s>=e)p="</"+o.splice(o.length-1,1)+">";else o.push(d)}else if((u=o.lastIndexOf(d))>-1){o.splice(u,1)}}if(s>e){var m=r>2?h.sliceByte(e-s+v,n):h.slice(0,e-s+v);i+=m+t+p}else if(s==e)i+=h+t+p;else i+=h+p}var g=o.length;if(g){if($.msie&&/^(p|li|dt|dd|tr|th|td)$/i.test(o[g-1])&&!RegExp("</"+RegExp.$1+">$","i").test(i))i+="</"+o.splice(g-1,1)+">";o=o.filter(function(e){return!this.test(e)},$.msie?/^(abbr|br|col|img|input|link|meta|param|hr|area|embed|p|li|dt|dd|tr|th|td)$/i:/^(abbr|br|col|img|input|link|meta|param|hr|area|embed)$/i);if(o.length)i+="</"+o.reverse().join("></")+">"}return i}},S:function(e,t,n,r){var i=n("A");var s=n("b");var o=n("i");var u=n("D");var a=n("G");var f=n("t");var l=n("p");var c=function(e){function d(){var e="",t=l.orgFlag,n=l.eventRec,r=l.tagRec,i=l.userRec,s=l.orgRec,o=true,u=/^http(s?):\/\//.test(n.url)?n.url:"http://"+n.url;e+='<a href="#" action-type="cancel" class="close"></a>'+'<div class="L_guide">'+'<div class="guide_hd">'+'<h3 class="M_hidetxt">微相册推荐精彩内容</h3>'+'<div class="pic_area">'+'<a title="'+(n.name||"")+'" href="'+u+'" target="_blank"><img src="'+n.pic+'" alt=""></a>'+"</div>"+'<div class="m_box_mod hot_tags">'+'<div class="hd">'+'<h4><span class="M_ico M_icon81"></span>热门标签</h4>'+"</div>"+'<div class="bd">'+'<div class="m_photo_list_a">'+v(r)+"</div>"+"</div>"+"</div>"+"</div>"+'<div class="guide_bd">'+'<div class="m_box_mod famous_phor">'+'<div class="hd">'+'<h4><span class="M_ico M_icon82"></span>知名摄影人</h4>'+'<div class="act">'+'<label for="user_checkall" class="check_all">'+'<input id="user_checkall" value="list_user" class="M_checkbox" checked="'+o+'" type="checkbox">全选加关注'+"</label>"+"</div>"+"</div>"+'<div class="bd">'+'<div class="m_photo_list_a" node-type="list_user">'+m(i,o)+"</div>"+"</div>"+"</div>"+g(s,o,t)+"</div>"+'<div class="guide_ft">'+'<div class="btn_wrap">'+'<a href="#" action-type="try_now" class="M_btn_a"><span>立即体验</span></a>'+"</div>"+"</div>"+"</div>";return e}function v(e){var t=[],n,i,s;if(e){t.push('<ul class="photoList clearfix">');for(var o=0,u=e.length;o<u;o++){n=e[o];s=n.name;i=r+"tags/best/tag/"+s+"?prel=p7_2";t.push("<li>");t.push('<dl class="m_photoItem m_photoItem_a">');t.push('<dt class="photo">');t.push('<a href="'+i+'" target="_blank"><img src="'+n.pic+'" alt=""></a>');t.push("</dt>");t.push("<dd>");t.push('<p class="M_linkc desc"><a href="'+i+'" target="_blank" title="">'+s+"</a></p>");t.push("</dd>");t.push("</dl>");t.push("</li>")}t.push("</ul>")}return t.join("")}function m(e,t){var n=[],i,s,o;if(e){n.push('<ul class="photoList clearfix">');for(var u=0,a=e.length;u<a;u++){s=e[u];i=s.uid;o=r+i+"/albums";n.push("<li>");n.push('<dl class="m_photoItem m_photoItem_a">');n.push('<dt class="photo">');n.push('<a href="'+o+'" target="_blank"><img src="'+s.profile+'" alt=""></a>');n.push('<input class="M_checkbox" value="'+i+'" name="user" checked="'+!!t+'" type="checkbox">');n.push("</dt>");n.push("<dd>");n.push('<p class="M_linkc desc"><a href="'+o+'" target="_blank" title="">'+s.screen_name+"</a></p>");n.push("</dd>");n.push("</dl>");n.push("</li>")}n.push("</ul>")}return n.join("")}function g(e,t,n){var r="";if(!n){r='<div class="m_box_mod phor_agency">'+'<div class="hd">'+'<h4><span class="M_ico M_icon83"></span>摄影机构</h4>'+'<div class="act">'+'<label for="org_checkall" class="check_all">'+'<input id="org_checkall" value="list_org" class="M_checkbox" checked="'+!!t+'" type="checkbox">全选加关注'+"</label>"+"</div>"+"</div>"+'<div class="bd">'+'<div class="m_photo_list_a" node-type="list_org">'+m(e,t)+"</div>"+"</div>"+"</div>"}return r}var t=[];var n="1962310741";var r=u.baseURL;var l=null;var c=this;var h;t[0]='<dl class="guide_info">'+'<dt>新版"微相册"</dt>'+"<dd>围观Ta的生活映像，闪耀你的精致视界！</dd>"+"<dd>快速上传、美图、高清大图。</dd>"+'<dd class="follow"><label for="follow" action-type="check_fllow" class="follow"><input type="checkbox" checked="checked" id="follow">关注"微相册"官方微博</label></dd>'+'<dd class="btn_wrap"><a class="btn_next" href="javascript:void(0)">下一步</a></dd>'+"</dl>";var c=this;this.curStep=e||0;this.guideNode=i.C("div");this.guideNode.className="m_guide";var p=i.delegatedEvent(this.guideNode);this.do_step=function(){if(t[this.curStep]){this.guideNode.innerHTML=t[this.curStep]}};this.hide=function(){p||p.destroy();i.removeNode(c.guideNode);i.removeEvent(document,"click",this.goShareToWB)};this.shareToWB=function(){f({beforeHideFn:c.showRecommendLayer})};this.show=function(){this.guideNode.style.display=""};this.setPosition=function(){var e=i.core.dom.getSize(this.guideNode);var t=i.winSize().width-e.width/2;this.guideNode.style.top=0;this.guideNode.style.zIndex=1e4};this.getUserByUid=function(e,t){s({dataType:"json",url:r+"users/get_user",data:{uid:e},type:"get",success:function(e){if(t&&typeof t=="function"){t.call(c,e)}}})};this.do_follow=function(e,t){s({url:r+"users/follow",args:{uid:e},method:"post",onComplete:function(e){if(t&&typeof t=="function"){t.call(this,e)}}})};this.follow_batch=function(e,t){s({url:r+"users/follow_batch",args:{uids:e},method:"post",onComplete:function(e){if(t&&typeof t=="function"){t.call(this,e)}}})};this.addEvent=function(){p.add("check_fllow","click",function(e){e.stopEvent()});p.add("close","click",this.goShareToWB);i.addEvent(document,"click",this.goShareToWB)};this.goShareToWB=function(){var e=i.E("#follow");if(e&&e.checked){c.getUserByUid(n,function(e){if(e&&e.result){if(e.data&&!e.data.following){c.do_follow(n)}}})}c.hide();o.hide();c.shareToWB();i.preventDefault()};this.getRecommendData=function(e){if(l){if(e&&typeof e=="function"){e.apply(this,argumengts)}}else{s({url:r+"users/get_guide",method:"get",onComplete:function(t){if(t&&t.result){l=t.data;if(e&&typeof e=="function"){e.apply(c,arguments)}}}})}};this.showRecommendLayer=function(){c.getRecommendData(function(){h=a(d(),{title:false});h.setMiddle().show();c.addRecommendEvent(h.getBox())})};this.addRecommendEvent=function(e){function r(e){var t=e.target||e.srcElement;var n=t.value,r=i.builder(h.getBox()).list[n][0];nodes=i.sizzle("input:checkbox",r);window.setTimeout(function(){i.foreach(nodes,function(e,n){e.checked=t.checked})},10)}if(e){var t=i.E("org_checkall");var n=i.E("user_checkall");i.addEvent(org_checkall,"click",r);i.addEvent(n,"click",r);h.addEvent("try_now","click",function(){c.doTryNow(e);i.removeEvent(t,"click",r);i.removeEvent(n,"click",r);i.preventDefault()})}};this.doTryNow=function(e){var t=i.sizzle("input[type=checkbox][name=user]",e);var n=[];for(var r=0,s=t.length;r<s;r++){if(t[r].checked)n.push(t[r].value)}if(n.length){c.follow_batch(n.join(","))}h.hide()};this.init=function(){if($CONFIG&&$CONFIG.account_settings&&$CONFIG.account_settings.guide){document.body.appendChild(this.guideNode);o.showUnderNode(this.guideNode);this.do_step();this.show();this.setPosition();this.addEvent()}};this.init()};e.exports=c},t:function(e,t,n,r){var i=n("A");var s=n("L");var o=n("b");var u=n("D");var a=n("T");var f=n("d");var l=u.baseURL;e.exports=function(e){function h(e,t){o({url:l+"sina/update",args:e,method:"post",onComplete:function(e){if(t&&typeof t==="function"){t.call(this,e)}}})}var t,n,r,u=null;var f;var c={init:function(){c.pars();c.build();c.bind()},pars:function(){e=i.parseParam({title:"分享到微博",ok:i.funcEmpty,beforeHideFn:i.funcEmpty},e||{})},build:function(){n=s();n.setContent(a(e));n.setTitle(e.title);n.setClassName("L_shareWB");n.setMiddle().show();n.setBeforeHideFn(e.beforeHideFn);t=n.getBox();r=n.getDomList(true)},bind:function(){f=i.delegatedEvent(t);f.add("ok","click",function(){var e=i.sizzle("textarea",t)[0];h({content:e.value,type:1});n.hide()});i.custEvent.add(n,"hide",function(){i.custEvent.remove(n,"hide",arguments.callee);f.destroy();n.destroy()})}};c.init();u=n;return u}},T:function(e,t,n,r){e.exports=function(e,t,n){t=t||function(e){return e};var r="",i=t('<div class="shareWB"><div class="txtarea"><textarea class="M_txtarea">我在用刚刚发布的#新版微相册#，看起来还不错～是个分享照片的好地方，想看看朋友们的照片吗？猛击这个链接[嘻嘻]</textarea></div><div class="shareTo"><a href="#" action-type="ok" class="M_btn_b"><span>开始使用微相册</span></a><a href="#" action-data="2" action-type="close" class="M_linkg">跳过</a></div></div>');r+=i;return r}}});